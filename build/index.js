!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("consensus",[],t):"object"==typeof exports?exports.consensus=t():e.consensus=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=90)}([function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,h=[],u=!1,l=-1;function d(){u&&c&&(u=!1,c.length?h=c.concat(h):l=-1,h.length&&f())}function f(){if(!u){var e=a(d);u=!0;for(var t=h.length;t;){for(c=h,h=[];++l<t;)c&&c[l].run();l=-1,t=h.length}c=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new p(e,t)),1!==h.length||u||a(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,s,a,c,h;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}if(o(n=this._events[e]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(i(n))for(a=Array.prototype.slice.call(arguments,1),s=(h=n.slice()).length,c=0;c<s;c++)h[c].apply(this,a);return!0},n.prototype.addListener=function(e,t){var s;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(s=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!r(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},n.prototype.removeListener=function(e,t){var n,o,s,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(n=this._events[e]).length,o=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(a=s;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=a;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){(function(e){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,n(10).Buffer)},function(e,t,n){(function(e,n){var r="__lodash_hash_undefined__",i=9007199254740991,o="[object Arguments]",s="[object AsyncFunction]",a="[object Function]",c="[object GeneratorFunction]",h="[object Null]",u="[object Object]",l="[object Proxy]",d="[object Undefined]",f=/^\[object .+?Constructor\]$/,p=/^(?:0|[1-9]\d*)$/,g={};g["[object Float32Array]"]=g["[object Float64Array]"]=g["[object Int8Array]"]=g["[object Int16Array]"]=g["[object Int32Array]"]=g["[object Uint8Array]"]=g["[object Uint8ClampedArray]"]=g["[object Uint16Array]"]=g["[object Uint32Array]"]=!0,g[o]=g["[object Array]"]=g["[object ArrayBuffer]"]=g["[object Boolean]"]=g["[object DataView]"]=g["[object Date]"]=g["[object Error]"]=g[a]=g["[object Map]"]=g["[object Number]"]=g[u]=g["[object RegExp]"]=g["[object Set]"]=g["[object String]"]=g["[object WeakMap]"]=!1;var y="object"==typeof e&&e&&e.Object===Object&&e,m="object"==typeof self&&self&&self.Object===Object&&self,b=y||m||Function("return this")(),v="object"==typeof t&&t&&!t.nodeType&&t,w=v&&"object"==typeof n&&n&&!n.nodeType&&n,_=w&&w.exports===v,C=_&&y.process,E=function(){try{return C&&C.binding&&C.binding("util")}catch(e){}}(),S=E&&E.isTypedArray;function k(e,t){return"__proto__"==t?void 0:e[t]}var x=Array.prototype,F=Function.prototype,R=Object.prototype,M=b["__core-js_shared__"],A=F.toString,T=R.hasOwnProperty,P=function(){var e=/[^.]+$/.exec(M&&M.keys&&M.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),I=R.toString,O=A.call(Object),j=RegExp("^"+A.call(T).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),D=_?b.Buffer:void 0,B=b.Symbol,N=b.Uint8Array,L=(D&&D.allocUnsafe,function(e,t){return function(n){return e(t(n))}}(Object.getPrototypeOf,Object)),U=Object.create,q=R.propertyIsEnumerable,W=x.splice,z=B?B.toStringTag:void 0,V=function(){try{var e=ue(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),H=D?D.isBuffer:void 0,$=Math.max,Y=Date.now,J=ue(b,"Map"),X=ue(Object,"create"),G=function(){function e(){}return function(t){if(!_e(t))return{};if(U)return U(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function Z(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function K(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Q(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ee(e){var t=this.__data__=new K(e);this.size=t.size}function te(e,t,n){(void 0===n||pe(e[t],n))&&(void 0!==n||t in e)||ie(e,t,n)}function ne(e,t,n){var r=e[t];T.call(e,t)&&pe(r,n)&&(void 0!==n||t in e)||ie(e,t,n)}function re(e,t){for(var n=e.length;n--;)if(pe(e[n][0],t))return n;return-1}function ie(e,t,n){"__proto__"==t&&V?V(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}Z.prototype.clear=function(){this.__data__=X?X(null):{},this.size=0},Z.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Z.prototype.get=function(e){var t=this.__data__;if(X){var n=t[e];return n===r?void 0:n}return T.call(t,e)?t[e]:void 0},Z.prototype.has=function(e){var t=this.__data__;return X?void 0!==t[e]:T.call(t,e)},Z.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=X&&void 0===t?r:t,this},K.prototype.clear=function(){this.__data__=[],this.size=0},K.prototype.delete=function(e){var t=this.__data__,n=re(t,e);return!(n<0||(n==t.length-1?t.pop():W.call(t,n,1),--this.size,0))},K.prototype.get=function(e){var t=this.__data__,n=re(t,e);return n<0?void 0:t[n][1]},K.prototype.has=function(e){return re(this.__data__,e)>-1},K.prototype.set=function(e,t){var n=this.__data__,r=re(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Q.prototype.clear=function(){this.size=0,this.__data__={hash:new Z,map:new(J||K),string:new Z}},Q.prototype.delete=function(e){var t=he(this,e).delete(e);return this.size-=t?1:0,t},Q.prototype.get=function(e){return he(this,e).get(e)},Q.prototype.has=function(e){return he(this,e).has(e)},Q.prototype.set=function(e,t){var n=he(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},ee.prototype.clear=function(){this.__data__=new K,this.size=0},ee.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},ee.prototype.get=function(e){return this.__data__.get(e)},ee.prototype.has=function(e){return this.__data__.has(e)},ee.prototype.set=function(e,t){var n=this.__data__;if(n instanceof K){var r=n.__data__;if(!J||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Q(r)}return n.set(e,t),this.size=n.size,this};var oe=function(e,t,n){for(var r=-1,i=Object(e),o=n(e),s=o.length;s--;){var a=o[++r];if(!1===t(i[a],a,i))break}return e};function se(e){return null==e?void 0===e?d:h:z&&z in Object(e)?function(e){var t=T.call(e,z),n=e[z];try{e[z]=void 0;var r=!0}catch(e){}var i=I.call(e);return r&&(t?e[z]=n:delete e[z]),i}(e):function(e){return I.call(e)}(e)}function ae(e){return Ce(e)&&se(e)==o}function ce(e,t,n,r,i){e!==t&&oe(t,function(o,s){if(_e(o))i||(i=new ee),function(e,t,n,r,i,o,s){var a=k(e,n),c=k(t,n),h=s.get(c);if(h)te(e,n,h);else{var l=o?o(a,c,n+"",e,t,s):void 0,d=void 0===l;if(d){var f=ye(c),p=!f&&be(c),g=!f&&!p&&Ee(c);l=c,f||p||g?ye(a)?l=a:function(e){return Ce(e)&&me(e)}(a)?l=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}(a):p?(d=!1,l=function(e,t){return e.slice()}(c)):g?(d=!1,l=function(e,t){var n=function(e){var t=new e.constructor(e.byteLength);return new N(t).set(new N(e)),t}(e.buffer);return new e.constructor(n,e.byteOffset,e.length)}(c)):l=[]:function(e){if(!Ce(e)||se(e)!=u)return!1;var t=L(e);if(null===t)return!0;var n=T.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&A.call(n)==O}(c)||ge(c)?(l=a,ge(a)?l=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,s=t.length;++o<s;){var a=t[o],c=void 0;void 0===c&&(c=e[a]),i?ie(n,a,c):ne(n,a,c)}return n}(a,Se(a)):(!_e(a)||r&&ve(a))&&(l=function(e){return"function"!=typeof e.constructor||de(e)?{}:G(L(e))}(c))):d=!1}d&&(s.set(c,l),i(l,c,r,o,s),s.delete(c)),te(e,n,l)}}(e,t,s,n,ce,r,i);else{var a=r?r(k(e,s),o,s+"",e,t,i):void 0;void 0===a&&(a=o),te(e,s,a)}},Se)}function he(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function ue(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!_e(e)||function(e){return!!P&&P in e}(e))&&(ve(e)?j:f).test(function(e){if(null!=e){try{return A.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e))}(n)?n:void 0}function le(e,t){var n=typeof e;return!!(t=null==t?i:t)&&("number"==n||"symbol"!=n&&p.test(e))&&e>-1&&e%1==0&&e<t}function de(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||R)}var fe=function(e){var t=0,n=0;return function(){var r=Y(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(V?function(e,t){return V(e,"toString",{configurable:!0,enumerable:!1,value:function(e){return function(){return e}}(t),writable:!0})}:xe);function pe(e,t){return e===t||e!=e&&t!=t}var ge=ae(function(){return arguments}())?ae:function(e){return Ce(e)&&T.call(e,"callee")&&!q.call(e,"callee")},ye=Array.isArray;function me(e){return null!=e&&we(e.length)&&!ve(e)}var be=H||function(){return!1};function ve(e){if(!_e(e))return!1;var t=se(e);return t==a||t==c||t==s||t==l}function we(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=i}function _e(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ce(e){return null!=e&&"object"==typeof e}var Ee=S?function(e){return function(t){return e(t)}}(S):function(e){return Ce(e)&&we(e.length)&&!!g[se(e)]};function Se(e){return me(e)?function(e,t){var n=ye(e),r=!n&&ge(e),i=!n&&!r&&be(e),o=!n&&!r&&!i&&Ee(e),s=n||r||i||o,a=s?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],c=a.length;for(var h in e)!t&&!T.call(e,h)||s&&("length"==h||i&&("offset"==h||"parent"==h)||o&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||le(h,c))||a.push(h);return a}(e,!0):function(e){if(!_e(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=de(e),n=[];for(var r in e)("constructor"!=r||!t&&T.call(e,r))&&n.push(r);return n}(e)}var ke=function(e){return function(e,t){return fe(function(e,t,n){return t=$(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=$(r.length-t,0),s=Array(o);++i<o;)s[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(s),function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}(e,this,a)}}(e,t,xe),e+"")}(function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,s=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,s&&function(e,t,n){if(!_e(n))return!1;var r=typeof t;return!!("number"==r?me(n)&&le(t,n.length):"string"==r&&t in n)&&pe(n[t],e)}(n[0],n[1],s)&&(o=i<3?void 0:o,i=1),t=Object(t);++r<i;){var a=n[r];a&&e(t,a,r)}return t})}(function(e,t,n){ce(e,t,n)});function xe(e){return e}n.exports=ke}).call(this,n(0),n(23)(e))},function(e,t,n){"use strict";(function(t){!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,n,r,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,n)});case 3:return t.nextTick(function(){e.call(null,n,r)});case 4:return t.nextTick(function(){e.call(null,n,r,i)});default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return t.nextTick(function(){e.apply(null,o)})}}}:e.exports=t}).call(this,n(1))},function(e,t,n){var r=n(10),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=s),o(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){var r=n(93),i=n(94);e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||i(s)}},function(e,t,n){"use strict";var r=n(7).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=h,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=u,this.end=l,t=3;break;default:return this.write=d,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function h(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function u(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function l(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function d(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},o.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=s(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(112),i=n(113),o=n(20);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return h(this,e,t,n)}function h(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=d(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=a(e,r)).write(t,n);return i!==r&&(e=e.slice(0,i)),e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|f(t.length);return 0===(e=a(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||function(e){return e!=e}(t.length)?a(e,0):d(e,t);if("Buffer"===t.type&&o(t.data))return d(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(u(t),e=a(e,t<0?0:0|f(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t){var n=t.length<0?0:0|f(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return q(e).length;default:if(r)return U(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,i){var o,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function h(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var u=-1;for(o=n;o<a;o++)if(h(e,o)===h(t,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===c)return u*s}else-1!==u&&(o-=o-u),u=-1}else for(n+c>a&&(n=a-c),o=n;o>=0;o--){for(var l=!0,d=0;d<c;d++)if(h(e,o+d)!==h(t,d)){l=!1;break}if(l)return o}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function v(e,t,n,r){return W(U(t,e.length-n),e,n,r)}function w(e,t,n,r){return W(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function _(e,t,n,r){return w(e,t,n,r)}function C(e,t,n,r){return W(q(t),e,n,r)}function E(e,t,n,r){return W(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=(n=e.charCodeAt(s))>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function S(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function k(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,c,h=e[i],u=null,l=h>239?4:h>223?3:h>191?2:1;if(i+l<=n)switch(l){case 1:h<128&&(u=h);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&h)<<6|63&o)>127&&(u=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&h)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&h)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(u=c)}null===u?(u=65533,l=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=l}return function(e){var t=e.length;if(t<=x)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=x));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){return+e!=e&&(e=0),c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return h(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return u(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return l(null,e)},c.allocUnsafeSlow=function(e){return l(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?k(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return M(this,t,n);case"utf8":case"utf-8":return k(this,t,n);case"ascii":return F(this,t,n);case"latin1":case"binary":return R(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var o=i-r,s=n-t,a=Math.min(o,s),h=this.slice(r,i),u=e.slice(t,n),l=0;l<a;++l)if(h[l]!==u[l]){o=h[l],s=u[l];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return v(this,e,t,n);case"ascii":return w(this,e,t,n);case"latin1":case"binary":return _(this,e,t,n);case"base64":return C(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var x=4096;function F(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function R(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function M(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=L(e[o]);return i}function A(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function T(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function P(e,t,n,r,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function I(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function O(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function j(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function D(e,t,n,r,o){return o||j(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function B(e,t,n,r,o){return o||j(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if(e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||T(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||T(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||T(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||T(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||T(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||T(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||T(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||T(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||T(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||T(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||T(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||T(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||T(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||T(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||T(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||T(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||T(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||T(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||P(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||P(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):O(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):O(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);P(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);P(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):I(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):I(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):O(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):O(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return D(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return D(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return B(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return B(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=c.isBuffer(e)?e:U(new c(e,r).toString()),a=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var N=/[^+\/0-9A-Za-z-_]/g;function L(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function q(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(N,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function W(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(0))},function(e,t){var n=1e3,r=6e4,i=36e5,o=24*i;function s(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,t){t=t||{};var a=typeof e;if("string"===a&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===a&&!1===isNaN(e))return t.long?function(e){var t=Math.abs(e);return t>=o?s(e,t,o,"day"):t>=i?s(e,t,i,"hour"):t>=r?s(e,t,r,"minute"):t>=n?s(e,t,n,"second"):e+" ms"}(e):function(e){var t=Math.abs(e);return t>=o?Math.round(e/o)+"d":t>=i?Math.round(e/i)+"h":t>=r?Math.round(e/r)+"m":t>=n?Math.round(e/n)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){"use strict";(function(r){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++r)}),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(109)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(1))},function(e,t,n){"use strict";var r=n(6),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=l;var o=n(4);o.inherits=n(2);var s=n(59),a=n(36);o.inherits(l,s);for(var c=i(a.prototype),h=0;h<c.length;h++){var u=c[h];l.prototype[u]||(l.prototype[u]=a.prototype[u])}function l(e){if(!(this instanceof l))return new l(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),l.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t,n){"use strict";(function(t){var r=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=h;var i=n(43),o=n(47);n(2)(h,i);for(var s=r(o.prototype),a=0;a<s.length;a++){var c=s[a];h.prototype[c]||(h.prototype[c]=o.prototype[c])}function h(e){if(!(this instanceof h))return new h(e);i.call(this,e),o.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",u)))}function u(){this._writableState.ended||t.nextTick(l,this)}function l(e){e.end()}Object.defineProperty(h.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(h.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(h.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(h.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})}).call(this,n(1))},function(e,t,n){"use strict";var r=n(6),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=l;var o=n(4);o.inherits=n(2);var s=n(49),a=n(52);o.inherits(l,s);for(var c=i(a.prototype),h=0;h<c.length;h++){var u=c[h];l.prototype[u]||(l.prototype[u]=a.prototype[u])}function l(e){if(!(this instanceof l))return new l(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),l.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t,n){"use strict";var r=n(6),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=l;var o=n(4);o.inherits=n(2);var s=n(54),a=n(57);o.inherits(l,s);for(var c=i(a.prototype),h=0;h<c.length;h++){var u=c[h];l.prototype[u]||(l.prototype[u]=a.prototype[u])}function l(e){if(!(this instanceof l))return new l(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),l.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t,n){function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,n){(function(e){var r,i=n(158),o=n(71),s=n(160),a=n(161),c=n(162);e&&e.ArrayBuffer&&(r=n(163));var h="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),u="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),l=h||u;t.protocol=3;var d=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},f=i(d),p={type:"error",data:"parser error"},g=n(164);function y(e,t,n){for(var r=new Array(e.length),i=a(e.length,n),o=function(e,n,i){t(n,function(t,n){r[e]=n,i(t,r)})},s=0;s<e.length;s++)o(s,e[s],i)}t.encodePacket=function(n,r,i,o){"function"==typeof r&&(o=r,r=!1),"function"==typeof i&&(o=i,i=null);var s=void 0===n.data?void 0:n.data.buffer||n.data;if(e.ArrayBuffer&&s instanceof ArrayBuffer)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=e.data,o=new Uint8Array(i),s=new Uint8Array(1+i.byteLength);s[0]=d[e.type];for(var a=0;a<o.length;a++)s[a+1]=o[a];return r(s.buffer)}(n,r,o);if(g&&s instanceof e.Blob)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(l)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=new FileReader;return i.onload=function(){e.data=i.result,t.encodePacket(e,n,!0,r)},i.readAsArrayBuffer(e.data)}(e,n,r);var i=new Uint8Array(1);return i[0]=d[e.type],r(new g([i.buffer,e.data]))}(n,r,o);if(s&&s.base64)return function(e,n){return o("b"+t.packets[e.type]+e.data.data)}(n);var a=d[n.type];return void 0!==n.data&&(a+=i?c.encode(String(n.data),{strict:!1}):String(n.data)),o(""+a)},t.encodeBase64Packet=function(n,r){var i,o="b"+t.packets[n.type];if(g&&n.data instanceof e.Blob){var s=new FileReader;return s.onload=function(){var e=s.result.split(",")[1];r(o+e)},s.readAsDataURL(n.data)}try{i=String.fromCharCode.apply(null,new Uint8Array(n.data))}catch(e){for(var a=new Uint8Array(n.data),c=new Array(a.length),h=0;h<a.length;h++)c[h]=a[h];i=String.fromCharCode.apply(null,c)}return o+=e.btoa(i),r(o)},t.decodePacket=function(e,n,r){if(void 0===e)return p;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r&&!1===(e=function(e){try{e=c.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return p;var i=e.charAt(0);return Number(i)==i&&f[i]?e.length>1?{type:f[i],data:e.substring(1)}:{type:f[i]}:p}i=new Uint8Array(e)[0];var o=s(e,1);return g&&"blob"===n&&(o=new g([o])),{type:f[i],data:o}},t.decodeBase64Packet=function(e,t){var n=f[e.charAt(0)];if(!r)return{type:n,data:{base64:!0,data:e.substr(1)}};var i=r.decode(e.substr(1));return"blob"===t&&g&&(i=new g([i])),{type:n,data:i}},t.encodePayload=function(e,n,r){"function"==typeof n&&(r=n,n=null);var i=o(e);return n&&i?g&&!l?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r):e.length?void y(e,function(e,r){t.encodePacket(e,!!i&&n,!1,function(e){r(null,function(e){return e.length+":"+e}(e))})},function(e,t){return r(t.join(""))}):r("0:")},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);var i;if("function"==typeof n&&(r=n,n=null),""===e)return r(p,0,1);for(var o,s,a="",c=0,h=e.length;c<h;c++){var u=e.charAt(c);if(":"===u){if(""===a||a!=(o=Number(a)))return r(p,0,1);if(a!=(s=e.substr(c+1,o)).length)return r(p,0,1);if(s.length){if(i=t.decodePacket(s,n,!1),p.type===i.type&&p.data===i.data)return r(p,0,1);if(!1===r(i,c+o,h))return}c+=o,a=""}else a+=u}return""!==a?r(p,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));y(e,function(e,n){t.encodePacket(e,!0,!0,function(e){return n(null,e)})},function(e,t){var r=t.reduce(function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2},0),i=new Uint8Array(r),o=0;return t.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),s=0;s<e.length;s++)r[s]=e.charCodeAt(s);n=r.buffer}i[o++]=t?0:1;var a=n.byteLength.toString();for(s=0;s<a.length;s++)i[o++]=parseInt(a[s]);for(i[o++]=255,r=new Uint8Array(n),s=0;s<r.length;s++)i[o++]=r[s]}),n(i.buffer)})},t.encodePayloadAsBlob=function(e,n){y(e,function(e,n){t.encodePacket(e,!0,!0,function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);e=r.buffer,t[0]=0}var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),s=new Uint8Array(o.length+1);for(i=0;i<o.length;i++)s[i]=parseInt(o[i]);if(s[o.length]=255,g){var a=new g([t.buffer,s.buffer,e]);n(null,a)}})},function(e,t){return n(new g(t))})},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var i=e,o=[];i.byteLength>0;){for(var a=new Uint8Array(i),c=0===a[0],h="",u=1;255!==a[u];u++){if(h.length>310)return r(p,0,1);h+=a[u]}i=s(i,2+h.length),h=parseInt(h);var l=s(i,0,h);if(c)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(e){var d=new Uint8Array(l);for(l="",u=0;u<d.length;u++)l+=String.fromCharCode(d[u])}o.push(l),i=s(i,h)}var f=o.length;o.forEach(function(e,i){r(t.decodePacket(e,n,!0),i,f)})}}).call(this,n(0))},function(e,t,n){"use strict";var r=n(6),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=l;var o=n(4);o.inherits=n(2);var s=n(78),a=n(81);o.inherits(l,s);for(var c=i(a.prototype),h=0;h<c.length;h++){var u=c[h];l.prototype[u]||(l.prototype[u]=a.prototype[u])}function l(e){if(!(this instanceof l))return new l(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||r.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),l.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,n(0))},function(e,t,n){"use strict";const r=n(3);e.exports=class extends r{constructor(e){super(),this._rps=this._buildRPS(e),this._options=e,this._id=this._rps.PEER}get id(){return this._id}get rps(){return this._rps}get inviewId(){throw new Error("A valid network must implement a inviewId getter")}get outviewId(){throw new Error("A valid network must implement a outviewId getter")}_buildRPS(e){throw new Error("A valid network must implement a _buildRPS method using options",e)}getNeighbours(e){throw new Error("A valid network must implement a getNeighbours method with limit",e)}}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i={};function o(e,t,n){n||(n=Error);var r=function(e){function r(e,n,i){return function(e,t){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,function(e,n,r){return"string"==typeof t?t:t(e,n,i)}(e,n)))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,n),r}();r.prototype.name=n.name,r.prototype.code=e,i[e]=r}function s(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map(function(e){return String(e)}),n>2?"one of "+t+" "+e.slice(0,n-1).join(", ")+", or "+e[n-1]:2===n?"one of "+t+" "+e[0]+" or "+e[1]:"of "+t+" "+e[0]}return"of "+t+" "+String(e)}o("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),o("ERR_INVALID_ARG_TYPE",function(e,t,n){var i=void 0;"string"==typeof t&&function(e,t,n){return e.substr(0,t.length)===t}(t,"not ")?(i="must not be",t=t.replace(/^not /,"")):i="must be";return(function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument")?"The "+e+" "+i+" "+s(t,"type"):'The "'+e+'" '+(function(e,t,n){return"number"!=typeof n&&(n=0),!(n+".".length>e.length)&&-1!==e.indexOf(".",n)}(e)?"property":"argument")+" "+i+" "+s(t,"type"))+". Received type "+(void 0===n?"undefined":r(n))},TypeError),o("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),o("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),o("ERR_STREAM_PREMATURE_CLOSE","Premature close"),o("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),o("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),o("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),o("ERR_STREAM_WRITE_AFTER_END","write after end"),o("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),o("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),o("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.codes=i},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(127),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(e,t,n){(function(r){function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(148)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(o=++i)}),e.splice(o,0,r)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(1))},function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),r=0,i=n.length;r<i;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},function(e,t){e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){(function(r){function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(165)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(o=++i)}),e.splice(o,0,r)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(1))},function(e,t,n){"use strict";const r=n(175)("n2n-overlay-wrtc"),i=n(177),o=n(3),s=n(5),a=n(8),c=n(202),h=n(203),u=n(204),l=n(205);e.exports=class extends o{constructor(e={}){super(),this.options=s({pid:a(),peer:a(),retry:5},e),this.PID=this.options.pid,this.NI=this.options.inview||new i(s(s({},this.options),{peer:this.options.peer+"-I"})),this.NO=this.options.outview||new i(s(s({},this.options),{peer:this.options.peer+"-O"})),this.II=this.NI.register(this),this.IO=this.NO.register(this),this.PEER=this.II.peer+"|"+this.IO.peer,r("[%s] registered to ==> %s ==>",this.PID,this.PEER),this.i=new Map,this.o=new Map}_pid(){return this.PID}_received(e,t){t.type?"MConnectTo"===t.type||"MForwarded"===t.type||"MForwardTo"===t.type?this._bridge(e,t):"MResponse"===t.type||"MRequest"===t.type||"MDirect"===t.type?this._direct(e,t):this.emit("receive",e,t):this.emit("receive",e,t)}_streamed(e,t){this.emit("stream",e,t)}_connected(e,t){t?(this.o.has(e)||this.o.set(e,0),this.o.set(e,this.o.get(e)+1),this.emit("open",e)):(this.i.has(e)||this.i.set(e,0),this.i.set(e,this.i.get(e)+1))}_disconnected(e){this.o.has(e)?(this.o.set(e,this.o.get(e)-1),this.o.get(e)<=0&&this.o.delete(e),this.emit("close",e)):this.i.has(e)&&(this.i.set(e,this.i.get(e)-1),this.i.get(e)<=0&&this.i.delete(e))}_failed(e,t){t&&this.emit("fail",e)}_bridge(e,t){t.type&&"MConnectTo"===t.type?this.IO.connect(n=>{this.send(e,new c(t.from,t.to,n),this.options.retry).catch(e=>{})}):t.type&&"MForwardTo"===t.type?this.send(t.to,new h(t.from,t.to,t.message),this.options.retry).catch(e=>{}):t.type&&"MForwarded"===t.type&&"MRequest"===t.message.type?this.II.connect(n=>{this.send(e,new c(t.to,t.from,n),this.options.retry).catch(e=>{})},t.message):t.type&&"MForwarded"===t.type&&"MResponse"===t.message.type&&this.IO.connect(t.message)}_direct(e,t){"MDirect"===t.type&&this.IO.connect(t=>{this.send(e,t,this.options.retry).catch(e=>{})}),"MRequest"===t.type&&this.II.connect(t=>{this.send(e,t,this.options.retry).catch(e=>{})},t),"MResponse"===t.type&&this.IO.connect(t)}send(e,t,n=0){let r;if(this.i.has(e))r=this.II.send(e,t,n);else if(this.o.has(e))r=this.IO.send(e,t,n);else{const i=e.substr(0,e.length-2),o=i+"-I",s=i+"-O";r=this.o.has(o)?this.IO.send(o,t,n):this.i.has(s)?this.II.send(s,t,n):new Promise((r,i)=>{const o=s=>{this.IO.send(e,t,0).then(()=>r()).catch(a=>this.II.send(e,t,0).then(()=>r()).catch(e=>{s<n?setTimeout(()=>{o(s+1)},1e3):i(e)}))};o(0)})}return r}stream(e,t,n=0){let r;if(this.i.has(e))r=this.II.stream(e,t,n);else if(this.o.has(e))r=this.IO.stream(e,t,n);else{const i=e.substr(0,e.length-2),o=i+"-I",s=i+"-O";r=this.o.has(o)?this.IO.stream(o,t,n):this.i.has(s)?this.II.stream(s,t,n):new Promise((r,i)=>{const o=s=>{this.IO.stream(e,t,0).then(()=>r()).catch(a=>this.II.send(e,t,0).then(()=>r()).catch(e=>{s<n?setTimeout(()=>{o(s+1)},1e3):i(e)}))};o(0)})}return r}connect(e=null,t=null){"function"==typeof e&&null===t?this.IO.connect(t=>e(t)):"function"==typeof e&&null!==t?(r("[%s] %s <π= ??? =π= %s",this.PID,this.getInviewId(),t.peer),this.II.connect(t=>e(t),t)):null!==e&&"object"==typeof e&&null===t?this.IO.connect(e):(null===e||e!==this.IO.peer&&e!==this.II.peer||(e=null),null===t||t!==this.IO.peer&&t!==this.II.peer||(t=null),null!==e&&null!==t?(r("[%s] %s =π= %s =π> %s",this.PID,e,this.PEER,t),this.send(e,new u(e,t),this.options.retry).catch(e=>{})):null!==e?this.send(e,new l,this.options.retry).catch(e=>{}):null!==t&&this._direct(t,new l))}disconnect(e){void 0===e?(this.II.disconnect(),this.IO.disconnect()):(this.i.has(e)&&this.II.disconnect(e),this.o.has(e)&&this.IO.disconnect(e))}neighbours(){return{inview:this.II.neighbours(),outview:this.IO.neighbours()}}uniqNeighbours(e=!1){const t=this.II.neighbours(),n=this.IO.neighbours(),r=[];return t.forEach(e=>{const t=e.peer.substr(0,e.peer.length-2);-1===r.indexOf(t)&&r.push(t)}),n.forEach(e=>{const t=e.peer.substr(0,e.peer.length-2);-1===r.indexOf(t)&&r.push(t)}),e?r.map(e=>e+"-O"):r}getInview(){return new Map(this.i)}getInviewId(){return this.NI.PEER}getOutview(){return new Map(this.o)}getOutviewId(){return this.NO.PEER}}},function(e,t,n){"use strict";const r=n(92),i=n(33),o=n(216),s=n(63),a=n(77),c=n(83),h=n(22),u=n(223),l=n(224),d=n(238);e.exports={Foglet:r,protocol:o,Signaling:s,SimplePeerMoc:d,networks:{Spray:a,Cyclon:c},communication:i,abstract:{rps:h,overlay:u,tman:l}}},function(e,t,n){"use strict";const r=n(3);e.exports=class extends r{constructor(e,t){super(),this._source=e,this._protocol=t}send(e){throw new Error("A valid communication protocol should implement a send method, message:"+e.toString())}_receive(e,t){throw new Error("A valid communication protocol should implement a _receiveMessage method; "+`(id, message)=(${e.toString()},${t.toString()})`)}}},function(e,t,n){"use strict";const r=n(41),i=n(100),o=n(110),s=n(111),a=n(121);e.exports=class{constructor(e,t){this.network=e,this.unicast=new r(this.network,t),this.broadcast=new i(this.network,t),this._unicastStreams=new r(this.network,`${t}-streams`),this._broadcastStreams=new i(this.network,`${t}-streams`),this._activeStreams=new Map,this._middlewares=new o}use(e,t=0){this._middlewares.register(e,t)}sendUnicast(e,t){return this.unicast.send(e,this._middlewares.in(t))}streamUnicast(e){return new s(t=>{t.payload=this._middlewares.in(t.payload),this._unicastStreams.send(e,t)})}sendMulticast(e,t){return this.unicast.sendMultiple(e,this._middlewares.in(t))}sendBroadcast(e,t,n){return this.broadcast.send(this._middlewares.in(e),t,n)}streamBroadcast(e){return new s((e,t,n)=>(e.payload=this._middlewares.in(e.payload),this._broadcastStreams.send(e,t,n)),e)}onUnicast(e){this.unicast.on("receive",(t,n)=>{e(t,this._middlewares.out(n))})}onStreamUnicast(e){this._unicastStreams.on("receive",(t,n)=>this._handleStreamMessage(t,n,e))}onOnceUnicast(e){this.unicast.once("receive",(t,n)=>{e(t,this._middlewares.out(n))})}onBroadcast(e){this.broadcast.on("receive",(t,n)=>e(t,this._middlewares.out(n)))}onStreamBroadcast(e){this._broadcastStreams.on("receive",(t,n)=>this._handleStreamMessage(t,n,e))}onOnceBroadcast(e){this.broadcast.once("receive",(t,n)=>e(t,this._middlewares.out(n)))}removeAllUnicastCallback(){this.unicast.removeAllListeners("receive")}removeAllBroacastCallback(){this.broadcast.removeAllListeners("receive")}_handleStreamMessage(e,t,n){switch(this._activeStreams.has(t.id)||(this._activeStreams.set(t.id,new a),n(e,this._activeStreams.get(t.id))),t.type){case"chunk":this._activeStreams.get(t.id).push(t.payload);break;case"trailers":if(!this._activeStreams.has(t.id))throw new Error(`Cannot add trailers to an unkown stream with id = ${t.id}`);this._activeStreams.get(t.id)._trailers=t.payload;break;case"end":this._closeStream(t.id);break;case"error":if(!this._activeStreams.has(t.id))throw new Error(`Cannot transmit an error to an unkown stream with id = ${t.id}`);this._activeStreams.get(t.id).emit("error",t.payload),this._closeStream(t.id);break;default:throw new Error(`Unknown StreamMessage type found in incoming stream message: ${t.type}`)}}_closeStream(e){if(!this._activeStreams.has(e))throw new Error(`Cannot close an unkown stream with id = ${e}`);this._activeStreams.get(e).push(null),this._activeStreams.delete(e)}}},function(e,t,n){"use strict";const r=n(97)("unicast-definition"),i=n(3),o=n(5),s=n(99);e.exports=class extends i{constructor(e,t={}){super(),this.options=o({retry:0,pid:"default-unicast"},t),this.psp=e;let n=e._receive;e._receive=((t,r)=>{try{n.call(e,t,r)}catch(e){if(!r.type||"MUnicast"!==r.type||r.pid!==this.options.pid)throw e;this._emit(r.event,...r.args)}}),this._emit=this.emit,this.emit=((t,n,...r)=>e.send(n,new s(this.options.pid,t,r),this.options.retry)),r("just initialized on top of %s@%s.",this.psp.PID,this.psp.PEER)}destroy(){this.removeAllListener(),this.emit=this._emit}}},function(e,t,n){(t=e.exports=n(59)).Stream=t,t.Readable=t,t.Writable=n(36),t.Duplex=n(13),t.Transform=n(62),t.PassThrough=n(140)},function(e,t,n){"use strict";(function(t,r,i){var o=n(6);function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(void 0),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=b;var a,c=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:o.nextTick;b.WritableState=m;var h=n(4);h.inherits=n(2);var u,l={deprecate:n(21)},d=n(60),f=n(7).Buffer,p=i.Uint8Array||function(){},g=n(61);function y(){}function m(e,t){a=a||n(13),e=e||{};var r=t instanceof a;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,h=e.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(h||0===h)?h:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var l=!1===e.decodeStrings;this.decodeStrings=!l,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(o.nextTick(i,r),o.nextTick(S,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),S(e,t))}(e,n,r,t,i);else{var s=C(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||_(e,n),r?c(w,e,n,s,i):w(e,n,s,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function b(e){if(a=a||n(13),!(u.call(b,this)||this instanceof a))return new b(e);this._writableState=new m(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),d.call(this)}function v(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function w(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),S(e,t)}function _(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var a=0,c=!0;n;)i[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;i.allBuffers=c,v(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var h=n.chunk,u=n.encoding,l=n.callback;if(v(e,t,!1,t.objectMode?1:h.length,h,u,l),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function C(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function E(e,t){e._final(function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),S(e,t)})}function S(e,t){var n=C(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(E,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}h.inherits(b,d),m.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(m.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(e){return!!u.call(this,e)||this===b&&e&&e._writableState instanceof m}})):u=function(e){return e instanceof this},b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},b.prototype.write=function(e,t,n){var r=this._writableState,i=!1,s=!r.objectMode&&function(e){return f.isBuffer(e)||e instanceof p}(e);return s&&!f.isBuffer(e)&&(e=function(e){return f.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=y),r.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),o.nextTick(t,n)}(this,n):(s||function(e,t,n,r){var i=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),o.nextTick(r,s),i=!1),i}(this,r,e,n))&&(r.pendingcb++,i=function(e,t,n,r,i,o){if(!n){var s=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,n)),t}(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var h=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},h?h.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else v(e,t,!1,a,r,i,o);return c}(this,r,s,e,t,n)),i},b.prototype.cork=function(){this._writableState.corked++},b.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||_(this,e))},b.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(b.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),b.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,S(e,t),n&&(t.finished?o.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),b.prototype.destroy=g.destroy,b.prototype._undestroy=g.undestroy,b.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(1),n(25).setImmediate,n(0))},function(e,t,n){var r=n(150)("socket.io-parser"),i=n(17),o=n(153),s=n(66),a=n(67);function c(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=c,t.Decoder=l;var h=t.ERROR+'"encode error"';function u(e){var n=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(n+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(n+=e.nsp+","),null!=e.id&&(n+=e.id),null!=e.data){var i=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===i)return h;n+=i}return r("encoded %j as %s",e,n),n}function l(){this.reconstructor=null}function d(e){this.reconPack=e,this.buffers=[]}function f(e){return{type:t.ERROR,data:"parser error: "+e}}c.prototype.encode=function(e,n){r("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type?function(e,t){o.removeBlobs(e,function(e){var n=o.deconstructPacket(e),r=u(n.packet),i=n.buffers;i.unshift(r),t(i)})}(e,n):n([u(e)])},i(l.prototype),l.prototype.add=function(e){var n;if("string"==typeof e)n=function(e){var n=0,i={type:Number(e.charAt(0))};if(null==t.types[i.type])return f("unknown packet type "+i.type);if(t.BINARY_EVENT===i.type||t.BINARY_ACK===i.type){for(var o="";"-"!==e.charAt(++n)&&(o+=e.charAt(n),n!=e.length););if(o!=Number(o)||"-"!==e.charAt(n))throw new Error("Illegal attachments");i.attachments=Number(o)}if("/"===e.charAt(n+1))for(i.nsp="";++n;){if(","===(c=e.charAt(n)))break;if(i.nsp+=c,n===e.length)break}else i.nsp="/";var a=e.charAt(n+1);if(""!==a&&Number(a)==a){for(i.id="";++n;){var c;if(null==(c=e.charAt(n))||Number(c)!=c){--n;break}if(i.id+=e.charAt(n),n===e.length)break}i.id=Number(i.id)}if(e.charAt(++n)){var h=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(n));if(!(!1!==h&&(i.type===t.ERROR||s(h))))return f("invalid payload");i.data=h}return r("decoded %s as %j",e,i),i}(e),t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type?(this.reconstructor=new d(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!a(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",n))}},l.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},d.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=o.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},d.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,n){(function(t){var r=n(156);e.exports=function(e){var n=e.xdomain,i=e.xscheme,o=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!n||r))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!i&&o)return new XDomainRequest}catch(e){}if(!n)try{return new(t[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(this,n(0))},function(e,t,n){var r=n(18),i=n(17);function o(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}e.exports=o,i(o.prototype),o.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},o.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(e){var t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)},o.prototype.onPacket=function(e){this.emit("packet",e)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t,n){"use strict";e.exports=class{constructor(e,t){this.peer=e,this.descriptor=t,this.type="MUpdatePartialView"}}},function(e,t,n){"use strict";const r=n(96),i=n(34);e.exports=class extends r{constructor(e,t){super(e,t),this._unicast=new i(this._source.rps,{pid:this._protocol}),this._unicast.on(this._protocol,(e,t)=>{this._receive(e,t)})}send(e,t){return this._unicast.emit(this._protocol,e,this._source.outviewId,t)}sendMultiple(e=[],t){return e.reduce((e,n)=>e.then(()=>this.send(n,t)),Promise.resolve())}_receive(e,t){this.emit("receive",e,t)}}},function(e,t,n){(t=e.exports=n(43)).Stream=t,t.Readable=t,t.Writable=n(47),t.Duplex=n(14),t.Transform=n(48),t.PassThrough=n(119)},function(e,t,n){"use strict";(function(t,r){var i;e.exports=S,S.ReadableState=E,n(3).EventEmitter;var o=function(e,t){return e.listeners(t).length},s=n(44),a=n(10).Buffer,c=t.Uint8Array||function(){},h=n(114),u=void 0;u=h&&h.debuglog?h.debuglog("stream"):function(){};var l=n(115),d=n(45),f=n(46).getHighWaterMark,p=n(24).codes,g=p.ERR_INVALID_ARG_TYPE,y=p.ERR_STREAM_PUSH_AFTER_EOF,m=p.ERR_METHOD_NOT_IMPLEMENTED,b=p.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,v=n(117).emitExperimentalWarning,w=void 0,_=void 0;n(2)(S,s);var C=["error","close","destroy","pause","resume"];function E(e,t,r){i=i||n(14),e=e||{},"boolean"!=typeof r&&(r=t instanceof i),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=f(this,e,"readableHighWaterMark",r),this.buffer=new l,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.emitClose=!1!==e.emitClose,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(w||(w=n(9).StringDecoder),this.decoder=new w(e.encoding),this.encoding=e.encoding)}function S(e){if(i=i||n(14),!(this instanceof S))return new S(e);var t=this instanceof i;this._readableState=new E(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),s.call(this)}function k(e,t,n,r,i){u("readableAddChunk",t);var o,s=e._readableState;if(null===t)s.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?M(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,A(e)))}}(e,s);else if(i||(o=function(e,t){var n;return function(e){return a.isBuffer(e)||e instanceof c}(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new g("chunk",["string","Buffer","Uint8Array"],t)),n}(s,t)),o)e.emit("error",o);else if(s.objectMode||t&&t.length>0)if("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===a.prototype||(t=function(e){return a.from(e)}(t)),r)s.endEmitted?e.emit("error",new b):x(e,s,t,!0);else if(s.ended)e.emit("error",new y);else{if(s.destroyed)return!1;s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?x(e,s,t,!1):T(e,s)):x(e,s,t,!1)}else r||(s.reading=!1,T(e,s));return!s.ended&&(s.length<s.highWaterMark||0===s.length)}function x(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&M(e)),T(e,t)}Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),S.prototype.destroy=d.destroy,S.prototype._undestroy=d.undestroy,S.prototype._destroy=function(e,t){t(e)},S.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=a.from(e,t),t=""),n=!0),k(this,e,t,!1,n)},S.prototype.unshift=function(e){return k(this,e,null,!0,!1)},S.prototype.isPaused=function(){return!1===this._readableState.flowing},S.prototype.setEncoding=function(e){return w||(w=n(9).StringDecoder),this._readableState.decoder=new w(e),this._readableState.encoding=this._readableState.decoder.encoding,this};var F=8388608;function R(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=F?e=F:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function M(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(u("emitReadable",t.flowing),t.emittedReadable=!0,r.nextTick(A,e))}function A(e){var t=e._readableState;u("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||e.emit("readable"),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,D(e)}function T(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(P,e,t))}function P(e,t){for(var n=t.length;!t.reading&&!t.ended&&t.length<t.highWaterMark&&(u("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function I(e){e._readableState.readableListening=e.listenerCount("readable")>0,e.listenerCount("data")>0&&e.resume()}function O(e){u("readable nexttick read 0"),e.read(0)}function j(e,t){u("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),D(e),t.flowing&&!t.reading&&e.read(0)}function D(e){var t=e._readableState;for(u("flow",t.flowing);t.flowing&&null!==e.read(););}function B(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function N(e){var t=e._readableState;u("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,r.nextTick(L,t,e))}function L(e,t){u("endReadableNT",e.endEmitted,e.length),e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function U(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}S.prototype.read=function(e){u("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return u("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?N(this):M(this),null;if(0===(e=R(e,t))&&t.ended)return 0===t.length&&N(this),null;var r,i=t.needReadable;return u("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&u("length less than watermark",i=!0),t.ended||t.reading?u("reading or ended",i=!1):i&&(u("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=R(n,t))),null===(r=e>0?B(e,t):null)?(t.needReadable=!0,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&N(this)),null!==r&&this.emit("data",r),r},S.prototype._read=function(e){this.emit("error",new m("_read()"))},S.prototype.pipe=function(e,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,u("pipe count=%d opts=%j",i.pipesCount,t);var s=t&&!1===t.end||e===r.stdout||e===r.stderr?g:a;function a(){u("onend"),e.end()}i.endEmitted?r.nextTick(s):n.once("end",s),e.on("unpipe",function t(r,o){u("onunpipe"),r===n&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,u("cleanup"),e.removeListener("close",f),e.removeListener("finish",p),e.removeListener("drain",c),e.removeListener("error",d),e.removeListener("unpipe",t),n.removeListener("end",a),n.removeListener("end",g),n.removeListener("data",l),h=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||c())});var c=function(e){return function(){var t=e._readableState;u("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,D(e))}}(n);e.on("drain",c);var h=!1;function l(t){u("ondata");var r=e.write(t);u("dest.write",r),!1===r&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==U(i.pipes,e))&&!h&&(u("false write response, pause",i.awaitDrain),i.awaitDrain++),n.pause())}function d(t){u("onerror",t),g(),e.removeListener("error",d),0===o(e,"error")&&e.emit("error",t)}function f(){e.removeListener("finish",p),g()}function p(){u("onfinish"),e.removeListener("close",f),g()}function g(){u("unpipe"),n.unpipe(e)}return n.on("data",l),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",d),e.once("close",f),e.once("finish",p),e.emit("pipe",n),i.flowing||(u("pipe resume"),n.resume()),e},S.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,{hasUnpiped:!1});return this}var s=U(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},S.prototype.on=function(e,t){var n=s.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,u("on readable",i.length,i.reading),i.length?M(this):i.reading||r.nextTick(O,this))),n},S.prototype.addListener=S.prototype.on,S.prototype.removeListener=function(e,t){var n=s.prototype.removeListener.call(this,e,t);return"readable"===e&&r.nextTick(I,this),n},S.prototype.removeAllListeners=function(e){var t=s.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||r.nextTick(I,this),t},S.prototype.resume=function(){var e=this._readableState;return e.flowing||(u("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(j,e,t))}(this,e)),this},S.prototype.pause=function(){return u("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(u("pause"),this._readableState.flowing=!1,this.emit("pause")),this},S.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",function(){if(u("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){u("wrapped data"),n.decoder&&(i=n.decoder.write(i)),(!n.objectMode||null!==i&&void 0!==i)&&(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<C.length;o++)e.on(C[o],this.emit.bind(this,C[o]));return this._read=function(t){u("wrapped _read",t),r&&(r=!1,e.resume())},this},"function"==typeof Symbol&&(S.prototype[Symbol.asyncIterator]=function(){return v("Readable[Symbol.asyncIterator]"),void 0===_&&(_=n(118)),new _(this)}),Object.defineProperty(S.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(S.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(S.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),S._fromList=B,Object.defineProperty(S.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}})}).call(this,n(0),n(1))},function(e,t,n){e.exports=n(3).EventEmitter},function(e,t,n){"use strict";(function(t){function n(e,t){i(e,t),r(e)}function r(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,o){var s=this,a=this._readableState&&this._readableState.destroyed,c=this._writableState&&this._writableState.destroyed;return a||c?(o?o(e):!e||this._writableState&&this._writableState.errorEmitted||t.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!o&&e?(t.nextTick(n,s,e),s._writableState&&(s._writableState.errorEmitted=!0)):o?(t.nextTick(r,s),o(e)):t.nextTick(r,s)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}}).call(this,n(1))},function(e,t,n){"use strict";var r=n(24).codes.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,n,i){var o=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,i,n);if(null!=o){if(!Number.isInteger(o)||o<0)throw new r(i?n:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},function(e,t,n){"use strict";(function(t,r){function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(void 0),r=r.next}t.corkedRequestsFree.next=e}(t,e)}}var o;e.exports=S,S.WritableState=E;var s,a={deprecate:n(21)},c=n(44),h=n(10).Buffer,u=t.Uint8Array||function(){},l=n(45),d=n(46).getHighWaterMark,f=n(24).codes,p=f.ERR_INVALID_ARG_TYPE,g=f.ERR_METHOD_NOT_IMPLEMENTED,y=f.ERR_MULTIPLE_CALLBACK,m=f.ERR_STREAM_CANNOT_PIPE,b=f.ERR_STREAM_DESTROYED,v=f.ERR_STREAM_NULL_VALUES,w=f.ERR_STREAM_WRITE_AFTER_END,_=f.ERR_UNKNOWN_ENCODING;function C(){}function E(e,t,s){o=o||n(14),e=e||{},"boolean"!=typeof s&&(s=t instanceof o),this.objectMode=!!e.objectMode,s&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=d(this,e,"writableHighWaterMark",s),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===e.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,o=n.writecb;if("function"!=typeof o)throw new y;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,o){--t.pendingcb,n?(r.nextTick(o,i),r.nextTick(A,e,t),e._writableState.errorEmitted=!0,e.emit("error",i)):(o(i),e._writableState.errorEmitted=!0,e.emit("error",i),A(e,t))}(e,n,i,t,o);else{var s=R(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||F(e,n),i?r.nextTick(x,e,n,s,o):x(e,n,s,o)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function S(e){var t=this instanceof(o=o||n(14));if(!t&&!s.call(S,this))return new S(e);this._writableState=new E(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),c.call(this)}function k(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new b("write")):n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function x(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),A(e,t)}function F(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,o=new Array(r),s=t.corkedRequestsFree;s.entry=n;for(var a=0,c=!0;n;)o[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;o.allBuffers=c,k(e,t,!0,t.length,o,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;n;){var h=n.chunk,u=n.encoding,l=n.callback;if(k(e,t,!1,t.objectMode?1:h.length,h,u,l),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function R(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function M(e,t){e._final(function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),A(e,t)})}function A(e,t){var n=R(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,r.nextTick(M,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}n(2)(S,c),E.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(E.prototype,"buffer",{get:a.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(S,Symbol.hasInstance,{value:function(e){return!!s.call(this,e)||this===S&&e&&e._writableState instanceof E}})):s=function(e){return e instanceof this},S.prototype.pipe=function(){this.emit("error",new m)},S.prototype.write=function(e,t,n){var i=this._writableState,o=!1,s=!i.objectMode&&function(e){return h.isBuffer(e)||e instanceof u}(e);return s&&!h.isBuffer(e)&&(e=function(e){return h.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=C),i.ending?function(e,t){var n=new w;e.emit("error",n),r.nextTick(t,n)}(this,n):(s||function(e,t,n,i){var o;return null===n?o=new v:"string"==typeof n||t.objectMode||(o=new p("chunk",["string","Buffer"],n)),!o||(e.emit("error",o),r.nextTick(i,o),!1)}(this,i,e,n))&&(i.pendingcb++,o=function(e,t,n,r,i,o){if(!n){var s=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=h.from(t,n)),t}(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else k(e,t,!1,a,r,i,o);return c}(this,i,s,e,t,n)),o},S.prototype.cork=function(){this._writableState.corked++},S.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||F(this,e))},S.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new _(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(S.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(S.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),S.prototype._write=function(e,t,n){n(new g("_write()"))},S.prototype._writev=null,S.prototype.end=function(e,t,n){var i=this._writableState;return"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||function(e,t,n){t.ending=!0,A(e,t),n&&(t.finished?r.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,i,n),this},Object.defineProperty(S.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(S.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),S.prototype.destroy=l.destroy,S.prototype._undestroy=l.undestroy,S.prototype._destroy=function(e,t){t(e)}}).call(this,n(0),n(1))},function(e,t,n){"use strict";e.exports=h;var r=n(24).codes,i=r.ERR_METHOD_NOT_IMPLEMENTED,o=r.ERR_MULTIPLE_CALLBACK,s=r.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=r.ERR_TRANSFORM_WITH_LENGTH_0,c=n(14);function h(e){if(!(this instanceof h))return new h(e);c.call(this,e),this._transformState={afterTransform:function(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(null===r)return this.emit("error",new o);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",u)}function u(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?l(this,null,null):this._flush(function(t,n){l(e,t,n)})}function l(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new a;if(e._transformState.transforming)throw new s;return e.push(null)}n(2)(h,c),h.prototype.push=function(e,t){return this._transformState.needTransform=!1,c.prototype.push.call(this,e,t)},h.prototype._transform=function(e,t,n){n(new i("_transform()"))},h.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},h.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},h.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,function(e){t(e)})}},function(e,t,n){"use strict";(function(t,r){var i=n(6);e.exports=v;var o,s=n(20);v.ReadableState=b,n(3).EventEmitter;var a=function(e,t){return e.listeners(t).length},c=n(50),h=n(7).Buffer,u=t.Uint8Array||function(){},l=n(4);l.inherits=n(2);var d=n(124),f=void 0;f=d&&d.debuglog?d.debuglog("stream"):function(){};var p,g=n(125),y=n(51);l.inherits(v,c);var m=["error","close","destroy","pause","resume"];function b(e,t){o=o||n(15),e=e||{};var r=t instanceof o;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,s=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=n(9).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function v(e){if(o=o||n(15),!(this instanceof v))return new v(e);this._readableState=new b(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function w(e,t,n,r,i){var o,s=e._readableState;return null===t?(s.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,S(e)}}(e,s)):(i||(o=function(e,t){var n;return function(e){return h.isBuffer(e)||e instanceof u}(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===h.prototype||(t=function(e){return h.from(e)}(t)),r?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):_(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?_(e,s,t,!1):x(e,s)):_(e,s,t,!1))):r||(s.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function _(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&S(e)),x(e,t)}Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),v.prototype.destroy=y.destroy,v.prototype._undestroy=y.undestroy,v.prototype._destroy=function(e,t){this.push(null),t(e)},v.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=h.from(e,t),t=""),n=!0),w(this,e,t,!1,n)},v.prototype.unshift=function(e){return w(this,e,null,!0,!1)},v.prototype.isPaused=function(){return!1===this._readableState.flowing},v.prototype.setEncoding=function(e){return p||(p=n(9).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var C=8388608;function E(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=C?e=C:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function S(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(k,e):k(e))}function k(e){f("emit readable"),e.emit("readable"),A(e)}function x(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(F,e,t))}function F(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function R(e){f("readable nexttick read 0"),e.read(0)}function M(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),A(e),t.flowing&&!t.reading&&e.read(0)}function A(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function T(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0==(e-=s)){s===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=h.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,s),0==(e-=s)){s===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++i}return t.length-=i,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function P(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(I,t,e))}function I(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function O(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}v.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?P(this):S(this),null;if(0===(e=E(e,t))&&t.ended)return 0===t.length&&P(this),null;var r,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=E(n,t))),null===(r=e>0?T(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&P(this)),null!==r&&this.emit("data",r),r},v.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},v.prototype.pipe=function(e,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,f("pipe count=%d opts=%j",o.pipesCount,t);var c=t&&!1===t.end||e===r.stdout||e===r.stderr?b:h;function h(){f("onend"),e.end()}o.endEmitted?i.nextTick(c):n.once("end",c),e.on("unpipe",function t(r,i){f("onunpipe"),r===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,f("cleanup"),e.removeListener("close",y),e.removeListener("finish",m),e.removeListener("drain",u),e.removeListener("error",g),e.removeListener("unpipe",t),n.removeListener("end",h),n.removeListener("end",b),n.removeListener("data",p),l=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||u())});var u=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,A(e))}}(n);e.on("drain",u);var l=!1,d=!1;function p(t){f("ondata"),d=!1,!1!==e.write(t)||d||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==O(o.pipes,e))&&!l&&(f("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,d=!0),n.pause())}function g(t){f("onerror",t),b(),e.removeListener("error",g),0===a(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",m),b()}function m(){f("onfinish"),e.removeListener("close",y),b()}function b(){f("unpipe"),n.unpipe(e)}return n.on("data",p),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",y),e.once("finish",m),e.emit("pipe",n),o.flowing||(f("pipe resume"),n.resume()),e},v.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,n);return this}var s=O(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},v.prototype.on=function(e,t){var n=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&S(this):i.nextTick(R,this))}return n},v.prototype.addListener=v.prototype.on,v.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(M,e,t))}(this,e)),this},v.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},v.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",function(){if(f("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){f("wrapped data"),n.decoder&&(i=n.decoder.write(i)),(!n.objectMode||null!==i&&void 0!==i)&&(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<m.length;o++)e.on(m[o],this.emit.bind(this,m[o]));return this._read=function(t){f("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(v.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),v._fromList=T}).call(this,n(0),n(1))},function(e,t,n){e.exports=n(3).EventEmitter},function(e,t,n){"use strict";var r=n(6);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";(function(t,r,i){var o=n(6);function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(void 0),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=b;var a,c=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:o.nextTick;b.WritableState=m;var h=n(4);h.inherits=n(2);var u,l={deprecate:n(21)},d=n(50),f=n(7).Buffer,p=i.Uint8Array||function(){},g=n(51);function y(){}function m(e,t){a=a||n(15),e=e||{};var r=t instanceof a;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,h=e.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(h||0===h)?h:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var l=!1===e.decodeStrings;this.decodeStrings=!l,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(o.nextTick(i,r),o.nextTick(S,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),S(e,t))}(e,n,r,t,i);else{var s=C(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||_(e,n),r?c(w,e,n,s,i):w(e,n,s,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function b(e){if(a=a||n(15),!(u.call(b,this)||this instanceof a))return new b(e);this._writableState=new m(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),d.call(this)}function v(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function w(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),S(e,t)}function _(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var a=0,c=!0;n;)i[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;i.allBuffers=c,v(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var h=n.chunk,u=n.encoding,l=n.callback;if(v(e,t,!1,t.objectMode?1:h.length,h,u,l),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function C(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function E(e,t){e._final(function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),S(e,t)})}function S(e,t){var n=C(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(E,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}h.inherits(b,d),m.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(m.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(e){return!!u.call(this,e)||this===b&&e&&e._writableState instanceof m}})):u=function(e){return e instanceof this},b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},b.prototype.write=function(e,t,n){var r=this._writableState,i=!1,s=!r.objectMode&&function(e){return f.isBuffer(e)||e instanceof p}(e);return s&&!f.isBuffer(e)&&(e=function(e){return f.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=y),r.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),o.nextTick(t,n)}(this,n):(s||function(e,t,n,r){var i=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),o.nextTick(r,s),i=!1),i}(this,r,e,n))&&(r.pendingcb++,i=function(e,t,n,r,i,o){if(!n){var s=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,n)),t}(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var h=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},h?h.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else v(e,t,!1,a,r,i,o);return c}(this,r,s,e,t,n)),i},b.prototype.cork=function(){this._writableState.corked++},b.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||_(this,e))},b.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(b.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),b.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,S(e,t),n&&(t.finished?o.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),b.prototype.destroy=g.destroy,b.prototype._undestroy=g.undestroy,b.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(1),n(25).setImmediate,n(0))},function(e,t,n){"use strict";e.exports=o;var r=n(15),i=n(4);function o(e){if(!(this instanceof o))return new o(e);r.call(this,e),this._transformState={afterTransform:function(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",s)}function s(){var e=this;"function"==typeof this._flush?this._flush(function(t,n){a(e,t,n)}):a(this,null,null)}function a(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=n(2),i.inherits(o,r),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,function(e){t(e),n.emit("close")})}},function(e,t,n){"use strict";(function(t,r){var i=n(6);e.exports=v;var o,s=n(20);v.ReadableState=b,n(3).EventEmitter;var a=function(e,t){return e.listeners(t).length},c=n(55),h=n(7).Buffer,u=t.Uint8Array||function(){},l=n(4);l.inherits=n(2);var d=n(131),f=void 0;f=d&&d.debuglog?d.debuglog("stream"):function(){};var p,g=n(132),y=n(56);l.inherits(v,c);var m=["error","close","destroy","pause","resume"];function b(e,t){o=o||n(16),e=e||{};var r=t instanceof o;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,s=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=n(9).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function v(e){if(o=o||n(16),!(this instanceof v))return new v(e);this._readableState=new b(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function w(e,t,n,r,i){var o,s=e._readableState;return null===t?(s.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,S(e)}}(e,s)):(i||(o=function(e,t){var n;return function(e){return h.isBuffer(e)||e instanceof u}(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===h.prototype||(t=function(e){return h.from(e)}(t)),r?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):_(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?_(e,s,t,!1):x(e,s)):_(e,s,t,!1))):r||(s.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function _(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&S(e)),x(e,t)}Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),v.prototype.destroy=y.destroy,v.prototype._undestroy=y.undestroy,v.prototype._destroy=function(e,t){this.push(null),t(e)},v.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=h.from(e,t),t=""),n=!0),w(this,e,t,!1,n)},v.prototype.unshift=function(e){return w(this,e,null,!0,!1)},v.prototype.isPaused=function(){return!1===this._readableState.flowing},v.prototype.setEncoding=function(e){return p||(p=n(9).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var C=8388608;function E(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=C?e=C:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function S(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(k,e):k(e))}function k(e){f("emit readable"),e.emit("readable"),A(e)}function x(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(F,e,t))}function F(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function R(e){f("readable nexttick read 0"),e.read(0)}function M(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),A(e),t.flowing&&!t.reading&&e.read(0)}function A(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function T(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0==(e-=s)){s===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=h.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,s),0==(e-=s)){s===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++i}return t.length-=i,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function P(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(I,t,e))}function I(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function O(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}v.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?P(this):S(this),null;if(0===(e=E(e,t))&&t.ended)return 0===t.length&&P(this),null;var r,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=E(n,t))),null===(r=e>0?T(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&P(this)),null!==r&&this.emit("data",r),r},v.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},v.prototype.pipe=function(e,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,f("pipe count=%d opts=%j",o.pipesCount,t);var c=t&&!1===t.end||e===r.stdout||e===r.stderr?b:h;function h(){f("onend"),e.end()}o.endEmitted?i.nextTick(c):n.once("end",c),e.on("unpipe",function t(r,i){f("onunpipe"),r===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,f("cleanup"),e.removeListener("close",y),e.removeListener("finish",m),e.removeListener("drain",u),e.removeListener("error",g),e.removeListener("unpipe",t),n.removeListener("end",h),n.removeListener("end",b),n.removeListener("data",p),l=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||u())});var u=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,A(e))}}(n);e.on("drain",u);var l=!1,d=!1;function p(t){f("ondata"),d=!1,!1!==e.write(t)||d||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==O(o.pipes,e))&&!l&&(f("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,d=!0),n.pause())}function g(t){f("onerror",t),b(),e.removeListener("error",g),0===a(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",m),b()}function m(){f("onfinish"),e.removeListener("close",y),b()}function b(){f("unpipe"),n.unpipe(e)}return n.on("data",p),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",y),e.once("finish",m),e.emit("pipe",n),o.flowing||(f("pipe resume"),n.resume()),e},v.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,n);return this}var s=O(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},v.prototype.on=function(e,t){var n=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&S(this):i.nextTick(R,this))}return n},v.prototype.addListener=v.prototype.on,v.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(M,e,t))}(this,e)),this},v.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},v.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",function(){if(f("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){f("wrapped data"),n.decoder&&(i=n.decoder.write(i)),(!n.objectMode||null!==i&&void 0!==i)&&(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<m.length;o++)e.on(m[o],this.emit.bind(this,m[o]));return this._read=function(t){f("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(v.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),v._fromList=T}).call(this,n(0),n(1))},function(e,t,n){e.exports=n(3).EventEmitter},function(e,t,n){"use strict";var r=n(6);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";(function(t,r,i){var o=n(6);function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(void 0),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=b;var a,c=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:o.nextTick;b.WritableState=m;var h=n(4);h.inherits=n(2);var u,l={deprecate:n(21)},d=n(55),f=n(7).Buffer,p=i.Uint8Array||function(){},g=n(56);function y(){}function m(e,t){a=a||n(16),e=e||{};var r=t instanceof a;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,h=e.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(h||0===h)?h:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var l=!1===e.decodeStrings;this.decodeStrings=!l,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(o.nextTick(i,r),o.nextTick(S,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),S(e,t))}(e,n,r,t,i);else{var s=C(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||_(e,n),r?c(w,e,n,s,i):w(e,n,s,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function b(e){if(a=a||n(16),!(u.call(b,this)||this instanceof a))return new b(e);this._writableState=new m(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),d.call(this)}function v(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function w(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),S(e,t)}function _(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var a=0,c=!0;n;)i[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;i.allBuffers=c,v(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var h=n.chunk,u=n.encoding,l=n.callback;if(v(e,t,!1,t.objectMode?1:h.length,h,u,l),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function C(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function E(e,t){e._final(function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),S(e,t)})}function S(e,t){var n=C(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(E,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}h.inherits(b,d),m.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(m.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(e){return!!u.call(this,e)||this===b&&e&&e._writableState instanceof m}})):u=function(e){return e instanceof this},b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},b.prototype.write=function(e,t,n){var r=this._writableState,i=!1,s=!r.objectMode&&function(e){return f.isBuffer(e)||e instanceof p}(e);return s&&!f.isBuffer(e)&&(e=function(e){return f.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=y),r.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),o.nextTick(t,n)}(this,n):(s||function(e,t,n,r){var i=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),o.nextTick(r,s),i=!1),i}(this,r,e,n))&&(r.pendingcb++,i=function(e,t,n,r,i,o){if(!n){var s=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,n)),t}(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var h=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},h?h.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else v(e,t,!1,a,r,i,o);return c}(this,r,s,e,t,n)),i},b.prototype.cork=function(){this._writableState.corked++},b.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||_(this,e))},b.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(b.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),b.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,S(e,t),n&&(t.finished?o.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),b.prototype.destroy=g.destroy,b.prototype._undestroy=g.undestroy,b.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(1),n(25).setImmediate,n(0))},function(e,t,n){"use strict";e.exports=o;var r=n(16),i=n(4);function o(e){if(!(this instanceof o))return new o(e);r.call(this,e),this._transformState={afterTransform:function(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",s)}function s(){var e=this;"function"==typeof this._flush?this._flush(function(t,n){a(e,t,n)}):a(this,null,null)}function a(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=n(2),i.inherits(o,r),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,function(e){t(e),n.emit("close")})}},function(e,t,n){"use strict";(function(t,r){var i=n(6);e.exports=v;var o,s=n(20);v.ReadableState=b,n(3).EventEmitter;var a=function(e,t){return e.listeners(t).length},c=n(60),h=n(7).Buffer,u=t.Uint8Array||function(){},l=n(4);l.inherits=n(2);var d=n(137),f=void 0;f=d&&d.debuglog?d.debuglog("stream"):function(){};var p,g=n(138),y=n(61);l.inherits(v,c);var m=["error","close","destroy","pause","resume"];function b(e,t){o=o||n(13),e=e||{};var r=t instanceof o;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,s=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=n(9).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function v(e){if(o=o||n(13),!(this instanceof v))return new v(e);this._readableState=new b(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function w(e,t,n,r,i){var o,s=e._readableState;return null===t?(s.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,S(e)}}(e,s)):(i||(o=function(e,t){var n;return function(e){return h.isBuffer(e)||e instanceof u}(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===h.prototype||(t=function(e){return h.from(e)}(t)),r?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):_(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?_(e,s,t,!1):x(e,s)):_(e,s,t,!1))):r||(s.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function _(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&S(e)),x(e,t)}Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),v.prototype.destroy=y.destroy,v.prototype._undestroy=y.undestroy,v.prototype._destroy=function(e,t){this.push(null),t(e)},v.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=h.from(e,t),t=""),n=!0),w(this,e,t,!1,n)},v.prototype.unshift=function(e){return w(this,e,null,!0,!1)},v.prototype.isPaused=function(){return!1===this._readableState.flowing},v.prototype.setEncoding=function(e){return p||(p=n(9).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var C=8388608;function E(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=C?e=C:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function S(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(k,e):k(e))}function k(e){f("emit readable"),e.emit("readable"),A(e)}function x(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(F,e,t))}function F(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function R(e){f("readable nexttick read 0"),e.read(0)}function M(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),A(e),t.flowing&&!t.reading&&e.read(0)}function A(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function T(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0==(e-=s)){s===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=h.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,s),0==(e-=s)){s===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++i}return t.length-=i,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function P(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(I,t,e))}function I(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function O(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}v.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?P(this):S(this),null;if(0===(e=E(e,t))&&t.ended)return 0===t.length&&P(this),null;var r,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=E(n,t))),null===(r=e>0?T(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&P(this)),null!==r&&this.emit("data",r),r},v.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},v.prototype.pipe=function(e,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,f("pipe count=%d opts=%j",o.pipesCount,t);var c=t&&!1===t.end||e===r.stdout||e===r.stderr?b:h;function h(){f("onend"),e.end()}o.endEmitted?i.nextTick(c):n.once("end",c),e.on("unpipe",function t(r,i){f("onunpipe"),r===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,f("cleanup"),e.removeListener("close",y),e.removeListener("finish",m),e.removeListener("drain",u),e.removeListener("error",g),e.removeListener("unpipe",t),n.removeListener("end",h),n.removeListener("end",b),n.removeListener("data",p),l=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||u())});var u=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,A(e))}}(n);e.on("drain",u);var l=!1,d=!1;function p(t){f("ondata"),d=!1,!1!==e.write(t)||d||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==O(o.pipes,e))&&!l&&(f("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,d=!0),n.pause())}function g(t){f("onerror",t),b(),e.removeListener("error",g),0===a(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",m),b()}function m(){f("onfinish"),e.removeListener("close",y),b()}function b(){f("unpipe"),n.unpipe(e)}return n.on("data",p),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",y),e.once("finish",m),e.emit("pipe",n),o.flowing||(f("pipe resume"),n.resume()),e},v.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,n);return this}var s=O(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},v.prototype.on=function(e,t){var n=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&S(this):i.nextTick(R,this))}return n},v.prototype.addListener=v.prototype.on,v.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(M,e,t))}(this,e)),this},v.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},v.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",function(){if(f("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){f("wrapped data"),n.decoder&&(i=n.decoder.write(i)),(!n.objectMode||null!==i&&void 0!==i)&&(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<m.length;o++)e.on(m[o],this.emit.bind(this,m[o]));return this._read=function(t){f("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(v.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),v._fromList=T}).call(this,n(0),n(1))},function(e,t,n){e.exports=n(3).EventEmitter},function(e,t,n){"use strict";var r=n(6);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";e.exports=o;var r=n(13),i=n(4);function o(e){if(!(this instanceof o))return new o(e);r.call(this,e),this._transformState={afterTransform:function(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",s)}function s(){var e=this;"function"==typeof this._flush?this._flush(function(t,n){a(e,t,n)}):a(this,null,null)}function a(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=n(2),i.inherits(o,r),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,function(e){t(e),n.emit("close")})}},function(e,t,n){"use strict";const r=n(3),i=n(64),o=n(12)("foglet-core:signaling"),s=n(5),a=n(8);e.exports=class extends r{constructor(e,t){if(super(),!(e&&t&&t.address&&t.room))throw o(t),new SyntaxError("Not enough parameters, need a source an address and a room.");this.options=s({address:"http://localhost:3000/",origins:"*",room:a(),timeout:2e4,io:i,reconnectionAttempts:10},t),o("Signaling options: ",this.options),this._network=e,this._id=this._network.id,this._source=e.rps,this._socket=this.options.io(this.options.address,{autoConnect:!1,origins:this.options.origins,reconnectionAttempts:this.options.reconnectionAttempts,timeout:this.options.timeout}),this._socket.on("connect_timeout",e=>{this.unsignaling(),this._manageTimeout(e)}),this._socket.on("connect_error",e=>{this.unsignaling(),this._manageConnectionError(e)}),this._socket.on("error",e=>{this.unsignaling(),this._manageError(e)}),this._socket.on("disconnect",e=>{this._manageDisconnection(e)}),this._socket.on("new_spray",e=>{o("Receive a new offer: ",e),this._source.connect(e=>{o("Emit the accepted offer: ",e),this._socket.emit("accept",{id:this._id,offer:e,room:this.options.room})},e)}),this._socket.on("accept_spray",e=>{o("Receive an accepted offer: ",e),this._source.connect(e)})}connection(e=null,t=this.options.timeout){return null===e&&null===this._socket?Promise.reject(new Error("There is no available connection to the server. Try to use the function signaling() before.")):new Promise((n,r)=>{const i=setTimeout(()=>{r(new Error("connection timed out."))},t),s=(e=!1)=>{clearTimeout(i),n({connected:!0,alone:e})},a=e=>{"connected"===e?s():(clearTimeout(i),r(e))};try{e?this._source.join(this.direct(this._network.rps,e.rps)).then(()=>{s()}).catch(a):(o("Connecting to the room "+this.options.room+"..."),this._socket.emit("joinRoom",{id:this._id,room:this.options.room}),this._socket.on("joinedRoom",e=>{e.connected?s(!0):(this._source.join(this._signalingInit()).then(()=>{this._socket.emit("connected",{id:this._id,room:this.options.room})}).catch(a),this._socket.once("connected",()=>{o("Peer connected."),s()})),o("Connected to the room: "+this.options.room)}))}catch(e){r(e)}})}signaling(){o("Connection to the signaling server..."),this._socket.open()}unsignaling(){o("Disconnection from the signaling server..."),this._socket.emit("disconnect"),this._socket.removeAllListeners("connected"),this._socket.removeAllListeners("joinedRoom"),this._socket.close()}direct(e,t){return n=>{t.connect(t=>{e.connect(t)},n)}}_signalingInit(){console.log(this._id);const e=this;return t=>{o("Emit a new offer."),this._socket.emit("new",{id:e._id,tid:a(),offer:t,room:this.options.room})}}_manageTimeout(e){o(e)}_manageError(e){o(e)}_manageDisconnection(e){o(e)}_manageConnectionError(e){o(e)}}},function(e,t,n){var r=n(147),i=n(37),o=n(68),s=n(26)("socket.io-client");e.exports=t=c;var a=t.managers={};function c(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,i=r(e),c=i.source,h=i.id,u=i.path,l=a[h]&&u in a[h].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||l?(s("ignoring socket cache for %s",c),n=o(c,t)):(a[h]||(s("new io instance for %s",c),a[h]=o(c,t)),n=a[h]),i.query&&!t.query&&(t.query=i.query),n.socket(i.path,t)}t.protocol=i.protocol,t.connect=c,t.Manager=n(68),t.Socket=n(74)},function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,i=e.indexOf("["),o=e.indexOf("]");-1!=i&&-1!=o&&(e=e.substring(0,i)+e.substring(i,o).replace(/:/g,";")+e.substring(o,e.length));for(var s=n.exec(e||""),a={},c=14;c--;)a[r[c]]=s[c]||"";return-1!=i&&-1!=o&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){(function(t){e.exports=function(e){return n&&t.Buffer.isBuffer(e)||r&&(e instanceof t.ArrayBuffer||i(e))};var n="function"==typeof t.Buffer&&"function"==typeof t.Buffer.isBuffer,r="function"==typeof t.ArrayBuffer,i=r&&"function"==typeof t.ArrayBuffer.isView?t.ArrayBuffer.isView:function(e){return e.buffer instanceof t.ArrayBuffer}}).call(this,n(0))},function(e,t,n){var r=n(154),i=n(74),o=n(17),s=n(37),a=n(75),c=n(76),h=n(26)("socket.io-client:manager"),u=n(73),l=n(171),d=Object.prototype.hasOwnProperty;function f(e,t){if(!(this instanceof f))return new f(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||s;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}e.exports=f,f.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)d.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},f.prototype.updateSocketIds=function(){for(var e in this.nsps)d.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},f.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},o(f.prototype),f.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},f.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},f.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},f.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},f.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},f.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},f.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},f.prototype.open=f.prototype.connect=function(e,t){if(h("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;h("opening %s",this.uri),this.engine=r(this.uri,this.opts);var n=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var o=a(n,"open",function(){i.onopen(),e&&e()}),s=a(n,"error",function(t){if(h("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else i.maybeReconnectOnOpen()});if(!1!==this._timeout){var c=this._timeout;h("connect attempt will timeout after %d",c);var u=setTimeout(function(){h("connect attempt timed out after %d",c),o.destroy(),n.close(),n.emit("error","timeout"),i.emitAll("connect_timeout",c)},c);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(o),this.subs.push(s),this},f.prototype.onopen=function(){h("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(a(e,"data",c(this,"ondata"))),this.subs.push(a(e,"ping",c(this,"onping"))),this.subs.push(a(e,"pong",c(this,"onpong"))),this.subs.push(a(e,"error",c(this,"onerror"))),this.subs.push(a(e,"close",c(this,"onclose"))),this.subs.push(a(this.decoder,"decoded",c(this,"ondecoded")))},f.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},f.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},f.prototype.ondata=function(e){this.decoder.add(e)},f.prototype.ondecoded=function(e){this.emit("packet",e)},f.prototype.onerror=function(e){h("error",e),this.emitAll("error",e)},f.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new i(this,e,t),this.nsps[e]=n;var r=this;n.on("connecting",o),n.on("connect",function(){n.id=r.generateId(e)}),this.autoConnect&&o()}function o(){~u(r.connecting,n)||r.connecting.push(n)}return n},f.prototype.destroy=function(e){var t=u(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},f.prototype.packet=function(e){h("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(n){for(var r=0;r<n.length;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()}))},f.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},f.prototype.cleanup=function(){h("cleanup");for(var e=this.subs.length,t=0;t<e;t++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},f.prototype.close=f.prototype.disconnect=function(){h("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},f.prototype.onclose=function(e){h("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},f.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)h("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();h("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(h("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(h("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(h("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},f.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,n){(function(e){var r=n(38),i=n(157),o=n(167),s=n(168);t.polling=function(t){var n=!1,s=!1,a=!1!==t.jsonp;if(e.location){var c="https:"===location.protocol,h=location.port;h||(h=c?443:80),n=t.hostname!==location.hostname||h!==t.port,s=t.secure!==c}if(t.xdomain=n,t.xscheme=s,"open"in new r(t)&&!t.forceJSONP)return new i(t);if(!a)throw new Error("JSONP disabled");return new o(t)},t.websocket=s}).call(this,n(0))},function(e,t,n){var r=n(39),i=n(27),o=n(18),s=n(28),a=n(72),c=n(29)("engine.io-client:polling");e.exports=u;var h=null!=new(n(38))({xdomain:!1}).responseType;function u(e){var t=e&&e.forceBase64;h&&!t||(this.supportsBinary=!1),r.call(this,e)}s(u,r),u.prototype.name="polling",u.prototype.doOpen=function(){this.poll()},u.prototype.pause=function(e){var t=this;function n(){c("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(c("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){c("pre-pause polling complete"),--r||n()})),this.writable||(c("we are currently writing - waiting to pause"),r++,this.once("drain",function(){c("pre-pause writing complete"),--r||n()}))}else n()},u.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},u.prototype.onData=function(e){var t=this;c("polling got data %s",e),o.decodePayload(e,this.socket.binaryType,function(e,n,r){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},u.prototype.doClose=function(){var e=this;function t(){c("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),t()):(c("transport not open - deferring close"),this.once("open",t))},u.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};o.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},u.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=a()),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},function(e,t,n){(function(t){var r=n(159),i=Object.prototype.toString,o="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),s="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);e.exports=function e(n){if(!n||"object"!=typeof n)return!1;if(r(n)){for(var i=0,a=n.length;i<a;i++)if(e(n[i]))return!0;return!1}if("function"==typeof t&&t.isBuffer&&t.isBuffer(n)||"function"==typeof ArrayBuffer&&n instanceof ArrayBuffer||o&&n instanceof Blob||s&&n instanceof File)return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return e(n.toJSON(),!0);for(var c in n)if(Object.prototype.hasOwnProperty.call(n,c)&&e(n[c]))return!0;return!1}}).call(this,n(10).Buffer)},function(e,t,n){"use strict";var r,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),o=64,s={},a=0,c=0;function h(e){var t="";do{t=i[e%o]+t,e=Math.floor(e/o)}while(e>0);return t}function u(){var e=h(+new Date);return e!==r?(a=0,r=e):e+"."+h(a++)}for(;c<o;c++)s[i[c]]=c;u.encode=h,u.decode=function(e){var t=0;for(c=0;c<e.length;c++)t=t*o+s[e.charAt(c)];return t},e.exports=u},function(e,t){var n=[].indexOf;e.exports=function(e,t){if(n)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}},function(e,t,n){var r=n(37),i=n(17),o=n(170),s=n(75),a=n(76),c=n(26)("socket.io-client:socket"),h=n(27),u=n(71);e.exports=f;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},d=i.prototype.emit;function f(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}i(f.prototype),f.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[s(e,"open",a(this,"onopen")),s(e,"packet",a(this,"onpacket")),s(e,"close",a(this,"onclose"))]}},f.prototype.open=f.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},f.prototype.send=function(){var e=o(arguments);return e.unshift("message"),this.emit.apply(this,e),this},f.prototype.emit=function(e){if(l.hasOwnProperty(e))return d.apply(this,arguments),this;var t=o(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:u(t))?r.BINARY_EVENT:r.EVENT,data:t,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},f.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},f.prototype.onopen=function(){if(c("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?h.encode(this.query):this.query;c("sending connect packet with query %s",e),this.packet({type:r.CONNECT,query:e})}else this.packet({type:r.CONNECT})},f.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},f.prototype.onpacket=function(e){var t=e.nsp===this.nsp,n=e.type===r.ERROR&&"/"===e.nsp;if(t||n)switch(e.type){case r.CONNECT:this.onconnect();break;case r.EVENT:case r.BINARY_EVENT:this.onevent(e);break;case r.ACK:case r.BINARY_ACK:this.onack(e);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",e.data)}},f.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?d.apply(this,t):this.receiveBuffer.push(t)},f.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var i=o(arguments);c("sending ack %j",i),t.packet({type:u(i)?r.BINARY_ACK:r.ACK,id:e,data:i})}}},f.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(c("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):c("bad ack %s",e.id)},f.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},f.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)d.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},f.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},f.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},f.prototype.close=f.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},f.prototype.compress=function(e){return this.flags.compress=e,this},f.prototype.binary=function(e){return this.flags.binary=e,this}},function(e,t){e.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},function(e,t){var n=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return t.apply(e,r.concat(n.call(arguments)))}}},function(e,t,n){"use strict";const r=n(22),i=n(172),o=n(5);e.exports=class extends r{constructor(e){super(o({webrtc:{trickle:!0,config:{iceServers:[]}},origins:"*"},e))}_buildRPS(e){const t=o({config:e.webrtc},e);return new i(t)}get inviewId(){return this._rps.getInviewId()}get outviewId(){return this._rps.getOutviewId()}getReachableNeighbours(e=!0){return this._rps.uniqNeighbours(e)}getNeighbours(e){return this._rps.getPeers(e)}getArcs(){const e=this._rps.neighbours(),t=e.inview.map(e=>e.peer),n=e.inview.map(e=>e.peer);return t.concat(n)}}},function(e,t,n){"use strict";(function(t,r){var i=n(6);e.exports=v;var o,s=n(20);v.ReadableState=b,n(3).EventEmitter;var a=function(e,t){return e.listeners(t).length},c=n(79),h=n(7).Buffer,u=t.Uint8Array||function(){},l=n(4);l.inherits=n(2);var d=n(186),f=void 0;f=d&&d.debuglog?d.debuglog("stream"):function(){};var p,g=n(187),y=n(80);l.inherits(v,c);var m=["error","close","destroy","pause","resume"];function b(e,t){o=o||n(19),e=e||{};var r=t instanceof o;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,s=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=n(9).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function v(e){if(o=o||n(19),!(this instanceof v))return new v(e);this._readableState=new b(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function w(e,t,n,r,i){var o,s=e._readableState;return null===t?(s.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,S(e)}}(e,s)):(i||(o=function(e,t){var n;return function(e){return h.isBuffer(e)||e instanceof u}(t)||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===h.prototype||(t=function(e){return h.from(e)}(t)),r?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):_(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?_(e,s,t,!1):x(e,s)):_(e,s,t,!1))):r||(s.reading=!1)),function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function _(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&S(e)),x(e,t)}Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),v.prototype.destroy=y.destroy,v.prototype._undestroy=y.undestroy,v.prototype._destroy=function(e,t){this.push(null),t(e)},v.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=h.from(e,t),t=""),n=!0),w(this,e,t,!1,n)},v.prototype.unshift=function(e){return w(this,e,null,!0,!1)},v.prototype.isPaused=function(){return!1===this._readableState.flowing},v.prototype.setEncoding=function(e){return p||(p=n(9).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var C=8388608;function E(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=C?e=C:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function S(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(k,e):k(e))}function k(e){f("emit readable"),e.emit("readable"),A(e)}function x(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(F,e,t))}function F(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function R(e){f("readable nexttick read 0"),e.read(0)}function M(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),A(e),t.flowing&&!t.reading&&e.read(0)}function A(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function T(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0==(e-=s)){s===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=h.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,s),0==(e-=s)){s===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++i}return t.length-=i,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function P(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(I,t,e))}function I(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function O(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}v.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?P(this):S(this),null;if(0===(e=E(e,t))&&t.ended)return 0===t.length&&P(this),null;var r,i=t.needReadable;return f("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",i=!0),t.ended||t.reading?f("reading or ended",i=!1):i&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=E(n,t))),null===(r=e>0?T(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&P(this)),null!==r&&this.emit("data",r),r},v.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},v.prototype.pipe=function(e,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,f("pipe count=%d opts=%j",o.pipesCount,t);var c=t&&!1===t.end||e===r.stdout||e===r.stderr?b:h;function h(){f("onend"),e.end()}o.endEmitted?i.nextTick(c):n.once("end",c),e.on("unpipe",function t(r,i){f("onunpipe"),r===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,f("cleanup"),e.removeListener("close",y),e.removeListener("finish",m),e.removeListener("drain",u),e.removeListener("error",g),e.removeListener("unpipe",t),n.removeListener("end",h),n.removeListener("end",b),n.removeListener("data",p),l=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||u())});var u=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,A(e))}}(n);e.on("drain",u);var l=!1,d=!1;function p(t){f("ondata"),d=!1,!1!==e.write(t)||d||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==O(o.pipes,e))&&!l&&(f("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,d=!0),n.pause())}function g(t){f("onerror",t),b(),e.removeListener("error",g),0===a(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",m),b()}function m(){f("onfinish"),e.removeListener("close",y),b()}function b(){f("unpipe"),n.unpipe(e)}return n.on("data",p),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",g),e.once("close",y),e.once("finish",m),e.emit("pipe",n),o.flowing||(f("pipe resume"),n.resume()),e},v.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,n);return this}var s=O(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},v.prototype.on=function(e,t){var n=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&S(this):i.nextTick(R,this))}return n},v.prototype.addListener=v.prototype.on,v.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(M,e,t))}(this,e)),this},v.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},v.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",function(){if(f("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(i){f("wrapped data"),n.decoder&&(i=n.decoder.write(i)),(!n.objectMode||null!==i&&void 0!==i)&&(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))}),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<m.length;o++)e.on(m[o],this.emit.bind(this,m[o]));return this._read=function(t){f("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(v.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),v._fromList=T}).call(this,n(0),n(1))},function(e,t,n){e.exports=n(3).EventEmitter},function(e,t,n){"use strict";var r=n(6);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";(function(t,r,i){var o=n(6);function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(void 0),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=b;var a,c=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:o.nextTick;b.WritableState=m;var h=n(4);h.inherits=n(2);var u,l={deprecate:n(21)},d=n(79),f=n(7).Buffer,p=i.Uint8Array||function(){},g=n(80);function y(){}function m(e,t){a=a||n(19),e=e||{};var r=t instanceof a;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,h=e.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(h||0===h)?h:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var l=!1===e.decodeStrings;this.decodeStrings=!l,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(o.nextTick(i,r),o.nextTick(S,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),S(e,t))}(e,n,r,t,i);else{var s=C(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||_(e,n),r?c(w,e,n,s,i):w(e,n,s,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function b(e){if(a=a||n(19),!(u.call(b,this)||this instanceof a))return new b(e);this._writableState=new m(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),d.call(this)}function v(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function w(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),S(e,t)}function _(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var a=0,c=!0;n;)i[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;i.allBuffers=c,v(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var h=n.chunk,u=n.encoding,l=n.callback;if(v(e,t,!1,t.objectMode?1:h.length,h,u,l),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function C(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function E(e,t){e._final(function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),S(e,t)})}function S(e,t){var n=C(t);return n&&(function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(E,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}h.inherits(b,d),m.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(m.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(e){return!!u.call(this,e)||this===b&&e&&e._writableState instanceof m}})):u=function(e){return e instanceof this},b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},b.prototype.write=function(e,t,n){var r=this._writableState,i=!1,s=!r.objectMode&&function(e){return f.isBuffer(e)||e instanceof p}(e);return s&&!f.isBuffer(e)&&(e=function(e){return f.from(e)}(e)),"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=y),r.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),o.nextTick(t,n)}(this,n):(s||function(e,t,n,r){var i=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),o.nextTick(r,s),i=!1),i}(this,r,e,n))&&(r.pendingcb++,i=function(e,t,n,r,i,o){if(!n){var s=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=f.from(t,n)),t}(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var h=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},h?h.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else v(e,t,!1,a,r,i,o);return c}(this,r,s,e,t,n)),i},b.prototype.cork=function(){this._writableState.corked++},b.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||_(this,e))},b.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(b.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),b.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,S(e,t),n&&(t.finished?o.nextTick(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),b.prototype.destroy=g.destroy,b.prototype._undestroy=g.undestroy,b.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(1),n(25).setImmediate,n(0))},function(e,t,n){"use strict";e.exports=o;var r=n(19),i=n(4);function o(e){if(!(this instanceof o))return new o(e);r.call(this,e),this._transformState={afterTransform:function(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",s)}function s(){var e=this;"function"==typeof this._flush?this._flush(function(t,n){a(e,t,n)}):a(this,null,null)}function a(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=n(2),i.inherits(o,r),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},o.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,function(e){t(e),n.emit("close")})}},function(e,t,n){const r=n(22),i=n(213),o=n(5);e.exports=class extends r{constructor(e){super(o({webrtc:{trickle:!0,config:{iceServers:[]}},origins:"*"},e))}_buildRPS(e){const t=o({config:e.webrtc},e);return new i(t)}get inviewId(){return this._rps.getInviewId()}get outviewId(){return this._rps.getOutviewId()}getReachableNeighbours(e=!0){return this._rps.uniqNeighbours(e)}getNeighbours(e){return this._rps.getPeers(e)}getArcs(){const e=this._rps.neighbours(),t=e.inview.map(e=>e.peer),n=e.inview.map(e=>e.peer);return t.concat(n)}}},function(e,t,n){"use strict";const r=e=>e.replace(/(?:^\w|[A-Z]|\b\w)/g,(e,t)=>0===t?e.toLowerCase():e.toUpperCase()).replace(/\s+/g,""),i=e=>e[0].toUpperCase()+e.slice(1);e.exports={camelCase:r,capitalize:i,methodName:e=>r(e),handlerName:e=>`_${r(e)}`,beforeSendName:e=>`_beforeSend${i(r(e))}`,beforeReceiveName:e=>`_beforeReceive${i(r(e))}`,afterSendName:e=>`_afterSend${i(r(e))}`,afterReceiveName:e=>`_afterReceive${i(r(e))}`}},function(e,t,n){"use strict";const r=n(84);function i(e){return t=>{let n;return e.reduce((e,t)=>void 0===(n=t(e))||null===n?e:n,t)}}e.exports=class{constructor(e){this._serviceName=e,this._camelCasedName=r.camelCase(this._serviceName),this._capitalizedCamelCase=r.capitalize(this._camelCasedName)}get methodName(){return this._camelCasedName}get handlerName(){return`_${this._camelCasedName}`}get beforeSendName(){return`_beforeSend${this._capitalizedCamelCase}`}get beforeReceiveName(){return`_beforeReceive${this._capitalizedCamelCase}`}get afterSendName(){return`_afterSend${this._capitalizedCamelCase}`}get afterReceiveName(){return`_afterReceive${this._capitalizedCamelCase}`}buildService(e){throw new Error("A valid Builder must implement a valid buildService method")}buildHandler(e,t){e.prototype[this.handlerName]=t}buildBeforeHooks(e,t){t.send.length>0&&(e.prototype[this.beforeSendName]=i(t.send)),t.receive.length>0&&(e.prototype[this.beforeReceiveName]=i(t.receive))}buildAfterHooks(e,t){t.send.length>0&&(e.prototype[this.afterSendName]=i(t.send)),t.receive.length>0&&(e.prototype[this.afterReceiveName]=i(t.receive))}}},function(e,t,n){(function(e,n){var r=9007199254740991,i="[object Arguments]",o="[object Function]",s="[object GeneratorFunction]",a="[object Map]",c="[object Set]",h=/^\[object .+?Constructor\]$/,u="object"==typeof e&&e&&e.Object===Object&&e,l="object"==typeof self&&self&&self.Object===Object&&self,d=u||l||Function("return this")(),f="object"==typeof t&&t&&!t.nodeType&&t,p=f&&"object"==typeof n&&n&&!n.nodeType&&n,g=p&&p.exports===f,y=Function.prototype,m=Object.prototype,b=d["__core-js_shared__"],v=function(){var e=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),w=y.toString,_=m.hasOwnProperty,C=m.toString,E=RegExp("^"+w.call(_).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),S=g?d.Buffer:void 0,k=m.propertyIsEnumerable,x=S?S.isBuffer:void 0,F=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object),R=L(d,"DataView"),M=L(d,"Map"),A=L(d,"Promise"),T=L(d,"Set"),P=L(d,"WeakMap"),I=!k.call({valueOf:1},"valueOf"),O=q(R),j=q(M),D=q(A),B=q(T),N=q(P);function L(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!$(e)||function(e){return!!v&&v in e}(e))&&(H(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?E:h).test(q(e))}(n)?n:void 0}var U=function(e){return C.call(e)};function q(e){if(null!=e){try{return w.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(R&&"[object DataView]"!=U(new R(new ArrayBuffer(1)))||M&&U(new M)!=a||A&&"[object Promise]"!=U(A.resolve())||T&&U(new T)!=c||P&&"[object WeakMap]"!=U(new P))&&(U=function(e){var t=C.call(e),n="[object Object]"==t?e.constructor:void 0,r=n?q(n):void 0;if(r)switch(r){case O:return"[object DataView]";case j:return a;case D:return"[object Promise]";case B:return c;case N:return"[object WeakMap]"}return t});var W=Array.isArray;function z(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}(e.length)&&!H(e)}var V=x||function(){return!1};function H(e){var t=$(e)?C.call(e):"";return t==o||t==s}function $(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}n.exports=function(e){if(z(e)&&(W(e)||"string"==typeof e||"function"==typeof e.splice||V(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&z(e)}(e)&&_.call(e,"callee")&&(!k.call(e,"callee")||C.call(e)==i)}(e)))return!e.length;var t=U(e);if(t==a||t==c)return!e.size;if(I||function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||m)}(e))return!F(e).length;for(var n in e)if(_.call(e,n))return!1;return!0}}).call(this,n(0),n(23)(e))},function(e,t,n){(function(r){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&"%c"===e&&(i=++r)}),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(239)(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(1))},function(e,t,n){"use strict";e.exports=class{constructor(e,t){this.peer=e,this.descriptor=t,this.type="MUpdateCache"}}},function(e,t){e.exports=class{constructor(e=null,t=1e4){this.template=e,this.leaderOfCible=new Map,setInterval(()=>{this.doLeaderElection()},t),this.ranking=((e,t)=>(t,n)=>{const r=(e,t)=>{const{x:n,y:r,z:i}=e,{x:o,y:s,z:a}=t,c=n-o,h=r-s;return Math.sqrt(c*c+h*h)},i=r(e,t),o=r(e,n);if(i===o){if(t.id<n.id)return-1;if(t.id>=n.id)return 1}return i-o})}doLeaderElection(){if(!this.template)return;let e=Array.from(this.template.foglet._networkManager._overlays.keys());Array.from(this.template.foglet._networkManager._overlays.values()).forEach((t,n)=>{let r=t._network,i=r._rps,o=Array.from(i.partialView.values()).map(e=>{let t=e.descriptor;return t.peer=e.peer,t}),s=JSON.parse(JSON.stringify(i.options.descriptor));s.peer=r.inviewId,o.push(s);let a=this.template.targets.filter(t=>t.id===e[n]);a.length>0&&(a=a[0]),Array.from(this.leaderOfCible.keys(),t=>{-1===e.indexOf(t)&&this.leaderOfCible.delete(t)}),o.length>0&&(o.sort(this.ranking(a.getCoordinates())),this.leaderOfCible.set(a.id,o[0]))})}getLeaders(){return Array.from(this.leaderOfCible.values()).map(e=>e.peer||e.id)}isLeader(e){const t=this.leaderOfCible.get(e);return!!t&&t.peer==this.template.foglet.inViewID}getLeader(e){return this.leaderOfCible.get(e)}}},function(e,t,n){e.exports={template:n(91),target:n(240),Leader:n(89),paxos:n(259)}},function(e,t,n){const r=n(31).Foglet,i=n(5),o=n(87)("template"),s=n(3);n(40),e.exports=class extends s{constructor(e,t=!1){super(),this.options=i({foglet:{verbose:!0,rps:{type:"cyclon",options:{protocol:"foglet-template",webrtc:{trickle:!0,config:{iceServers:[]}},timeout:2e3,pendingTimeout:5e3,delta:1e3,maxPeers:100,a:1,b:2,signaling:{address:"https://signaling.herokuapp.com/",room:"room-foglet-template"}}},overlays:[],ssh:void 0}},e),t&&(this.options.foglet.rps.options.socketClass=n(31).SimplePeerMoc),this.foglet=new r(this.options.foglet),this.foglet.overlay().network.rps.on("open",e=>{o("[%s] connection opened on the rps: ",this.foglet.inViewID,e),this.emit("rps-open",e)}),this.foglet.overlay().network.rps.on("close",e=>{o("[%s] connection closed on the rps: ",this.foglet.inViewID,e),this.emit("rps-close",e)}),this.handlers={},o("Template initialized."),this.targets=[],this.on("descriptor-updated",e=>{const t=e.descriptor;this.targets.forEach(e=>{if(e.isNearby(t)){if(this.foglet.overlay(e.id))return;this.buildOverlay(i(e.getOverlay(),{options:{descriptor:t}}))}else this.foglet.overlay(e.id)&&(console.log("leave overlay"),this.leaveOverlay(e.id,e))})})}connection(e,t=null){return e?this.foglet.connection(e.foglet,t):(this.foglet.share(),this.foglet.connection(null,t))}sendUnicast(e,t){return this.foglet.sendUnicast(e,t)}sendUnicastAll(e){this.neighbours().forEach(t=>{this.sendUnicast(t,e)})}sendOverlayUnicast(e,t,n){return n.context=e,this.foglet.overlay(e).communication.sendUnicast(t,n)}sendOverlayUnicastAll(e,t){this.neighboursOverlay(e).forEach(n=>{this.sendOverlayUnicast(e,n,t)})}neighbours(){return this.foglet.getNeighbours()}neighboursOverlay(e){return this.foglet.overlay(e).network.getNeighbours()}updateDescriptor(e,t){if(this.descriptor.x=e.x,this.descriptor.y=e.y,this.descriptor.z=e.z,!t)return console.log("please specify an overlay");let n=this.descriptor;this.foglet.overlay(t)&&((n=this.foglet.overlay(t).network.descriptor=this.foglet.overlay(t).network.options.descriptor).x=e.x,n.y=e.y,n.z=e.z),this.emit("descriptor-updated",{id:this.foglet.inViewID,descriptor:n})}buildOverlay(e){return this.foglet._networkManager._buildOverlay(e),this.foglet.overlay(e.name).network.rps.on("open",t=>{o("[%s] connection opened on the rps: ",this.foglet.inViewID,t),this.emit(e.name+"-open",t),this.emit("overlay-open",e.name)}),this.foglet.overlay(e.name).network.rps.on("close",t=>{o("[%s] connection closed on the rps: ",this.foglet.inViewID,t),this.emit(e.name+"-close",t),this.emit("overlay-close",e.name)}),this.foglet.overlay(e.name)._network._rps._start(),Promise.resolve()}leaveOverlay(e,t){return this.foglet.overlay(e)._network.getNeighbours().forEach(t=>{this.foglet.overlay(e)._network._rps.disconnect(t)}),Promise.resolve()}targetSpawned(e){if(this.targets.push(e),e.isNearby(this.getDescriptor()))return this.buildOverlay(i(e.getOverlay(),{options:{descriptor:this.getDescriptor()}})),this.emit("target-spawned",e.id),!0}getLeader(e){return this.foglet.overlay(e).network.options.target.leader}getDescriptor(){return this.descriptor}setDescriptor(e){this.descriptor=e}getOverlays(){return Array.from(this.foglet._networkManager._overlays.keys())}handleUnicast(e){this.foglet.overlay(e).communication.onUnicast((t,n)=>{if(!n.type&&!n.context)return;const r=this.handlers[e][n.type];r&&Array.isArray(r)&&r.forEach(e=>{e(t,n)})})}addHandler(e,t,n){this.handlers[n]||(this.handlers[n]={}),this.handlers[n][e]?this.handlers[n][e].push(t):this.handlers[n][e]=[t]}}},function(e,t,n){"use strict";const r=n(3),i=n(8),o=n(5),s=n(95),a=n(145),c=n(215);e.exports=class extends r{constructor(e={}){super(),this._options=o({verbose:!0,rps:{type:"cyclon",options:{protocol:"foglet-example-rps",webrtc:{trickle:!0,config:{iceServers:[]}},timeout:5e3,pendingTimeout:6e4,delta:6e4,maxPeers:5,a:1,b:5,signaling:{address:"https://signaling.herokuapp.com/",room:"best-room-for-foglet-rps"}}},overlays:[],ssh:void 0},e),this._options.id||(this._options.id=i()),this._options.rps.options.peer=this._options.id,this._id=this._options.id,this._networkManager=new a(this._options),this._options.ssh&&this._options.ssh.address&&(this._ssh=new c({foglet:this,address:this._options.ssh.address}))}get id(){return this._id}get inViewID(){return this.overlay().network.inviewId}get outViewID(){return this.overlay().network.outviewId}connection(e=null,t=null,n=this._options.pendingTimeout){return new Promise((r,i)=>{null!==e?this.overlay(t).signaling.connection(e.overlay(t).network,n).then(e=>{this.emit("connect"),r(e.connected)}).catch(e=>{i(e)}):this.overlay(t).signaling.connection(null,n).then(e=>{this.emit("connect"),r(e.connected)}).catch(e=>{i(e)})})}share(e=null){this.overlay(e).signaling.signaling()}unshare(e=null){this.overlay(e).signaling.unsignaling()}overlay(e=null){return this._networkManager.overlay(e)}use(e,t=0){this._networkManager.registerMiddleware(e,t)}onBroadcast(e){this.overlay().communication.onBroadcast(e)}onStreamBroadcast(e){this.overlay().communication.onStreamBroadcast(e)}sendBroadcast(e){return this.overlay().communication.sendBroadcast(e)}streamBroadcast(e){return this.overlay().communication.streamBroadcast(e)}onUnicast(e){this.overlay().communication.onUnicast(e)}onStreamUnicast(e){this.overlay().communication.onStreamUnicast(e)}sendUnicast(e,t){return this.overlay().communication.sendUnicast(e,t)}streamUnicast(e){return this.overlay().communication.streamUnicast(e)}sendMulticast(e=[],t){return this.overlay().communication.sendMulticast(e,t)}createMedia(e=null,t={}){return console.warn("[Warning] these methods are experimental."),new s(this.overlay(e).network,this.overlay(e).network.protocol,t)}getRandomNeighbourId(){const e=this.overlay().network.getNeighbours();if(0===e.length)return null;try{return e[Math.floor(Math.random()*e.length)]}catch(e){return console.error(e),null}}getArcs(e){return this.overlay(void 0).network.getArcs()}getReachableNeighbours(e=!0,t){return this.overlay(t).network.getReachableNeighbours(e)}getNeighbours(e,t){return this.overlay(t).network.getNeighbours(e)}}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},function(e,t,n){const r=n(32),i=n(33),o=n(12)("foglet-core:media"),s=n(8),a=n(5),c=n(122),h=n(129),u=n(136);e.exports=class extends r{constructor(e,t,n){super(e,`foglet-media-internal-${t}`),this.options={chunkSize:16e3},this._activeMedia=new Map,this._activeStream=new Map,this._communication=new i(e,`foglet-media-internal-${t}`),this.NI=this._source.rps.NI,this.NO=this._source.rps.NO,this.i=this._source.rps.i,this.o=this._source.rps.o,this._source.rps.on("stream",(e,t)=>{this._receive(e,t)}),this._communication.onStreamBroadcast((e,t)=>{o("Receive a media stream: ",e,t),this._reconstruct(t)})}get pid(){return this._source.rps._pid()}sendUnicast(e,t){return t.id||(t.id=s()),this._activeMedia.has(t.id)||(this._activeMedia.set(t.id,t),this._setListeners(t)),this._source.rps.stream(e,t)}sendBroadcastOverDataChannel(e,t={}){let n;t=a({mimeType:'video/webm; codecs="vp8"',interval:100,bitsPerSecond:131072},t),e.id||(e.id=s()),this._activeMedia.has(e.id)||(this._activeMedia.set(e.id,e),this._setListeners(e)),console.log(e,t);try{n=new c(e,t)}catch(e){throw new Error("Error when recording the media: ",e)}const r=this._communication.streamBroadcast();t.id=e.id,r.write(t),n.on("data",e=>{const t=this.chunkify(JSON.stringify(e));if(0===t.length)r.write({type:"full",id:0,payload:t[0]});else for(let e=0;e<t.length;e++)e===t.length-1?r.write({type:"end",id:e,payload:t[e]}):r.write({type:"chunk",id:e,payload:t[e]})}),n.on("end",()=>{r.end()})}_reconstruct(e,t=null){new class extends u.Readable{constructor(e,t,n){super(n),this.source=e,this.parent=t,this.objectMode=!0,this.count=0;let r="";this.source.on("data",e=>{0===this.count?(this.parent._activeStream.has(e.id)||(o("Setting options for %s",e.id,e),this.parent._activeStream.set(e.id,{source:this,options:e})),this.parent.emit("receive",e.id),this.count++):"full"===e.type?(this.push(e.payload),this.count++):"end"===e.type?(r+=e.payload,this.push(new Uint8Array(JSON.parse(r).data)),this.count++,r=""):r+=e.payload}),this.source.on("end",()=>{this.end()})}_read(e){}}(e,this).on("error",e=>{console.error(e)})}getStreamMedia(e,t){if(!this._activeStream.has(e))return;const n=new h(t),r=n.createWriteStream(this._activeStream.get(e).options.mimeType);t.addEventListener("error",function(){var e=t.error,r=n.detailedError;console.error(e,r)}),r.on("error",function(e){console.error(e)}),this._activeStream.get(e).source.pipe(r)}_receive(e,t){o("Receive a media stream: ",e,t),t.id||(t.id=s()),this._activeMedia.has(t.id)||(this._activeMedia.set(t.id,{peer:e,stream:t}),this._setListeners(t)),this.emit("receive",e,t)}_setListeners(e){e.onactive=(()=>{console.log("Media %s is active...",e.id)}),e.oninactive=(()=>{console.log("Media %s is inactive... (Disconnection or a Shuffling occured.)",e.id)}),e.onended=(()=>{console.log("Media %s is finished...",e.id)})}chunkify(e,t=this.options.chunkSize){return e.match(new RegExp(".{1,"+t+"}","g"))}}},function(e,t,n){"use strict";const r=n(32);e.exports=class extends r{constructor(e,t){super(e,`foglet-unicast-protocol-${t}`)}}},function(e,t,n){"use strict";(function(r){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++r)}),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(98)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(1))},function(e,t,n){"use strict";e.exports=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){var n;function s(){if(s.enabled){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=s,a=Number(new Date),c=a-(n||a);o.diff=c,o.prev=n,o.curr=a,n=a,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var h=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,function(e,n){if("%%"===e)return e;h++;var i=r.formatters[n];if("function"==typeof i){var s=t[h];e=i.call(o,s),t.splice(h,1),h--}return e}),r.formatArgs.call(o,t),(o.log||r.log).apply(o,t)}}return s.namespace=e,s.enabled=r.enabled(e),s.useColors=r.useColors(),s.color=t(e),s.destroy=i,s.extend=o,"function"==typeof r.init&&r.init(s),r.instances.push(s),s}function i(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){return r(this.namespace+(void 0===t?":":t)+e)}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var o=r.instances[t];o.enabled=r.enabled(o.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(11),Object.keys(e).forEach(function(t){r[t]=e[t]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n){this.pid=e,this.event=t,this.args=n,this.type="MUnicast"}}},function(e,t,n){"use strict";const r=n(101),i=n(102),o=n(107),s=n(8),a=n(108),c=n(12)("foglet-core:broadcast");function h(e){return`e=${e.id.e}&c=${e.id.c}`}e.exports=class extends r{constructor(e,t){if(super(e,t),!e||!t)return new Error("Not enough parameters","fbroadcast.js");this.options={id:e.id,delta:3e4},this._causality=new i(this.options.id),this._buffer=[],this._bufferAntiEntropy=o.MAntiEntropyResponse("init")}_sendAll(e){const t=this._source.getNeighbours(1/0);t.length>0&&t.forEach(t=>{this._unicast.send(t,e).catch(e=>{c(e)})})}send(e,t,n,r=!0){const i=t||this._causality.increment();if(i.e!==this._causality.local.e)throw new Error("The id of the identifier need to be equal to: "+this._causality.local.e);if(i.c<this._causality.local.v)throw new Error("Cant send the message because the identifier has a counter lower than our local counter: need to be equal to "+this._causality.local.v+1);if(i.c>this._causality.local.v+1)throw new Error("Cant send the message because the identifier has a counter higher than the counter accepted: need to be equal to "+this._causality.local.v+1);let o=n;r&&!o&&i.c>1&&(o={e:i.e,c:i.c-1});const s=this._createBroadcastMessage(e,i,o);return this._causality.incrementFrom(i),this._sendAll(s),i}_createBroadcastMessage(e,t,n){return o.BroadcastMessage(this._protocol,t,n,e)}startAntiEntropy(e=this.options.delta){this._intervalAntiEntropy=setInterval(()=>{this._source.getNeighbours().forEach(e=>this._unicast.send(e,o.MAntiEntropyRequest(this._causality)))},e),this.on("antiEntropy",(e,t,n)=>this._defaultBehaviorAntiEntropy(e,t,n))}_defaultBehaviorAntiEntropy(e,t,n){c("(Warning) You should modify this, AntiEntropy default behavior: ",e,t,n)}clearAntiEntropy(){this._intervalAntiEntropy&&clearInterval(this._intervalAntiEntropy)}sendAntiEntropyResponse(e,t,n){let r=s(),i=this._unicast.send(e,o.MAntiEntropyResponse(r,t,n.length)),a=0;for(;i&&a<n.length;)i=this._unicast.send(e,o.MAntiEntropyResponse(r,null,n.length,n[a])),++a}_receive(e,t){switch("issuer"in t||(t.issuer=e),t.type){case"MAntiEntropyRequest":c(e,t),this.emit("antiEntropy",e,t.causality,this._causality.clone());break;case"MAntiEntropyResponse":if(this._bufferAntiEntropy.id!==t.id&&(this._bufferAntiEntropy=t),t.element&&this._bufferAntiEntropy.elements.push(t.element),t.causality&&(this._bufferAntiEntropy.causality=t.causality),this._bufferAntiEntropy.elements.length===this._bufferAntiEntropy.nbElements){for(let e=0;e<this._bufferAntiEntropy.elements.length;++e){let n=this._bufferAntiEntropy.elements[e];this._shouldStopPropagation(n)||(this._causality.incrementFrom(n.id),this.emit("receive",t.issuer,n.payload))}this._causality.merge(this._bufferAntiEntropy.causality)}break;default:if(!this._shouldStopPropagation(t)){const e=a(this._buffer,t,h);this._buffer.splice(e,0,t),this._reviewBuffer(),this._sendAll(t)}}}_shouldStopPropagation(e){return this._causality.isLower(e.id)||this._findInBuffer(h(e))>=0}_findInBuffer(e){let t,n,r=0,i=this._buffer.length-1;for(;r<=i;)if(t=(r+i)/2|0,(n=h(this._buffer[t]))<e)r=t+1;else{if(!(n>e))return t;i=t-1}return-1}_reviewBuffer(){let e,t=!1;for(let n=this._buffer.length-1;n>=0;--n)e=this._buffer[n],this._causality.isLower(e.id)?this._buffer.splice(n,1):this._causality.isReady(e.isReady)&&(t=!0,this._causality.incrementFrom(e.id),this._buffer.splice(n,1),this.emit("receive",e.issuer,e.payload));t&&this._reviewBuffer()}}},function(e,t,n){"use strict";const r=n(32),i=n(41);e.exports=class extends r{constructor(e,t){super(e,`foglet-broadcast-protocol-${t}`),this._unicast=new i(this._source,this._protocol),this._unicast.on("receive",(e,t)=>{this._receive(e,t)})}}},function(e,t,n){"use strict";const r=n(103),i=n(105),o=n(106);class s{constructor(e){this.local=new i(e),this.vector=new r(i.comparator),this.vector.insert(this.local)}clone(){const e=new s(this.local.e);for(let t=0;t<this.vector.arr.length;++t){e.vector.arr[t]=new i(this.vector.arr[t].e),e.vector.arr[t].v=this.vector.arr[t].v;for(let n=0;n<this.vector.arr[t].x.length;++n)e.vector.arr[t].x.push(this.vector.arr[t].x[n]);e.vector.arr[t].e===this.local.e&&(e.local=e.vector.arr[t])}return e}static fromJSON(e){const t=new s(e.local.e);for(let n=0;n<e.vector.arr.length;++n){t.vector.arr[n]=new i(e.vector.arr[n].e),t.vector.arr[n].v=e.vector.arr[n].v;for(let r=0;r<e.vector.arr[n].x.length;++r)t.vector.arr[n].x.push(e.vector.arr[n].x[r]);e.vector.arr[n].e===e.local.e&&(t.local=t.vector.arr[n])}return t}increment(){return this.local.increment(),new o(this.local.e,this.local.v)}incrementFrom(e){const t=this.vector.indexOf(e.e);t<0?(this.vector.insert(new i(e.e)),this.vector.arr[this.vector.indexOf(e.e)].incrementFrom(e.c)):this.vector.arr[t].incrementFrom(e.c)}isReady(e){if(void 0===e||null===e)return!0;const t=this.vector.indexOf(e.e);return t>=0&&e.c<=this.vector.arr[t].v&&this.vector.arr[t].x.indexOf(e.c)<0}isLower(e){return void 0!==e&&null!==e&&this.isReady(e)}merge(e){for(let t=0;t<e.vector.arr.length;++t){let n=e.vector.arr[t],r=this.vector.indexOf(n);if(r<0){let e=new i(n.e);e.v=n.v;for(let t=0;t<n.x.length;++t)e.x.push(n.x[t]);this.vector.insert(e)}else{let e=this.vector.arr[r],t=0;for(;t<e.x.length;)e.x[t]<n.v&&n.x.indexOf(e.x[t])<0?e.x.splice(t,1):++t;for(t=0;t<n.x.length;)n.x[t]>e.v&&e.x.indexOf(n.x[t])<0&&e.x.push(n.x[t]),++t;e.v=Math.max(e.v,n.v)}}}}e.exports=s},function(e,t,n){"use strict";e.exports=i;var r=n(104);function i(e,t){if("function"!=typeof e)throw new TypeError("comparator must be a function");this.arr=t||[],this.cmp=e}i.prototype.insert=function(e){var t=r(this.arr,e,this.cmp);t<0&&(t=~t),this.arr.splice(t,0,e)},i.prototype.indexOf=function(e){var t=r(this.arr,e,this.cmp);return t>=0?t:-1},i.prototype.remove=function(e){var t=r(this.arr,e,this.cmp);return!(t<0||(this.arr.splice(t,1),0))}},function(e,t){e.exports=function(e,t,n,r,i){var o,s;if(void 0===r)r=0;else if((r|=0)<0||r>=e.length)throw new RangeError("invalid lower bound");if(void 0===i)i=e.length-1;else if((i|=0)<r||i>=e.length)throw new RangeError("invalid upper bound");for(;r<=i;)if((s=+n(e[o=r+(i-r>>1)],t))<0)r=o+1;else{if(!(s>0))return o;i=o-1}return~r}},function(e,t,n){"use strict";e.exports=class{constructor(e){this.e=e,this.v=0,this.x=[]}increment(){this.v+=1}incrementFrom(e){if(e<this.v){const t=this.x.indexOf(e);t>=0&&this.x.splice(t,1)}if(e===this.v+1&&(this.v+=1),e>this.v+1){for(let t=this.v+1;t<e;++t)this.x.push(t);this.v=e}}static comparator(e,t){const n=e.e||e,r=t.e||t;return n<r?-1:n>r?1:0}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t){this.e=e,this.c=t}}},function(e,t,n){"use strict";e.exports={BroadcastMessage:function(e,t,n,r){return{protocol:e,id:t,isReady:n,payload:r}},MAntiEntropyRequest:function(e){return{type:"MAntiEntropyRequest",causality:e}},MAntiEntropyResponse:function(e,t,n,r){return{type:"MAntiEntropyResponse",id:e,causality:t,nbElements:n,element:r,elements:[]}}}},function(e,t,n){(function(e,n){var r="Expected a function",i="__lodash_hash_undefined__",o=1,s=2,a=1/0,c=9007199254740991,h="[object Arguments]",u="[object Array]",l="[object Boolean]",d="[object Date]",f="[object Error]",p="[object Function]",g="[object GeneratorFunction]",y="[object Map]",m="[object Number]",b="[object Object]",v="[object RegExp]",w="[object Set]",_="[object String]",C="[object Symbol]",E="[object ArrayBuffer]",S="[object DataView]",k=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,x=/^\w*$/,F=/^\./,R=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,M=/\\(\\)?/g,A=/^\[object .+?Constructor\]$/,T=/^(?:0|[1-9]\d*)$/,P={};P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P[h]=P[u]=P[E]=P[l]=P[S]=P[d]=P[f]=P[p]=P[y]=P[m]=P[b]=P[v]=P[w]=P[_]=P["[object WeakMap]"]=!1;var I="object"==typeof e&&e&&e.Object===Object&&e,O="object"==typeof self&&self&&self.Object===Object&&self,j=I||O||Function("return this")(),D="object"==typeof t&&t&&!t.nodeType&&t,B=D&&"object"==typeof n&&n&&!n.nodeType&&n,N=B&&B.exports===D&&I.process,L=function(){try{return N&&N.binding("util")}catch(e){}}(),U=L&&L.isTypedArray;function q(e,t){for(var n=-1,r=e?e.length:0;++n<r;)if(t(e[n],n,e))return!0;return!1}function W(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function z(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function V(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var H=Array.prototype,$=Function.prototype,Y=Object.prototype,J=j["__core-js_shared__"],X=function(){var e=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),G=$.toString,Z=Y.hasOwnProperty,K=Y.toString,Q=RegExp("^"+G.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ee=j.Symbol,te=j.Uint8Array,ne=Y.propertyIsEnumerable,re=H.splice,ie=Math.floor,oe=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object),se=Math.min,ae=Ie(j,"DataView"),ce=Ie(j,"Map"),he=Ie(j,"Promise"),ue=Ie(j,"Set"),le=Ie(j,"WeakMap"),de=Ie(Object,"create"),fe=qe(ae),pe=qe(ce),ge=qe(he),ye=qe(ue),me=qe(le),be=ee?ee.prototype:void 0,ve=be?be.valueOf:void 0,we=be?be.toString:void 0;function _e(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ce(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ee(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Se(e){var t=-1,n=e?e.length:0;for(this.__data__=new Ee;++t<n;)this.add(e[t])}function ke(e){this.__data__=new Ce(e)}function xe(e,t){for(var n=e.length;n--;)if(ze(e[n][0],t))return n;return-1}function Fe(e,t){for(var n=0,r=(t=De(t,e)?[t]:Ae(t)).length;null!=e&&n<r;)e=e[Ue(t[n++])];return n&&n==r?e:void 0}function Re(e,t){return null!=e&&t in Object(e)}function Me(e,t,n,r,i){return e===t||(null==e||null==t||!Xe(e)&&!Ge(t)?e!=e&&t!=t:function(e,t,n,r,i,a){var c=He(e),p=He(t),g=u,k=u;c||(g=(g=Oe(e))==h?b:g),p||(k=(k=Oe(t))==h?b:k);var x=g==b&&!W(e),F=k==b&&!W(t),R=g==k;if(R&&!x)return a||(a=new ke),c||Ke(e)?Te(e,t,n,r,i,a):function(e,t,n,r,i,a,c){switch(n){case S:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case E:return!(e.byteLength!=t.byteLength||!r(new te(e),new te(t)));case l:case d:case m:return ze(+e,+t);case f:return e.name==t.name&&e.message==t.message;case v:case _:return e==t+"";case y:var h=z;case w:var u=a&s;if(h||(h=V),e.size!=t.size&&!u)return!1;var p=c.get(e);if(p)return p==t;a|=o,c.set(e,t);var g=Te(h(e),h(t),r,i,a,c);return c.delete(e),g;case C:if(ve)return ve.call(e)==ve.call(t)}return!1}(e,t,g,n,r,i,a);if(!(i&s)){var M=x&&Z.call(e,"__wrapped__"),A=F&&Z.call(t,"__wrapped__");if(M||A){var T=M?e.value():e,P=A?t.value():t;return a||(a=new ke),n(T,P,r,i,a)}}return!!R&&(a||(a=new ke),function(e,t,n,r,i,o){var a=i&s,c=Qe(e),h=c.length;if(h!=Qe(t).length&&!a)return!1;for(var u=h;u--;){var l=c[u];if(!(a?l in t:Z.call(t,l)))return!1}var d=o.get(e);if(d&&o.get(t))return d==t;var f=!0;o.set(e,t),o.set(t,e);for(var p=a;++u<h;){var g=e[l=c[u]],y=t[l];if(r)var m=a?r(y,g,l,t,e,o):r(g,y,l,e,t,o);if(!(void 0===m?g===y||n(g,y,r,i,o):m)){f=!1;break}p||(p="constructor"==l)}if(f&&!p){var b=e.constructor,v=t.constructor;b!=v&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof v&&v instanceof v)&&(f=!1)}return o.delete(e),o.delete(t),f}(e,t,n,r,i,a))}(e,t,Me,n,r,i))}function Ae(e){return He(e)?e:Le(e)}function Te(e,t,n,r,i,a){var c=i&s,h=e.length,u=t.length;if(h!=u&&!(c&&u>h))return!1;var l=a.get(e);if(l&&a.get(t))return l==t;var d=-1,f=!0,p=i&o?new Se:void 0;for(a.set(e,t),a.set(t,e);++d<h;){var g=e[d],y=t[d];if(r)var m=c?r(y,g,d,t,e,a):r(g,y,d,e,t,a);if(void 0!==m){if(m)continue;f=!1;break}if(p){if(!q(t,function(e,t){if(!p.has(t)&&(g===e||n(g,e,r,i,a)))return p.add(t)})){f=!1;break}}else if(g!==y&&!n(g,y,r,i,a)){f=!1;break}}return a.delete(e),a.delete(t),f}function Pe(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function Ie(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!Xe(e)||function(e){return!!X&&X in e}(e))&&(Ye(e)||W(e)?Q:A).test(qe(e))}(n)?n:void 0}_e.prototype.clear=function(){this.__data__=de?de(null):{}},_e.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},_e.prototype.get=function(e){var t=this.__data__;if(de){var n=t[e];return n===i?void 0:n}return Z.call(t,e)?t[e]:void 0},_e.prototype.has=function(e){var t=this.__data__;return de?void 0!==t[e]:Z.call(t,e)},_e.prototype.set=function(e,t){return this.__data__[e]=de&&void 0===t?i:t,this},Ce.prototype.clear=function(){this.__data__=[]},Ce.prototype.delete=function(e){var t=this.__data__,n=xe(t,e);return!(n<0||(n==t.length-1?t.pop():re.call(t,n,1),0))},Ce.prototype.get=function(e){var t=this.__data__,n=xe(t,e);return n<0?void 0:t[n][1]},Ce.prototype.has=function(e){return xe(this.__data__,e)>-1},Ce.prototype.set=function(e,t){var n=this.__data__,r=xe(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},Ee.prototype.clear=function(){this.__data__={hash:new _e,map:new(ce||Ce),string:new _e}},Ee.prototype.delete=function(e){return Pe(this,e).delete(e)},Ee.prototype.get=function(e){return Pe(this,e).get(e)},Ee.prototype.has=function(e){return Pe(this,e).has(e)},Ee.prototype.set=function(e,t){return Pe(this,e).set(e,t),this},Se.prototype.add=Se.prototype.push=function(e){return this.__data__.set(e,i),this},Se.prototype.has=function(e){return this.__data__.has(e)},ke.prototype.clear=function(){this.__data__=new Ce},ke.prototype.delete=function(e){return this.__data__.delete(e)},ke.prototype.get=function(e){return this.__data__.get(e)},ke.prototype.has=function(e){return this.__data__.has(e)},ke.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Ce){var r=n.__data__;if(!ce||r.length<199)return r.push([e,t]),this;n=this.__data__=new Ee(r)}return n.set(e,t),this};var Oe=function(e){return K.call(e)};function je(e,t){return!!(t=null==t?c:t)&&("number"==typeof e||T.test(e))&&e>-1&&e%1==0&&e<t}function De(e,t){if(He(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Ze(e))||x.test(e)||!k.test(e)||null!=t&&e in Object(t)}function Be(e){return e==e&&!Xe(e)}function Ne(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}}(ae&&Oe(new ae(new ArrayBuffer(1)))!=S||ce&&Oe(new ce)!=y||he&&"[object Promise]"!=Oe(he.resolve())||ue&&Oe(new ue)!=w||le&&"[object WeakMap]"!=Oe(new le))&&(Oe=function(e){var t=K.call(e),n=t==b?e.constructor:void 0,r=n?qe(n):void 0;if(r)switch(r){case fe:return S;case pe:return y;case ge:return"[object Promise]";case ye:return w;case me:return"[object WeakMap]"}return t});var Le=We(function(e){e=function(e){return null==e?"":function(e){if("string"==typeof e)return e;if(Ze(e))return we?we.call(e):"";var t=e+"";return"0"==t&&1/e==-a?"-0":t}(e)}(e);var t=[];return F.test(e)&&t.push(""),e.replace(R,function(e,n,r,i){t.push(r?i.replace(M,"$1"):n||e)}),t});function Ue(e){if("string"==typeof e||Ze(e))return e;var t=e+"";return"0"==t&&1/e==-a?"-0":t}function qe(e){if(null!=e){try{return G.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function We(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(r);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var s=e.apply(this,r);return n.cache=o.set(i,s),s};return n.cache=new(We.Cache||Ee),n}function ze(e,t){return e===t||e!=e&&t!=t}function Ve(e){return function(e){return Ge(e)&&$e(e)}(e)&&Z.call(e,"callee")&&(!ne.call(e,"callee")||K.call(e)==h)}We.Cache=Ee;var He=Array.isArray;function $e(e){return null!=e&&Je(e.length)&&!Ye(e)}function Ye(e){var t=Xe(e)?K.call(e):"";return t==p||t==g}function Je(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=c}function Xe(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ge(e){return!!e&&"object"==typeof e}function Ze(e){return"symbol"==typeof e||Ge(e)&&K.call(e)==C}var Ke=U?function(e){return function(t){return e(t)}}(U):function(e){return Ge(e)&&Je(e.length)&&!!P[K.call(e)]};function Qe(e){return $e(e)?function(e,t){var n=He(e)||Ve(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],r=n.length,i=!!r;for(var o in e)!t&&!Z.call(e,o)||i&&("length"==o||je(o,r))||n.push(o);return n}(e):function(e){if(!function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Y)}(e))return oe(e);var t=[];for(var n in Object(e))Z.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}function et(e){return e}n.exports=function(e,t,n){return function(e,t,n,r){t=n(t);for(var i=0,o=e?e.length:0,s=t!=t,a=null===t,c=Ze(t),h=void 0===t;i<o;){var u=ie((i+o)/2),l=n(e[u]),d=void 0!==l,f=null===l,p=l==l,g=Ze(l);if(s)var y=p;else y=h?p&&d:a?p&&d&&!f:c?p&&d&&!f&&!g:!f&&!g&&l<t;y?i=u+1:o=u}return se(o,4294967294)}(e,t,function(e){return"function"==typeof e?e:null==e?et:"object"==typeof e?He(e)?function(e,t){return De(e)&&Be(t)?Ne(Ue(e),t):function(n){var r=function(e,t,n){var r=null==e?void 0:Fe(e,t);return void 0===r?void 0:r}(n,e);return void 0===r&&r===t?function(e,t){return null!=n&&function(e,t,n){for(var r,i=-1,o=(t=De(t,e)?[t]:Ae(t)).length;++i<o;){var s=Ue(t[i]);if(!(r=null!=e&&n(e,s)))break;e=e[s]}return r||!!(o=e?e.length:0)&&Je(o)&&je(s,o)&&(He(e)||Ve(e))}(n,t,Re)}(0,e):Me(t,r,void 0,o|s)}}(e[0],e[1]):function(e){var t=function(e){for(var t=Qe(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Be(i)]}return t}(e);return 1==t.length&&t[0][2]?Ne(t[0][0],t[0][1]):function(n){return n===e||function(e,t,n,r){var i=n.length,a=i;if(null==e)return!a;for(e=Object(e);i--;){var c=n[i];if(c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++i<a;){var h=(c=n[i])[0],u=e[h],l=c[1];if(c[2]){if(void 0===u&&!(h in e))return!1}else{var d,f=new ke;if(!(void 0===d?Me(l,u,r,o|s,f):d))return!1}}return!0}(n,0,t)}}(e):function(e){return De(e)?function(e){return function(t){return null==t?void 0:t[e]}}(Ue(e)):function(e){return function(t){return Fe(t,e)}}(e)}(e)}(n))}}).call(this,n(0),n(23)(e))},function(e,t,n){"use strict";e.exports=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){var n;function s(){if(s.enabled){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=s,a=Number(new Date),c=a-(n||a);o.diff=c,o.prev=n,o.curr=a,n=a,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var h=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,function(e,n){if("%%"===e)return e;h++;var i=r.formatters[n];if("function"==typeof i){var s=t[h];e=i.call(o,s),t.splice(h,1),h--}return e}),r.formatArgs.call(o,t),(o.log||r.log).apply(o,t)}}return s.namespace=e,s.enabled=r.enabled(e),s.useColors=r.useColors(),s.color=t(e),s.destroy=i,s.extend=o,"function"==typeof r.init&&r.init(s),r.instances.push(s),s}function i(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){return r(this.namespace+(void 0===t?":":t)+e)}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var o=r.instances[t];o.enabled=r.enabled(o.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(11),Object.keys(e).forEach(function(t){r[t]=e[t]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},function(e,t,n){"use strict";e.exports=class{constructor(){this._middlewares=[]}register(e,t=0){if(!("in"in e||"out"in e))throw new Error('A middleware must contains two functions: "in" and "out"');this._middlewares.push({middleware:e,priority:t}),this._middlewares.sort((e,t)=>e.priority-t.priority)}in(e){let t;return this._middlewares.reduce((e,n)=>void 0!==(t=n.middleware.in(e))||null!==t?t:e,e)}out(e){let t;return this._middlewares.reduce((e,n)=>void 0!==(t=n.middleware.out(e))||null!==t?t:e,e)}}},function(e,t,n){"use strict";const r=n(8),i=n(42).Writable,o=n(120);e.exports=class extends i{constructor(e){super({objectMode:!0}),this._id=r(),this._send=e,this._trailers=[],this._last_id=void 0}addTrailer(e){this._trailers.push(e)}destroy(e){this._last_id=this._send(o.StreamMessageError(this._id,e),null,this._last_id),super.destroy(e)}_write(e,t,n){return this._last_id=this._send(o.StreamMessageChunk(this._id,e),null,this._last_id),n(),this._last_id}_final(e){this._trailers.length>0&&(this._last_id=this._send(o.StreamMessageTrailers(this._id,this._trailers),null,this._last_id)),this._last_id=this._send(o.StreamMessageEnd(this._id),null,this._last_id),e()}}},function(e,t,n){"use strict";t.byteLength=function(e){var t=h(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){for(var t,n=h(e),r=n[0],s=n[1],a=new o(3*(r+s)/4-s),c=0,u=s>0?r-4:r,l=0;l<u;l+=4)t=i[e.charCodeAt(l)]<<18|i[e.charCodeAt(l+1)]<<12|i[e.charCodeAt(l+2)]<<6|i[e.charCodeAt(l+3)],a[c++]=t>>16&255,a[c++]=t>>8&255,a[c++]=255&t;return 2===s&&(t=i[e.charCodeAt(l)]<<2|i[e.charCodeAt(l+1)]>>4,a[c++]=255&t),1===s&&(t=i[e.charCodeAt(l)]<<10|i[e.charCodeAt(l+1)]<<4|i[e.charCodeAt(l+2)]>>2,a[c++]=t>>8&255,a[c++]=255&t),a},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(l(e,s,s+16383>a?a:s+16383));return 1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function h(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e){return r[e>>18&63]+r[e>>12&63]+r[e>>6&63]+r[63&e]}function l(e,t,n){for(var r,i=[],o=t;o<n;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(u(r));return i.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,h=c>>1,u=-7,l=n?i-1:0,d=n?-1:1,f=e[t+l];for(l+=d,o=f&(1<<-u)-1,f>>=-u,u+=a;u>0;o=256*o+e[t+l],l+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+e[t+l],l+=d,u-=8);if(0===o)o=1-h;else{if(o===c)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,r),o-=h}return(f?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,c,h=8*o-i-1,u=(1<<h)-1,l=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+l>=1?d/c:d*Math.pow(2,1-l))*c>=2&&(s++,c/=2),s+l>=u?(a=0,s=u):s+l>=1?(a=(t*c-1)*Math.pow(2,i),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;e[n+f]=255&a,f+=p,a/=256,i-=8);for(s=s<<i|a,h+=i;h>0;e[n+f]=255&s,f+=p,s/=256,h-=8);e[n+f-p]|=128*g}},function(e,t){},function(e,t,n){"use strict";var r=n(10).Buffer,i=n(116).inspect,o=i&&o||"inspect";function s(e,t,n){r.prototype.copy.call(e,t,n)}e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);for(var t=r.allocUnsafe(e>>>0),n=this.head,i=0;n;)s(n.data,t,i),i+=n.data.length,n=n.next;return t},e.prototype.consume=function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n},e.prototype.first=function(){return this.head.data},e.prototype._getString=function(e){var t=this.head,n=1,r=t.data;for(e-=r.length;t=t.next;){var i=t.data,o=e>i.length?i.length:e;if(o===i.length?r+=i:r+=i.slice(0,e),0==(e-=o)){o===i.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(o));break}++n}return this.length-=n,r},e.prototype._getBuffer=function(e){var t=r.allocUnsafe(e),n=this.head,i=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(o.copy(t,t.length-e,0,s),0==(e-=s)){s===o.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=o.slice(s));break}++i}return this.length-=i,t},e.prototype[o]=function(){var e=i({length:this.length});return this.constructor.name+" "+e},e}()},function(e,t){},function(e,t,n){"use strict";(function(t){var n=new Set;e.exports.emitExperimentalWarning=t.emitWarning?function(e){if(!n.has(e)){var r=e+" is an experimental feature. This feature could change at any time";n.add(e),t.emitWarning(r,"ExperimentalWarning")}}:function(){}}).call(this,n(1))},function(e,t,n){"use strict";(function(t){var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=Symbol("lastResolve"),o=Symbol("lastReject"),s=Symbol("error"),a=Symbol("ended"),c=Symbol("lastPromise"),h=Symbol("handlePromise"),u=Symbol("stream"),l=function e(t,n){r(this,e),this.done=n,this.value=t};function d(e){var t=e[i];if(null!==t){var n=e[u].read();null!==n&&(e[c]=null,e[i]=null,e[o]=null,t(new l(n,!1)))}}var f=function(){function e(n){var f=this;r(this,e),this[u]=n,this[i]=null,this[o]=null,this[s]=null,this[a]=!1,this[c]=null,n.on("readable",function(e){t.nextTick(d,e)}.bind(null,this)),n.on("end",function(e){var t=e[i];null!==t&&(e[c]=null,e[i]=null,e[o]=null,t(new l(null,!0))),e[a]=!0}.bind(null,this)),n.on("error",function(e,t){var n=e[o];null!==n&&(e[c]=null,e[i]=null,e[o]=null,n(t)),e[s]=t}.bind(null,this)),this[h]=function(e,t){var n=f[u].read();n?(f[c]=null,f[i]=null,f[o]=null,e(new l(n,!1))):(f[i]=e,f[o]=t)}}return e.prototype.next=function(){var e=this[s];if(null!==e)return Promise.reject(e);if(this[a])return Promise.resolve(new l(null,!0));var t=this[c],n=void 0;if(t)n=new Promise(function(e,t){return function(n,r){e.then(function(){t[h](n,r)},r)}}(t,this));else{var r=this[u].read();if(null!==r)return Promise.resolve(new l(r,!1));n=new Promise(this[h])}return this[c]=n,n},e.prototype.return=function(){var e=this;return new Promise(function(t,n){e[u].destroy(null,function(e){e?n(e):t(new l(null,!0))})})},n(e,[{key:"stream",get:function(){return this[u]}}]),e}();e.exports=f}).call(this,n(1))},function(e,t,n){"use strict";e.exports=i;var r=n(48);function i(e){if(!(this instanceof i))return new i(e);r.call(this,e)}n(2)(i,r),i.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){"use strict";const r=e=>(t,n)=>({id:t,type:e,payload:n}),i=r("chunk"),o=r("trailers"),s=r("end"),a=r("error");e.exports={StreamMessageChunk:i,StreamMessageTrailers:o,StreamMessageEnd:s,StreamMessageError:a}},function(e,t,n){"use strict";const r=n(42).PassThrough;e.exports=class extends r{constructor(){super({objectMode:!0}),this._trailers=null}get trailers(){return this._trailers}}},function(e,t,n){(function(t){var r=n(123);function i(){}e.exports=function(e,n){n||(n={});var o=r.Readable(),s=0,a=0,c=[];return o.recorder=null,o.media=null,o._read=i,o.destroyed=!1,o.destroy=function(e){o.destroyed||(o.destroyed=!0,o.recorder&&o.recorder.stop(),e&&o.emit("error",e),o.emit("close"),o.recorder=null,o.media=null)},o.stop=function(){o.once("data",function(){o.push(null)}),o.recorder.stop()},o.media=e,o.recorder=new window.MediaRecorder(e,n),o.recorder.addEventListener("dataavailable",function(e){!function(e){var n=new window.FileReader,r=s++;n.addEventListener("loadend",function(){for(var e=t(new Uint8Array(n.result)),i=r-a;c.length<i;)c.push(null);for(c[i]=e;c.length&&c[0];){var s=c.shift();a++,o.push(s)}}),n.readAsArrayBuffer(e)}(e.data)}),o.recorder.start(n.interval||1e3),o}}).call(this,n(10).Buffer)},function(e,t,n){(t=e.exports=n(49)).Stream=t,t.Readable=t,t.Writable=n(52),t.Duplex=n(15),t.Transform=n(53),t.PassThrough=n(128)},function(e,t){},function(e,t,n){"use strict";var r=n(7).Buffer,i=n(126);function o(e,t,n){e.copy(t,n)}e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t=r.allocUnsafe(e>>>0),n=this.head,i=0;n;)o(n.data,t,i),i+=n.data.length,n=n.next;return t},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i=1,o={},s=!1,a=e.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(e);c=c&&c.setTimeout?c:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick(function(){u(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&u(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),r=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){u(e.data)},r=function(t){e.port2.postMessage(t)}}():a&&"onreadystatechange"in a.createElement("script")?function(){var e=a.documentElement;r=function(t){var n=a.createElement("script");n.onreadystatechange=function(){u(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():r=function(e){setTimeout(u,0,e)},c.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var s={callback:e,args:t};return o[i]=s,r(i),i++},c.clearImmediate=h}function h(e){delete o[e]}function u(e){if(s)setTimeout(u,0,e);else{var t=o[e];if(t){s=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{h(e),s=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(0),n(1))},function(e,t,n){"use strict";e.exports=o;var r=n(53),i=n(4);function o(e){if(!(this instanceof o))return new o(e);r.call(this,e)}i.inherits=n(2),i.inherits(o,r),o.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){e.exports=c;var r=n(2),i=n(130),o=n(135),s="undefined"!=typeof window&&window.MediaSource,a=60;function c(e,t){var n=this;if(!(n instanceof c))return new c(e,t);if(!s)throw new Error("web browser lacks MediaSource support");t||(t={}),n._debug=t.debug,n._bufferDuration=t.bufferDuration||a,n._elem=e,n._mediaSource=new s,n._streams=[],n.detailedError=null,n._errorHandler=function(){n._elem.removeEventListener("error",n._errorHandler),n._streams.slice().forEach(function(e){e.destroy(n._elem.error)})},n._elem.addEventListener("error",n._errorHandler),n._elem.src=window.URL.createObjectURL(n._mediaSource)}function h(e,t){var n=this;if(i.Writable.call(n),n._wrapper=e,n._elem=e._elem,n._mediaSource=e._mediaSource,n._allStreams=e._streams,n._allStreams.push(n),n._bufferDuration=e._bufferDuration,n._sourceBuffer=null,n._debugBuffers=[],n._openHandler=function(){n._onSourceOpen()},n._flowHandler=function(){n._flow()},n._errorHandler=function(e){n.destroyed||n.emit("error",e)},"string"==typeof t)n._type=t,"open"===n._mediaSource.readyState?n._createSourceBuffer():n._mediaSource.addEventListener("sourceopen",n._openHandler);else if(null===t._sourceBuffer)t.destroy(),n._type=t._type,n._mediaSource.addEventListener("sourceopen",n._openHandler);else{if(!t._sourceBuffer)throw new Error("The argument to MediaElementWrapper.createWriteStream must be a string or a previous stream returned from that function");t.destroy(),n._type=t._type,n._sourceBuffer=t._sourceBuffer,n._debugBuffers=t._debugBuffers,n._sourceBuffer.addEventListener("updateend",n._flowHandler),n._sourceBuffer.addEventListener("error",n._errorHandler)}n._elem.addEventListener("timeupdate",n._flowHandler),n.on("error",function(e){n._wrapper.error(e)}),n.on("finish",function(){if(!n.destroyed&&(n._finished=!0,n._allStreams.every(function(e){return e._finished}))){n._wrapper._dumpDebugData();try{n._mediaSource.endOfStream()}catch(e){}}})}c.prototype.createWriteStream=function(e){return new h(this,e)},c.prototype.error=function(e){this.detailedError||(this.detailedError=e),this._dumpDebugData();try{this._mediaSource.endOfStream("decode")}catch(e){}},c.prototype._dumpDebugData=function(){this._debug&&(this._debug=!1,this._streams.forEach(function(e,t){!function(e,t){var n=document.createElement("a");n.href=window.URL.createObjectURL(new window.Blob(e)),n.download=t,n.click()}(e._debugBuffers,"mediasource-stream-"+t)}))},r(h,i.Writable),h.prototype._onSourceOpen=function(){this.destroyed||(this._mediaSource.removeEventListener("sourceopen",this._openHandler),this._createSourceBuffer())},h.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,this._allStreams.splice(this._allStreams.indexOf(this),1),this._mediaSource.removeEventListener("sourceopen",this._openHandler),this._elem.removeEventListener("timeupdate",this._flowHandler),this._sourceBuffer&&(this._sourceBuffer.removeEventListener("updateend",this._flowHandler),this._sourceBuffer.removeEventListener("error",this._errorHandler),"open"===this._mediaSource.readyState&&this._sourceBuffer.abort()),e&&this.emit("error",e),this.emit("close"))},h.prototype._createSourceBuffer=function(){if(!this.destroyed)if(s.isTypeSupported(this._type)){if(this._sourceBuffer=this._mediaSource.addSourceBuffer(this._type),this._sourceBuffer.addEventListener("updateend",this._flowHandler),this._sourceBuffer.addEventListener("error",this._errorHandler),this._cb){var e=this._cb;this._cb=null,e()}}else this.destroy(new Error("The provided type is not supported"))},h.prototype._write=function(e,t,n){var r=this;if(!r.destroyed)if(r._sourceBuffer){if(r._sourceBuffer.updating)return n(new Error("Cannot append buffer while source buffer updating"));var i=o(e);r._wrapper._debug&&r._debugBuffers.push(i);try{r._sourceBuffer.appendBuffer(i)}catch(e){return void r.destroy(e)}r._cb=n}else r._cb=function(i){if(i)return n(i);r._write(e,t,n)}},h.prototype._flow=function(){if(!this.destroyed&&this._sourceBuffer&&!this._sourceBuffer.updating&&!("open"===this._mediaSource.readyState&&this._getBufferDuration()>this._bufferDuration)&&this._cb){var e=this._cb;this._cb=null,e()}},h.prototype._getBufferDuration=function(){for(var e=this._sourceBuffer.buffered,t=this._elem.currentTime,n=-1,r=0;r<e.length;r++){var i=e.start(r),o=e.end(r)+0;if(i>t)break;(n>=0||t<=o)&&(n=o)}var s=n-t;return s<0&&(s=0),s}},function(e,t,n){(t=e.exports=n(54)).Stream=t,t.Readable=t,t.Writable=n(57),t.Duplex=n(16),t.Transform=n(58),t.PassThrough=n(134)},function(e,t){},function(e,t,n){"use strict";var r=n(7).Buffer,i=n(133);function o(e,t,n){e.copy(t,n)}e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t=r.allocUnsafe(e>>>0),n=this.head,i=0;n;)o(n.data,t,i),i+=n.data.length,n=n.next;return t},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){"use strict";e.exports=o;var r=n(58),i=n(4);function o(e){if(!(this instanceof o))return new o(e);r.call(this,e)}i.inherits=n(2),i.inherits(o,r),o.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){var r=n(10).Buffer;e.exports=function(e){if(e instanceof Uint8Array){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return e.buffer;if("function"==typeof e.buffer.slice)return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}if(r.isBuffer(e)){for(var t=new Uint8Array(e.length),n=e.length,i=0;i<n;i++)t[i]=e[i];return t.buffer}throw new Error("Argument must be a Buffer")}},function(e,t,n){e.exports=i;var r=n(3).EventEmitter;function i(){r.call(this)}n(2)(i,r),i.Readable=n(35),i.Writable=n(141),i.Duplex=n(142),i.Transform=n(143),i.PassThrough=n(144),i.Stream=i,i.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function o(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",o),e._isStdio||t&&!1===t.end||(n.on("end",a),n.on("close",c));var s=!1;function a(){s||(s=!0,e.end())}function c(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function h(e){if(u(),0===r.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",i),e.removeListener("drain",o),n.removeListener("end",a),n.removeListener("close",c),n.removeListener("error",h),e.removeListener("error",h),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",h),e.on("error",h),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e}},function(e,t){},function(e,t,n){"use strict";var r=n(7).Buffer,i=n(139);function o(e,t,n){e.copy(t,n)}e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t=r.allocUnsafe(e>>>0),n=this.head,i=0;n;)o(n.data,t,i),i+=n.data.length,n=n.next;return t},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){"use strict";e.exports=o;var r=n(62),i=n(4);function o(e){if(!(this instanceof o))return new o(e);r.call(this,e)}i.inherits=n(2),i.inherits(o,r),o.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){e.exports=n(36)},function(e,t,n){e.exports=n(13)},function(e,t,n){e.exports=n(35).Transform},function(e,t,n){e.exports=n(35).PassThrough},function(e,t,n){"use strict";const r=n(3),i=n(5),o=n(146),s=n(77),a=n(83),c=n(12)("foglet-core:network-manager");e.exports=class extends r{constructor(e){super(),this._options=i({rps:{type:"spray-wrtc",options:{protocol:"spray-wrtc-communication"}},overlays:[]},e),this._rps=this._buildRPS(this._options.rps.type,this._options.rps.options),this._overlays=new Map,this._buildOverlays(this._options.overlays),c("Networks (Rps and overlays) initialized.")}overlay(e=null){return null===e?this._rps:this._overlays.get(e)}registerMiddleware(e,t=0){this._rps.use(e,t),this._overlays.forEach(n=>n.use(e,t))}_buildRPS(e,t){const n=new(this._chooseRps(e,t))(t);return new o(n,t.signaling,t.protocol)}_chooseRps(e,t){let n=null;switch(e){case"spray-wrtc":n=s;break;case"cyclon":n=a;break;case"custom":n=t.class;break;default:n=s}return n}_buildOverlays(e){0===e.length&&c("No overlays added, only the base RPS is available"),e.forEach(e=>{this._buildOverlay(e)})}_buildOverlay(e){if(!("object"==typeof e&&"name"in e&&"class"in e))throw new SyntaxError("An overlay is a configuration object {name: [string], class: [function], options: [Object]}");const t=e.options;if(!("protocol"in t))throw new SyntaxError("An overlay configuration requires a protocol name, e;g. { protocol: [string] }");if("signaling"in t||c(`[WARNING] no signaling server given for overlay "${e.name}"! Only connections from inside the same app will be allowed!`),this._overlays.has(e.name))throw new Error(`An overlay with the name "${e.name}" has already been registered!`);const n=new e.class(this,t);this._overlays.set(e.name,new o(n,t.signaling,t.protocol))}}},function(e,t,n){"use strict";const r=n(33),i=n(63);e.exports=class{constructor(e,t,n){this._network=e,this._protocol=n,this._signaling=new i(e,t),this._communication=new r(e,n)}get protocol(){return this._protocol}get network(){return this._network}get signaling(){return this._signaling}get communication(){return this._communication}use(e,t=0){this.communication.use(e,t)}}},function(e,t,n){(function(t){var r=n(65),i=n(26)("socket.io-client:url");e.exports=function(e,n){var o=e;n=n||t.location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e=void 0!==n?n.protocol+"//"+e:"https://"+e),i("parse %s",e),o=r(e)),o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443")),o.path=o.path||"/";var s=-1!==o.host.indexOf(":")?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+s+":"+o.port,o.href=o.protocol+"://"+s+(n&&n.port===o.port?"":":"+o.port),o}}).call(this,n(0))},function(e,t,n){function r(e){var n;function r(){if(r.enabled){var e=r,i=+new Date,o=i-(n||i);e.diff=o,e.prev=n,e.curr=i,n=i;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var i=t.formatters[r];if("function"==typeof i){var o=s[c];n=i.call(e,o),s.splice(c,1),c--}return n}),t.formatArgs.call(e,s),(r.log||t.log||console.log.bind(console)).apply(e,s)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=i,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(149),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){var n=1e3,r=6e4,i=36e5,o=24*i;function s(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var a=typeof e;if("string"===a&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===a&&!1===isNaN(e))return t.long?function(e){return s(e,o,"day")||s(e,i,"hour")||s(e,r,"minute")||s(e,n,"second")||e+" ms"}(e):function(e){return e>=o?Math.round(e/o)+"d":e>=i?Math.round(e/i)+"h":e>=r?Math.round(e/r)+"m":e>=n?Math.round(e/n)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){(function(r){function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(151)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(o=++i)}),e.splice(o,0,r)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(1))},function(e,t,n){function r(e){var n;function r(){if(r.enabled){var e=r,i=+new Date,o=i-(n||i);e.diff=o,e.prev=n,e.curr=i,n=i;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var i=t.formatters[r];if("function"==typeof i){var o=s[c];n=i.call(e,o),s.splice(c,1),c--}return n}),t.formatArgs.call(e,s),(r.log||t.log||console.log.bind(console)).apply(e,s)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=i,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(152),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){var n=1e3,r=6e4,i=36e5,o=24*i;function s(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var a=typeof e;if("string"===a&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===a&&!1===isNaN(e))return t.long?function(e){return s(e,o,"day")||s(e,i,"hour")||s(e,r,"minute")||s(e,n,"second")||e+" ms"}(e):function(e){return e>=o?Math.round(e/o)+"d":e>=i?Math.round(e/i)+"h":e>=r?Math.round(e/r)+"m":e>=n?Math.round(e/n)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){(function(e){var r=n(66),i=n(67),o=Object.prototype.toString,s="function"==typeof e.Blob||"[object BlobConstructor]"===o.call(e.Blob),a="function"==typeof e.File||"[object FileConstructor]"===o.call(e.File);t.deconstructPacket=function(e){var t=[],n=e.data,o=e;return o.data=function e(t,n){if(!t)return t;if(i(t)){var o={_placeholder:!0,num:n.length};return n.push(t),o}if(r(t)){for(var s=new Array(t.length),a=0;a<t.length;a++)s[a]=e(t[a],n);return s}if("object"==typeof t&&!(t instanceof Date)){s={};for(var c in t)s[c]=e(t[c],n);return s}return t}(n,t),o.attachments=t.length,{packet:o,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function e(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(r(t))for(var i=0;i<t.length;i++)t[i]=e(t[i],n);else if("object"==typeof t)for(var o in t)t[o]=e(t[o],n);return t}(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){var n=0,o=e;!function e(c,h,u){if(!c)return c;if(s&&c instanceof Blob||a&&c instanceof File){n++;var l=new FileReader;l.onload=function(){u?u[h]=this.result:o=this.result,--n||t(o)},l.readAsArrayBuffer(c)}else if(r(c))for(var d=0;d<c.length;d++)e(c[d],d,c);else if("object"==typeof c&&!i(c))for(var f in c)e(c[f],f,c)}(o),n||t(o)}}).call(this,n(0))},function(e,t,n){e.exports=n(155),e.exports.parser=n(18)},function(e,t,n){(function(t){var r=n(69),i=n(17),o=n(29)("engine.io-client:socket"),s=n(73),a=n(18),c=n(65),h=n(27);function u(e,n){if(!(this instanceof u))return new u(e,n);n=n||{},e&&"object"==typeof e&&(n=e,e=null),e?(e=c(e),n.hostname=e.host,n.secure="https"===e.protocol||"wss"===e.protocol,n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=c(n.host).host),this.secure=null!=n.secure?n.secure:t.location&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.agent=n.agent||!1,this.hostname=n.hostname||(t.location?location.hostname:"localhost"),this.port=n.port||(t.location&&location.port?location.port:this.secure?443:80),this.query=n.query||{},"string"==typeof this.query&&(this.query=h.decode(this.query)),this.upgrade=!1!==n.upgrade,this.path=(n.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!n.forceJSONP,this.jsonp=!1!==n.jsonp,this.forceBase64=!!n.forceBase64,this.enablesXDR=!!n.enablesXDR,this.timestampParam=n.timestampParam||"t",this.timestampRequests=n.timestampRequests,this.transports=n.transports||["polling","websocket"],this.transportOptions=n.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=n.policyPort||843,this.rememberUpgrade=n.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=n.onlyBinaryUpgrades,this.perMessageDeflate=!1!==n.perMessageDeflate&&(n.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=n.pfx||null,this.key=n.key||null,this.passphrase=n.passphrase||null,this.cert=n.cert||null,this.ca=n.ca||null,this.ciphers=n.ciphers||null,this.rejectUnauthorized=void 0===n.rejectUnauthorized||n.rejectUnauthorized,this.forceNode=!!n.forceNode;var r="object"==typeof t&&t;r.global===r&&(n.extraHeaders&&Object.keys(n.extraHeaders).length>0&&(this.extraHeaders=n.extraHeaders),n.localAddress&&(this.localAddress=n.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}e.exports=u,u.priorWebsocketSuccess=!1,i(u.prototype),u.protocol=a.protocol,u.Socket=u,u.Transport=n(39),u.transports=n(69),u.parser=n(18),u.prototype.createTransport=function(e){o('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=a.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new r[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0})},u.prototype.open=function(){var e;if(this.rememberUpgrade&&u.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},u.prototype.setTransport=function(e){o("setting transport %s",e.name);var t=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},u.prototype.probe=function(e){o('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,r=this;function i(){if(r.onlyBinaryUpgrades){var i=!this.supportsBinary&&r.transport.supportsBinary;n=n||i}n||(o('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(i){if(!n)if("pong"===i.type&&"probe"===i.data){if(o('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;u.priorWebsocketSuccess="websocket"===t.name,o('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){n||"closed"!==r.readyState&&(o("changing transport and sending upgrade packet"),d(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())})}else{o('probe transport "%s" failed',e);var s=new Error("probe error");s.transport=t.name,r.emit("upgradeError",s)}}))}function s(){n||(n=!0,d(),t.close(),t=null)}function a(n){var i=new Error("probe error: "+n);i.transport=t.name,s(),o('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",i)}function c(){a("transport closed")}function h(){a("socket closed")}function l(e){t&&e.name!==t.name&&(o('"%s" works - aborting "%s"',e.name,t.name),s())}function d(){t.removeListener("open",i),t.removeListener("error",a),t.removeListener("close",c),r.removeListener("close",h),r.removeListener("upgrading",l)}u.priorWebsocketSuccess=!1,t.once("open",i),t.once("error",a),t.once("close",c),this.once("close",h),this.once("upgrading",l),t.open()},u.prototype.onOpen=function(){if(o("socket open"),this.readyState="open",u.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},u.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(o('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else o('packet received with socket readyState "%s"',this.readyState)},u.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},u.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},u.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){o("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},u.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},u.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},u.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},u.prototype.write=u.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},u.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var i={type:e,data:t,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},u.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():t()}):this.upgrading?r():t()}function t(){e.onClose("forced close"),o("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}return this},u.prototype.onError=function(e){o("socket error %j",e),u.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},u.prototype.onClose=function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(o('socket close with reason: "%s"',e),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)},u.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~s(this.transports,e[n])&&t.push(e[n]);return t}}).call(this,n(0))},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,n){(function(t){var r=n(38),i=n(70),o=n(17),s=n(28),a=n(29)("engine.io-client:polling-xhr");function c(){}function h(e){if(i.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,t.location){var n="https:"===location.protocol,r=location.port;r||(r=n?443:80),this.xd=e.hostname!==t.location.hostname||r!==e.port,this.xs=e.secure!==n}}function u(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function l(){for(var e in u.requests)u.requests.hasOwnProperty(e)&&u.requests[e].abort()}e.exports=h,e.exports.Request=u,s(h,i),h.prototype.supportsBinary=!0,h.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new u(e)},h.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),i=this;r.on("success",t),r.on("error",function(e){i.onError("xhr post error",e)}),this.sendXhr=r},h.prototype.doPoll=function(){a("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},o(u.prototype),u.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var n=this.xhr=new r(e),i=this;try{a("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var o in n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&n.setRequestHeader(o,this.extraHeaders[o])}catch(e){}if("POST"===this.method)try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in n&&(n.withCredentials=!0),this.requestTimeout&&(n.timeout=this.requestTimeout),this.hasXDR()?(n.onload=function(){i.onLoad()},n.onerror=function(){i.onError(n.responseText)}):n.onreadystatechange=function(){if(2===n.readyState)try{var e=n.getResponseHeader("Content-Type");i.supportsBinary&&"application/octet-stream"===e&&(n.responseType="arraybuffer")}catch(e){}4===n.readyState&&(200===n.status||1223===n.status?i.onLoad():setTimeout(function(){i.onError(n.status)},0))},a("xhr data %s",this.data),n.send(this.data)}catch(e){return void setTimeout(function(){i.onError(e)},0)}t.document&&(this.index=u.requestsCount++,u.requests[this.index]=this)},u.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},u.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},u.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},u.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,e)try{this.xhr.abort()}catch(e){}t.document&&delete u.requests[this.index],this.xhr=null}},u.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e="application/octet-stream"===t&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},u.prototype.hasXDR=function(){return void 0!==t.XDomainRequest&&!this.xs&&this.enablesXDR},u.prototype.abort=function(){this.cleanup()},u.requestsCount=0,u.requests={},t.document&&(t.attachEvent?t.attachEvent("onunload",l):t.addEventListener&&t.addEventListener("beforeunload",l,!1))}).call(this,n(0))},function(e,t){e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){e.exports=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(n-t),s=t,a=0;s<n;s++,a++)o[a]=i[s];return o.buffer}},function(e,t){function n(){}e.exports=function(e,t,r){var i=!1;return r=r||n,o.count=e,0===e?t():o;function o(e,n){if(o.count<=0)throw new Error("after called too many times");--o.count,e?(i=!0,t(e),t=r):0!==o.count||i||t(null,n)}}},function(e,t,n){(function(e,r){var i;/*! https://mths.be/utf8js v2.1.2 by @mathias */!function(o){var s=("object"==typeof e&&e&&e.exports,"object"==typeof r&&r);s.global!==s&&s.window;var a,c,h,u=String.fromCharCode;function l(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function d(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function f(e,t){return u(e>>t&63|128)}function p(e,t){if(0==(4294967168&e))return u(e);var n="";return 0==(4294965248&e)?n=u(e>>6&31|192):0==(4294901760&e)?(d(e,t)||(e=65533),n=u(e>>12&15|224),n+=f(e,6)):0==(4292870144&e)&&(n=u(e>>18&7|240),n+=f(e,12),n+=f(e,6)),n+u(63&e|128)}function g(){if(h>=c)throw Error("Invalid byte index");var e=255&a[h];if(h++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function y(e){var t,n;if(h>c)throw Error("Invalid byte index");if(h==c)return!1;if(t=255&a[h],h++,0==(128&t))return t;if(192==(224&t)){if((n=(31&t)<<6|g())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&t)){if((n=(15&t)<<12|g()<<6|g())>=2048)return d(n,e)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(n=(7&t)<<18|g()<<12|g()<<6|g())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}var m={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,r=l(e),i=r.length,o=-1,s="";++o<i;)s+=p(r[o],n);return s},decode:function(e,t){var n=!1!==(t=t||{}).strict;a=l(e),c=a.length,h=0;for(var r,i=[];!1!==(r=y(n));)i.push(r);return function(e){for(var t,n=e.length,r=-1,i="";++r<n;)(t=e[r])>65535&&(i+=u((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=u(t);return i}(i)}};void 0===(i=function(){return m}.call(t,n,t,e))||(e.exports=i)}()}).call(this,n(23)(e),n(0))},function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<e.length;r++)n[e.charCodeAt(r)]=r;t.encode=function(t){var n,r=new Uint8Array(t),i=r.length,o="";for(n=0;n<i;n+=3)o+=e[r[n]>>2],o+=e[(3&r[n])<<4|r[n+1]>>4],o+=e[(15&r[n+1])<<2|r[n+2]>>6],o+=e[63&r[n+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,r,i,o,s,a=.75*e.length,c=e.length,h=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),l=new Uint8Array(u);for(t=0;t<c;t+=4)r=n[e.charCodeAt(t)],i=n[e.charCodeAt(t+1)],o=n[e.charCodeAt(t+2)],s=n[e.charCodeAt(t+3)],l[h++]=r<<2|i>>4,l[h++]=(15&i)<<4|o>>2,l[h++]=(3&o)<<6|63&s;return u}}()},function(e,t,n){(function(t){var n=t.BlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder||t.MozBlobBuilder,r=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),i=r&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),o=n&&n.prototype.append&&n.prototype.getBlob;function s(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var i=new Uint8Array(n.byteLength);i.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=i.buffer}e[t]=r}}}e.exports=r?i?t.Blob:function(e,t){return s(e),new Blob(e,t||{})}:o?function(e,t){t=t||{};var r=new n;s(e);for(var i=0;i<e.length;i++)r.append(e[i]);return t.type?r.getBlob(t.type):r.getBlob()}:void 0}).call(this,n(0))},function(e,t,n){function r(e){var n;function r(){if(r.enabled){var e=r,i=+new Date,o=i-(n||i);e.diff=o,e.prev=n,e.curr=i,n=i;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var i=t.formatters[r];if("function"==typeof i){var o=s[c];n=i.call(e,o),s.splice(c,1),c--}return n}),t.formatArgs.call(e,s),(r.log||t.log||console.log.bind(console)).apply(e,s)}}return r.namespace=e,r.enabled=t.enabled(e),r.useColors=t.useColors(),r.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),r.destroy=i,"function"==typeof t.init&&t.init(r),t.instances.push(r),r}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(166),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){var n=1e3,r=6e4,i=36e5,o=24*i;function s(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var a=typeof e;if("string"===a&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===a&&!1===isNaN(e))return t.long?function(e){return s(e,o,"day")||s(e,i,"hour")||s(e,r,"minute")||s(e,n,"second")||e+" ms"}(e):function(e){return e>=o?Math.round(e/o)+"d":e>=i?Math.round(e/i)+"h":e>=r?Math.round(e/r)+"m":e>=n?Math.round(e/n)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){(function(t){var r=n(70),i=n(28);e.exports=h;var o,s=/\n/g,a=/\\n/g;function c(){}function h(e){r.call(this,e),this.query=this.query||{},o||(t.___eio||(t.___eio=[]),o=t.___eio),this.index=o.length;var n=this;o.push(function(e){n.onData(e)}),this.query.j=this.index,t.document&&t.addEventListener&&t.addEventListener("beforeunload",function(){n.script&&(n.script.onerror=c)},!1)}i(h,r),h.prototype.supportsBinary=!1,h.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},h.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},h.prototype.doWrite=function(e,t){var n=this;if(!this.form){var r,i=document.createElement("form"),o=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=c,i.method="POST",i.setAttribute("accept-charset","utf-8"),o.name="d",i.appendChild(o),document.body.appendChild(i),this.form=i,this.area=o}function h(){u(),t()}function u(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(e)}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),u(),e=e.replace(a,"\\\n"),this.area.value=e.replace(s,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&h()}:this.iframe.onload=h}}).call(this,n(0))},function(e,t,n){(function(t){var r,i=n(39),o=n(18),s=n(27),a=n(28),c=n(72),h=n(29)("engine.io-client:websocket"),u=t.WebSocket||t.MozWebSocket;if("undefined"==typeof window)try{r=n(169)}catch(e){}var l=u;function d(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=u&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(l=r),i.call(this,e)}l||"undefined"!=typeof window||(l=r),e.exports=d,a(d,i),d.prototype.name="websocket",d.prototype.supportsBinary=!0,d.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new l(e,t):new l(e):new l(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},d.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},d.prototype.write=function(e){var n=this;this.writable=!1;for(var r=e.length,i=0,s=r;i<s;i++)!function(e){o.encodePacket(e,n.supportsBinary,function(i){if(!n.usingBrowserWebSocket){var o={};e.options&&(o.compress=e.options.compress),n.perMessageDeflate&&("string"==typeof i?t.Buffer.byteLength(i):i.length)<n.perMessageDeflate.threshold&&(o.compress=!1)}try{n.usingBrowserWebSocket?n.ws.send(i):n.ws.send(i,o)}catch(e){h("websocket closed before onclose event")}--r||(n.emit("flush"),setTimeout(function(){n.writable=!0,n.emit("drain")},0))})}(e[i])},d.prototype.onClose=function(){i.prototype.onClose.call(this)},d.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},d.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||(e.b64=1),(e=s.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},d.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===d.prototype.name)}}).call(this,n(0))},function(e,t){},function(e,t){e.exports=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n}},function(e,t){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},function(e,t,n){"use strict";const r=n(173)("spray-wrtc"),i=n(30),o=n(5),s=n(206),a=n(208),c=n(209),h=n(210),u=n(211),l=n(212);e.exports=class extends i{constructor(e={}){super(o({pid:"spray-wrtc",delta:12e4,timeout:6e4,a:1,b:0,retry:5},e)),r("[%s] Initalized with ==> %s ==>",this.PID,this.PEER),this.partialView=new s,this.state="disconnected",this.periodic=null,this.on("receive",(e,t)=>this._receive(e,t)),this.on("open",e=>{this._open(e),this._updateState()}),this.on("close",e=>{this._close(e),this._updateState()}),this.on("fail",e=>{this._onArcDown(e),this._updateState()})}_start(e=this.options.delta){this.periodic=setInterval(()=>{this._exchange()},e)}_stop(){clearInterval(this.periodic)}_receive(e,t){if(t.type&&"MExchange"===t.type)this._onExchange(e,t);else if(t.type&&"MJoin"===t.type)this._onJoin(e);else{if(!t.type||"MLeave"!==t.type)throw new u("_receive",t,"unhandled");this._onLeave(e)}}_open(e){r("[%s] Open %s ===> %s",this.PID,this.PEER,e),this.partialView.add(e)}_close(e){r("[%s] Close %s =†=> %s",this.PID,this.PEER,e),setTimeout(()=>{!this.o.has(e)&&this.partialView.has(e)&&this._onPeerDown(e)},5e3)}_updateState(){const e=this.state;this.i.size>0&&this.o.size>0&&"connected"!==e?this.state="connected":(this.i.size>0&&this.o.size<=0||this.o.size>0&&this.i.size<=0)&&"partially connected"!==e?this.state="partially connected":this.i.size<=0&&this.o.size<=0&&"disconnected"!==e&&(this.state="disconnected"),e!==this.state&&this.emit("statechange",this.state)}join(e){let t=new Promise((e,t)=>{"disconnected"!==this.state&&t(new l("join","Already connected."));let n=setTimeout(()=>{t(new l("join","Timeout exceeded."))},this.options.timeout);this.once("open",r=>{this.send(r,new c,this.options.retry).then(()=>{clearTimeout(n),this._start(),this._inject(this.options.a-1,0,r),e(r)}).catch(()=>{t(new l("join","Could not notify remote contact."))})})});return this.connect(e),t}_onJoin(e){this._checkPartialView(),this.partialView.size>0?(r("[%s] %s ===> join %s ===> %s neighbors",this.PID,e,this.PEER,this.partialView.size),this.partialView.forEach((t,n)=>{t.forEach(t=>{this.connect(n,e)})})):(r("[%s] %s ===> join %s ===> %s",this.PID,e,this.PEER,e),this._inject(2*this.options.a,2*this.options.b,e),this._start())}leave(e=0){const t=this.NI.options.timeout,n=this.NO.options.timeout;if(this.NI.options.timeout=e,this.NO.options.timeout=e,this._stop(),e>0){let e=[];this.getInview().forEach((t,n)=>e.push(n));let t=this.getOutview(),n=[];t.forEach((e,t)=>n.push(t));let r=t.size-this.options.a;for(let t=0;t<Math.floor(r);++t){const t=Math.floor(Math.random()*e.length);let r=n.filter(n=>n!==e[t]);if(r.length>0){const n=Math.floor(Math.random()*r.length);this.connect(e[t],r[n])}}e.forEach(e=>{this.send(e,new h,this.options.retry).catch(e=>{})}),n.forEach(e=>{this._onLeave(e)})}else this.partialView.clear(),this.disconnect();this.NI.options.timeout=t,this.NO.options.timeout=n}_onLeave(e){if(this.partialView.has(e)){r("[%s] %s ==> ††† %s †††",this.PID,this.PEER,e);const t=this.partialView.removeAll(e);for(let n=0;n<t;++n)this.disconnect(e)}}getPeers(e){let t=[];if(void 0===e)this.partialView.forEach((e,n)=>{t.push(n)});else{let n=[];for(this.partialView.forEach((e,t)=>n.push(t));t.length<e&&n.length>0;){let e=Math.floor(Math.random()*n.length);t.push(n[e]),n.splice(e,1)}let r=[];for(this.i.forEach((e,t)=>r.push(t));t.length<e&&r.length>0;){let e=Math.floor(Math.random()*r.length);t.push(r[e]),r.splice(e,1)}}return r("[%s] %s provides %s peers",this.PID,this.PEER,t.length),t}_checkPartialView(){let e=[];this.partialView.forEach((t,n)=>{this.o.has(n)||e.push(n)}),e.forEach(e=>{this._onPeerDown(e)})}_getSample(e){let t=[],n=[];this.partialView.forEach((e,t)=>{e.forEach(e=>{n.push(t)})});const r=Math.ceil(n.length/2);for(void 0!==e&&(n.splice(n.indexOf(e),1),t.push(e));t.length<r;){const e=Math.floor(Math.random()*n.length);t.push(n[e]),n.splice(e,1)}return t}_exchange(){if(this._checkPartialView(),this.partialView.size<=0)return;this.partialView.increment();const e=this.partialView.oldest;this.send(e,new a(this.getInviewId()),this.options.retry).then(()=>{let t=this._getSample(e);r("[%s] %s ==> exchange %s ==> %s",this.PID,this.PEER,t.length,e),(t=t.map(t=>t===e&&this.getInviewId()||t)).forEach(t=>{this.connect(e,t)}),(t=t.map(t=>t===this.getInviewId()&&e||t)).forEach(t=>{this.disconnect(t),t===e?this.partialView.removeOldest(t):this.partialView.removeYoungest(t)})}).catch(t=>{r("[%s] %s =X> exchange =X> %s",this.PID,this.PEER,e),this._onPeerDown(e)})}_onExchange(e,t){this._checkPartialView(),this.partialView.increment();let n=this._getSample();r("[%s] %s ==> exchange %s ==> %s",this.PID,e,n.length,this.PEER),(n=n.map(e=>e===t.inview?this.getInviewId():e)).forEach(t=>{this.connect(e,t)}),(n=n.map(e=>e===this.getInviewId()?t.inview:e)).forEach(e=>{this.disconnect(e),this.partialView.removeYoungest(e)})}_onPeerDown(e){r("[%s] onPeerDown ==> %s ==> XXX %s XXX",this.PID,this.PEER,e);const t=this.partialView.removeAll(e),n=this.options.a/(this.partialView.size+t);if(this.partialView.size>0)for(let e=0;e<t;++e)Math.random()>n&&this.connect(null,this.partialView.leastFrequent)}_onArcDown(e){r("[%s] ==> %s =X> %s",this.PID,this.PEER,e||"unknown"),this.partialView.size>0&&this.connect(null,this.partialView.leastFrequent)}_inject(e,t,n){let r=e;for(let t=0;t<Math.floor(e);++t)this.connect(null,n),r-=1;Math.random()<r&&this.connect(null,n);let i=t;for(let e=0;e<Math.floor(t);++e)this.connect(null,n),i-=1;Math.random()<i&&this.connect(null,n)}}},function(e,t,n){"use strict";(function(r){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++r)}),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(174)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(1))},function(e,t,n){"use strict";e.exports=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){var n;function s(){if(s.enabled){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=s,a=Number(new Date),c=a-(n||a);o.diff=c,o.prev=n,o.curr=a,n=a,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var h=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,function(e,n){if("%%"===e)return e;h++;var i=r.formatters[n];if("function"==typeof i){var s=t[h];e=i.call(o,s),t.splice(h,1),h--}return e}),r.formatArgs.call(o,t),(o.log||r.log).apply(o,t)}}return s.namespace=e,s.enabled=r.enabled(e),s.useColors=r.useColors(),s.color=t(e),s.destroy=i,s.extend=o,"function"==typeof r.init&&r.init(s),r.instances.push(s),s}function i(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){return r(this.namespace+(void 0===t?":":t)+e)}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var o=r.instances[t];o.enabled=r.enabled(o.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(11),Object.keys(e).forEach(function(t){r[t]=e[t]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},function(e,t,n){"use strict";(function(r){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++r)}),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(176)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(1))},function(e,t,n){"use strict";e.exports=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){var n;function s(){if(s.enabled){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=s,a=Number(new Date),c=a-(n||a);o.diff=c,o.prev=n,o.curr=a,n=a,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var h=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,function(e,n){if("%%"===e)return e;h++;var i=r.formatters[n];if("function"==typeof i){var s=t[h];e=i.call(o,s),t.splice(h,1),h--}return e}),r.formatArgs.call(o,t),(o.log||r.log).apply(o,t)}}return s.namespace=e,s.enabled=r.enabled(e),s.useColors=r.useColors(),s.color=t(e),s.destroy=i,s.extend=o,"function"==typeof r.init&&r.init(s),r.instances.push(s),s}function i(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){return r(this.namespace+(void 0===t?":":t)+e)}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var o=r.instances[t];o.enabled=r.enabled(o.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(11),Object.keys(e).forEach(function(t){r[t]=e[t]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},function(e,t,n){"use strict";const r=n(178)("neighborhood-wrtc"),i=n(5),o=n(8),s=n(180),a=n(190),c=n(193),h=n(194),u=n(195),l=n(196),d=n(197),f=n(198),p=n(199),g=n(200),y=n(201);e.exports=class{constructor(e){this.options={socketClass:s,peer:o(),config:{trickle:!0,initiator:!1},timeout:6e4,pendingTimeout:1e4,encoding:e=>JSON.stringify(e),decoding:e=>JSON.parse(e)},this.options=i(this.options,e),this.encode=this.options.encoding,this.decode=this.options.decoding,this.PEER=this.options.peer,r("[%s] initialized.",this.PEER),this.pending=new Map,this.living=new a,this.dying=new Map,this.protocols=new Map}register(e){if(this.protocols.has(e._pid()))throw new g(e._pid());return r("[%s] protocol %s just registered.",this.PEER,e._pid()),this.protocols.set(e._pid(),e),new u(this.PEER,this._connect.bind(this,e._pid()),this._disconnect.bind(this,e._pid()),this._send.bind(this,e._pid()),this._stream.bind(this,e._pid()),this._neighbours.bind(this))}_connect(e,t,n){"function"==typeof t&&void 0===n?this._initiate(e,t):"function"==typeof t&&void 0!==n?this._accept(e,t,n):this._finalize(e,t)}_initiate(e,t){this.options.config.initiator=!0;let n=new(0,this.options.socketClass)(this.options.config),i=new c(o(),null,e,n);this.pending.set(i.tid,i),n.once("connect",()=>{i.successful=!0,this.living.contains(i.peer)?(i.alreadyExists=!0,i.successful=!0,this.living.insert(i.peer,e),r("[%s] --- arc --\x3e %s",this.PEER,i.peer),this.protocols.get(e)._connected(i.peer,!0),i.peer=null):(this.living.insert(i.peer,e,n),r("[%s] --- WebRTC --\x3e %s",this.PEER,i.peer),this.protocols.get(e)._connected(i.peer,!0)),this._checkPendingEntry(i)}),n.once("close",()=>{if(null!==i.peer){if(this.living.contains(i.peer))this.living.removePeer(i.peer).forEach((e,t)=>{for(let n=0;n<e;++n)this.protocols.get(t)._disconnected(i.peer)});else if(this.dying.has(i.peer)){let e=this.dying.get(i.peer);clearTimeout(e.timeout),this.dying.delete(i.peer)}r("[%s] -‡- WebRTC -‡> %s",this.PEER,i.peer)}else r("[%s] -‡- WebRTC -‡> %s",this.PEER,"unknown");this._checkPendingEntry(i)}),n.on("data",e=>{let t=this.decode(e);"MInternalSend"===t.type?this._receiveInternalMessage(t):this.protocols.get(t.pid)._received(t.peer,t.payload)}),n.on("stream",e=>{this.protocols.get(i.pid)._streamed(i.peer,e)}),n.on("error",e=>{r(e),n.destroy()}),n.on("signal",r=>{n.connected&&!n._isNegociating?this._sendRenegociateRequest(new d(i.tid,this.PEER,e,r,"renegociate"),i.peer):t(new d(i.tid,this.PEER,e,r))}),setTimeout(()=>{(!i.successful||i.alreadyExists)&&null!==i.socket&&i.socket.destroy(),!i.successful&&this.protocols.get(e)._failed(i.peer,!0),this.pending.delete(i.tid)},this.options.pendingTimeout)}_finalize(e,t){if("renegociate"===t.offerType){if(r("[%s] _finalize regenociation:",t),this.living.store.has(t.peer)){const e=this.living.get(t.peer).socket;e.connected&&!e._isNegociating&&e.signal(t.offer)}return}if(!this.pending.has(t.tid))return;let n=this.pending.get(t.tid);if(n&&(n.alreadyExists||n.successful))return this._checkPendingEntry(n),void r("The socket already exists: ",n.peer);if(this.living.contains(t.peer))n.alreadyExists=!0,n.successful=!0,this.living.insert(t.peer,e),r("[%s] --- arc --\x3e %s",this.PEER,t.peer),this.protocols.get(e)._connected(t.peer,!0),this._checkPendingEntry(n);else if(this.dying.has(t.peer)){n.alreadyExists=!0,n.successful=!0;let i=this.dying.get(t.peer);clearTimeout(i.timeout),this.dying.delete(t.peer),this.living.insert(t.peer,e,i.socket),r("[%s] -¡- arc -¡> %s",this.PEER,t.peer),this.protocols.get(e)._connected(t.peer,!0),this._checkPendingEntry(n)}else{if(n.peer=t.peer,!t.offer)throw new y("_finalize",n,t);n.socket.signal(t.offer)}}_accept(e,t,n){if("renegociate"===n.offerType)return r("[%s] _accept regenociation:",n),void(this.living.store.has(n.peer)&&this.living.get(n.peer).socket.signal(n.offer));let i=!1;const o=n.tid,s=n.peer;if(!this.pending.has(o)){i=!0;let t=new c(o,s,e);this.pending.set(o,t),setTimeout(()=>{(!t.successful||t.alreadyExists)&&t.socket&&t.socket.destroy(),!t.successful&&this.protocols.get(e)._failed(s,!1),this.pending.delete(o)},this.options.pendingTimeout)}let a=this.pending.get(n.tid);if(!a.alreadyExists&&!a.successful)if(this.living.contains(n.peer))a.alreadyExists=!0,a.successful=!0,this.living.insert(n.peer,e),r("[%s] <-- arc --- %s",this.PEER,a.peer),this.protocols.get(e)._connected(n.peer,!1),i&&t(new l(a.tid,this.PEER,e,null)),this._checkPendingEntry(a);else if(this.dying.has(n.peer)){a.alreadyExists=!0,a.successful=!0;let o=this.dying.get(n.peer);clearTimeout(o.timeout),this.dying.delete(n.peer),this.living.insert(n.peer,e,o.socket),r("[%s] <¡- arc -¡- %s",this.PEER,n.peer),this.protocols.get(e)._connected(n.peer,!1),i&&t(new l(a.tid,this.PEER,e,null)),this._checkPendingEntry(a)}else{if(i&&!a.socket){this.options.config.initiator=!1;let n=new(0,this.options.socketClass)(this.options.config);a.socket=n,n.once("connect",()=>{a.successful=!0,this.living.contains(a.peer)?(a.alreadyExists=!0,a.successful=!0,this.living.insert(a.peer,e),r("[%s] <-- arc --- %s",this.PEER,a.peer),this.protocols.get(e)._connected(a.peer,!1),a.peer=null):(this.living.insert(a.peer,e,n),r("[%s] <-- WebRTC --- %s",this.PEER,a.peer),this.protocols.get(e)._connected(a.peer,!1)),this._checkPendingEntry(a)}),n.once("close",()=>{if(null!==a.peer){if(this.living.contains(a.peer))this.living.removePeer(a.peer).forEach((e,t)=>{for(let n=0;n<e;++n)this.protocols.get(t)._disconnected(a.peer)});else if(this.dying.has(a.peer)){let e=this.dying.get(a.peer);clearTimeout(e.timeout),this.dying.delete(a.peer)}r("[%s] <‡- WebRTC -‡- %s",this.PEER,a.peer)}else r("[%s] <‡- WebRTC -‡- %s",this.PEER,"unknown");this._checkPendingEntry(a)}),n.on("data",e=>{let t=this.decode(e);"MInternalSend"===t.type?this._receiveInternalMessage(t):this.protocols.get(t.pid)._received(t.peer,t.payload)}),n.on("stream",e=>{this.protocols.get(a.pid)._streamed(a.peer,e)}),n.on("error",e=>{r(e),n.destroy()}),n.on("signal",r=>{n.connected&&!n._isNegotiating?this._sendRenegociateResponse(new l(a.tid,this.PEER,e,r,"renegociate"),a.peer):t(new l(a.tid,this.PEER,e,r))})}a.socket.signal(n.offer)}}_disconnect(e,t){if(void 0===t)this.living.removeAll(e).forEach(n=>{if(null!==n.socket){var i=new h(n.peer,n.socket,setTimeout(()=>{n.socket&&n.socket.destroy()},this.options.timeout));this.dying.set(i.peer,i)}for(let i=0;i<n.occ;++i)null===n.socket||null!==n.socket&&i<n.occ-1?r("[%s] ††† arc ††† %s",this.PEER,t):r("[%s] ††† WebRTC ††† %s",this.PEER,t),this.protocols.get(e)._disconnected(n.peer)});else{var n=null;try{n=this.living.remove(t,e)}catch(e){console.log(e)}if(n){var i=new h(n.peer,n.socket,setTimeout(()=>{n.socket&&n.socket.destroy()},this.options.timeout));this.dying.set(i.peer,i),r("[%s] ††† WebRTC ††† %s",this.PEER,t)}else r("[%s] ††† arc ††† %s",this.PEER,t);this.protocols.get(e)._disconnected(t)}}_send(e,t,n,i=0){return new Promise((o,s)=>{let a=null;this.living.contains(t)?a=this.living.get(t):this.dying.has(t)&&(a=this.dying.get(t)),null===a&&s(new Error("peer not found: "+t));let c=h=>{try{a.socket.send(this.encode(new f(this.PEER,e,n))),r("[%s] --- msg --\x3e %s:%s",this.PEER,t,e),o()}catch(n){r("[%s] -X- msg -X> %s:%s",this.PEER,t,e),h<i?setTimeout(()=>{c(h+1)},1e3):s(n)}};c(0)})}_stream(e,t,n,i=0){return new Promise((o,s)=>{let a=null;this.living.contains(t)?a=this.living.get(t):this.dying.has(t)&&(a=this.dying.get(t)),null===a&&(this.living.store.forEach(e=>{r(e.peer)}),s(new Error("peer not found: "+t)));let c=h=>{try{a.socket.addStream(n),r("[%s] --- MEDIA msg --\x3e %s:%s",this.PEER,t,e),o()}catch(n){r("[%s] -X- MEDIA msg -X> %s:%s",this.PEER,t,e),h<i?setTimeout(()=>{c(h+1)},1e3):s(n)}};c(0)})}_sendRenegociateRequest(e,t,n=0){return new Promise((i,o)=>{let s=null;this.living.contains(t)?s=this.living.get(t):this.dying.has(t)&&(s=this.dying.get(t)),null===s&&(this.living.store.forEach(e=>{r(e.peer)}),o(new Error("peer not found: "+t)));let a=c=>{try{s.socket.send(this.encode(new p(this.PEER,null,e))),r("[%s] --- MEDIA Internal Renegociate msg --\x3e %s:%s",this.PEER,t),i()}catch(e){r("[%s] -X- MEDIA Internal Renegociate msg -X> %s:%s",this.PEER,t),c<n?setTimeout(()=>{a(c+1)},1e3):o(e)}};a(0)})}_sendRenegociateResponse(e,t,n=0){return new Promise((i,o)=>{let s=null;this.living.contains(t)?s=this.living.get(t):this.dying.has(t)&&(s=this.dying.get(t)),null===s&&(this.living.store.forEach(e=>{r(e.peer)}),o(new Error("peer not found: "+t)));let a=c=>{try{s.socket.send(this.encode(new p(this.PEER,null,e))),r("[%s] --- MEDIA Internal Renegociate msg --\x3e %s:%s",this.PEER,t),i()}catch(e){r("[%s] -X- MEDIA Internal Renegociate msg -X> %s:%s",this.PEER,t),c<n?setTimeout(()=>{a(c+1)},1e3):o(e)}};a(0)})}_receiveInternalMessage(e){this.living.get(e.peer).socket.signal(e.payload.offer)}_neighbours(){const e=[];return this.living.store.forEach(t=>{e.push(t)}),e}_checkPendingEntry(e){this.pending.has(e.tid)&&(null===e.peer&&e.socket&&(e.socket.destroy(),e.socket=null),this.pending.delete(e.tid))}}},function(e,t,n){"use strict";(function(r){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++r)}),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(179)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(1))},function(e,t,n){"use strict";e.exports=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){var n;function s(){if(s.enabled){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=s,a=Number(new Date),c=a-(n||a);o.diff=c,o.prev=n,o.curr=a,n=a,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var h=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,function(e,n){if("%%"===e)return e;h++;var i=r.formatters[n];if("function"==typeof i){var s=t[h];e=i.call(o,s),t.splice(h,1),h--}return e}),r.formatArgs.call(o,t),(o.log||r.log).apply(o,t)}}return s.namespace=e,s.enabled=r.enabled(e),s.useColors=r.useColors(),s.color=t(e),s.destroy=i,s.extend=o,"function"==typeof r.init&&r.init(s),r.instances.push(s),s}function i(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){return r(this.namespace+(void 0===t?":":t)+e)}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var o=r.instances[t];o.enabled=r.enabled(o.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(11),Object.keys(e).forEach(function(t){r[t]=e[t]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},function(e,t,n){(function(t){e.exports=c;var r=n(181)("simple-peer"),i=n(183),o=n(2),s=n(184),a=n(185);function c(e){var t=this;if(!(t instanceof c))return new c(e);if(t._id=s(4).toString("hex").slice(0,7),t._debug("new peer %o",e),e=Object.assign({allowHalfOpen:!1},e),a.Duplex.call(t,e),t.channelName=e.initiator?e.channelName||s(20).toString("hex"):null,t._isChromium="undefined"!=typeof window&&!!window.webkitRTCPeerConnection,t.initiator=e.initiator||!1,t.channelConfig=e.channelConfig||c.channelConfig,t.config=e.config||c.config,t.constraints=t._transformConstraints(e.constraints||c.constraints),t.offerConstraints=t._transformConstraints(e.offerConstraints||{}),t.answerConstraints=t._transformConstraints(e.answerConstraints||{}),t.sdpTransform=e.sdpTransform||function(e){return e},t.streams=e.streams||(e.stream?[e.stream]:[]),t.trickle=void 0===e.trickle||e.trickle,t.destroyed=!1,t.connected=!1,t.remoteAddress=void 0,t.remoteFamily=void 0,t.remotePort=void 0,t.localAddress=void 0,t.localPort=void 0,t._wrtc=e.wrtc&&"object"==typeof e.wrtc?e.wrtc:i(),!t._wrtc)throw"undefined"==typeof window?h("No WebRTC support: Specify `opts.wrtc` option in this environment","ERR_WEBRTC_SUPPORT"):h("No WebRTC support: Not a supported browser","ERR_WEBRTC_SUPPORT");t._pcReady=!1,t._channelReady=!1,t._iceComplete=!1,t._channel=null,t._pendingCandidates=[],t._isNegotiating=!1,t._batchedNegotiation=!1,t._queuedNegotiation=!1,t._sendersAwaitingStable=[],t._senderMap=new WeakMap,t._remoteTracks=[],t._remoteStreams=[],t._chunk=null,t._cb=null,t._interval=null,t._pc=new t._wrtc.RTCPeerConnection(t.config,t.constraints),t._isReactNativeWebrtc="number"==typeof t._pc._peerConnectionId,t._pc.oniceconnectionstatechange=function(){t._onIceStateChange()},t._pc.onicegatheringstatechange=function(){t._onIceStateChange()},t._pc.onsignalingstatechange=function(){t._onSignalingStateChange()},t._pc.onicecandidate=function(e){t._onIceCandidate(e)},t.initiator?t._setupData({channel:t._pc.createDataChannel(t.channelName,t.channelConfig)}):t._pc.ondatachannel=function(e){t._setupData(e)},"addTrack"in t._pc&&(t.streams&&t.streams.forEach(function(e){t.addStream(e)}),t._pc.ontrack=function(e){t._onTrack(e)}),t.initiator&&t._needsNegotiation(),t._onFinishBound=function(){t._onFinish()},t.once("finish",t._onFinishBound)}function h(e,t){var n=new Error(e);return n.code=t,n}function u(){}o(c,a.Duplex),c.WEBRTC_SUPPORT=!!i(),c.config={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]},c.constraints={},c.channelConfig={},Object.defineProperty(c.prototype,"bufferSize",{get:function(){return this._channel&&this._channel.bufferedAmount||0}}),c.prototype.address=function(){return{port:this.localPort,family:"IPv4",address:this.localAddress}},c.prototype.signal=function(e){var t=this;if(t.destroyed)throw h("cannot signal after peer is destroyed","ERR_SIGNALING");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}t._debug("signal()"),e.renegotiate&&(t._debug("got request to renegotiate"),t._needsNegotiation()),e.candidate&&(t._pc.remoteDescription&&t._pc.remoteDescription.type?t._addIceCandidate(e.candidate):t._pendingCandidates.push(e.candidate)),e.sdp&&t._pc.setRemoteDescription(new t._wrtc.RTCSessionDescription(e),function(){t.destroyed||(t._pendingCandidates.forEach(function(e){t._addIceCandidate(e)}),t._pendingCandidates=[],"offer"===t._pc.remoteDescription.type&&t._createAnswer())},function(e){t.destroy(h(e,"ERR_SET_REMOTE_DESCRIPTION"))}),e.sdp||e.candidate||e.renegotiate||t.destroy(h("signal() called with invalid signal data","ERR_SIGNALING"))},c.prototype._addIceCandidate=function(e){var t=this;try{t._pc.addIceCandidate(new t._wrtc.RTCIceCandidate(e),u,function(e){t.destroy(h(e,"ERR_ADD_ICE_CANDIDATE"))})}catch(e){t.destroy(h("error adding candidate: "+e.message,"ERR_ADD_ICE_CANDIDATE"))}},c.prototype.send=function(e){this._channel.send(e)},c.prototype.addStream=function(e){var t=this;t._debug("addStream()"),e.getTracks().forEach(function(n){t.addTrack(n,e)})},c.prototype.addTrack=function(e,t){this._debug("addTrack()");var n=this._pc.addTrack(e,t),r=this._senderMap.get(e)||new WeakMap;r.set(t,n),this._senderMap.set(e,r),this._needsNegotiation()},c.prototype.removeTrack=function(e,t){this._debug("removeSender()");var n=this._senderMap.get(e),r=n?n.get(t):null;r||this.destroy(new Error("Cannot remove track that was never added."));try{this._pc.removeTrack(r)}catch(e){"NS_ERROR_UNEXPECTED"===e.name?this._sendersAwaitingStable.push(r):this.destroy(e)}},c.prototype.removeStream=function(e){var t=this;t._debug("removeSenders()"),e.getTracks().forEach(function(n){t.removeTrack(n,e)})},c.prototype._needsNegotiation=function(){var e=this;e._debug("_needsNegotiation"),e._batchedNegotiation||(e._batchedNegotiation=!0,setTimeout(function(){e._batchedNegotiation=!1,e._debug("starting batched negotiation"),e.negotiate()},0))},c.prototype.negotiate=function(){this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),this._createOffer()):(this._debug("requesting negotiation from initiator"),this.emit("signal",{renegotiate:!0})),this._isNegotiating=!0},c.prototype.destroy=function(e){this._destroy(e,function(){})},c.prototype._destroy=function(e,t){if(!this.destroyed){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.destroyed=!0,this.connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(e){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(e){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,"addTrack"in this._pc&&(this._pc.ontrack=null),this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),t()}},c.prototype._setupData=function(e){var t=this;if(!e.channel)return t.destroy(h("Data channel event is missing `channel` property","ERR_DATA_CHANNEL"));t._channel=e.channel,t._channel.binaryType="arraybuffer","number"==typeof t._channel.bufferedAmountLowThreshold&&(t._channel.bufferedAmountLowThreshold=65536),t.channelName=t._channel.label,t._channel.onmessage=function(e){t._onChannelMessage(e)},t._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},t._channel.onopen=function(){t._onChannelOpen()},t._channel.onclose=function(){t._onChannelClose()},t._channel.onerror=function(e){t.destroy(h(e,"ERR_DATA_CHANNEL"))}},c.prototype._read=function(){},c.prototype._write=function(e,t,n){if(this.destroyed)return n(h("cannot write after peer is destroyed","ERR_DATA_CHANNEL"));if(this.connected){try{this.send(e)}catch(e){return this.destroy(h(e,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>65536?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=n):n(null)}else this._debug("write before connect"),this._chunk=e,this._cb=n},c.prototype._onFinish=function(){var e=this;function t(){setTimeout(function(){e.destroy()},1e3)}e.destroyed||(e.connected?t():e.once("connect",t))},c.prototype._createOffer=function(){var e=this;e.destroyed||e._pc.createOffer(function(t){function n(){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})}e.destroyed||(t.sdp=e.sdpTransform(t.sdp),e._pc.setLocalDescription(t,function(){e._debug("createOffer success"),e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))},function(t){e.destroy(h(t,"ERR_SET_LOCAL_DESCRIPTION"))}))},function(t){e.destroy(h(t,"ERR_CREATE_OFFER"))},e.offerConstraints)},c.prototype._createAnswer=function(){var e=this;e.destroyed||e._pc.createAnswer(function(t){function n(){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})}e.destroyed||(t.sdp=e.sdpTransform(t.sdp),e._pc.setLocalDescription(t,function(){e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))},function(t){e.destroy(h(t,"ERR_SET_LOCAL_DESCRIPTION"))}))},function(t){e.destroy(h(t,"ERR_CREATE_ANSWER"))},e.answerConstraints)},c.prototype._onIceStateChange=function(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(h("Ice connection failed.","ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(new Error("Ice connection closed."))}},c.prototype.getStats=function(e){var t=this;0===t._pc.getStats.length?t._pc.getStats().then(function(t){var n=[];t.forEach(function(e){n.push(e)}),e(null,n)},function(t){e(t)}):t._isReactNativeWebrtc?t._pc.getStats(null,function(t){var n=[];t.forEach(function(e){n.push(e)}),e(null,n)},function(t){e(t)}):t._pc.getStats.length>0?t._pc.getStats(function(n){if(!t.destroyed){var r=[];n.result().forEach(function(e){var t={};e.names().forEach(function(n){t[n]=e.stat(n)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,r.push(t)}),e(null,r)}},function(t){e(t)}):e(null,[])},c.prototype._maybeReady=function(){var e=this;e._debug("maybeReady pc %s channel %s",e._pcReady,e._channelReady),!e.connected&&!e._connecting&&e._pcReady&&e._channelReady&&(e._connecting=!0,function t(){e.destroyed||e.getStats(function(n,r){if(!e.destroyed){n&&(r=[]);var i={},o={},s={},a=!1;if(r.forEach(function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(i[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(o[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(s[e.id]=e)}),r.forEach(function(e){"transport"===e.type&&e.selectedCandidatePairId&&u(s[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&u(e)}),a||Object.keys(s).length&&!Object.keys(o).length){if(e._connecting=!1,e.connected=!0,e._chunk){try{e.send(e._chunk)}catch(n){return e.destroy(h(n,"ERR_DATA_CHANNEL"))}e._chunk=null,e._debug('sent chunk from "write before connect"');var c=e._cb;e._cb=null,c(null)}"number"!=typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval(function(){e._onInterval()},150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}else setTimeout(t,100)}function u(t){a=!0;var n=o[t.localCandidateId];n&&n.ip?(e.localAddress=n.ip,e.localPort=Number(n.port)):n&&n.ipAddress?(e.localAddress=n.ipAddress,e.localPort=Number(n.portNumber)):"string"==typeof t.googLocalAddress&&(n=t.googLocalAddress.split(":"),e.localAddress=n[0],e.localPort=Number(n[1]));var r=i[t.remoteCandidateId];r&&r.ip?(e.remoteAddress=r.ip,e.remotePort=Number(r.port)):r&&r.ipAddress?(e.remoteAddress=r.ipAddress,e.remotePort=Number(r.portNumber)):"string"==typeof t.googRemoteAddress&&(r=t.googRemoteAddress.split(":"),e.remoteAddress=r[0],e.remotePort=Number(r[1])),e.remoteFamily="IPv4",e._debug("connect local: %s:%s remote: %s:%s",e.localAddress,e.localPort,e.remoteAddress,e.remotePort)}})}())},c.prototype._onInterval=function(){!this._cb||!this._channel||this._channel.bufferedAmount>65536||this._onChannelBufferedAmountLow()},c.prototype._onSignalingStateChange=function(){var e=this;e.destroyed||("stable"===e._pc.signalingState&&(e._isNegotiating=!1,e._debug("flushing sender queue",e._sendersAwaitingStable),e._sendersAwaitingStable.forEach(function(t){e.removeTrack(t),e._queuedNegotiation=!0}),e._sendersAwaitingStable=[],e._queuedNegotiation&&(e._debug("flushing negotiation queue"),e._queuedNegotiation=!1,e._needsNegotiation()),e._debug("negotiate"),e.emit("negotiate")),e._debug("signalingStateChange %s",e._pc.signalingState),e.emit("signalingStateChange",e._pc.signalingState))},c.prototype._onIceCandidate=function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||(this._iceComplete=!0,this.emit("_iceComplete")))},c.prototype._onChannelMessage=function(e){if(!this.destroyed){var n=e.data;n instanceof ArrayBuffer&&(n=t.from(n)),this.push(n)}},c.prototype._onChannelBufferedAmountLow=function(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}},c.prototype._onChannelOpen=function(){this.connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())},c.prototype._onChannelClose=function(){this.destroyed||(this._debug("on channel close"),this.destroy())},c.prototype._onTrack=function(e){var t=this;t.destroyed||e.streams.forEach(function(n){t._debug("on track"),t.emit("track",e.track,n),t._remoteTracks.push({track:e.track,stream:n}),t._remoteStreams.some(function(e){return e.id===n.id})||(t._remoteStreams.push(n),setTimeout(function(){t.emit("stream",n)},0))})},c.prototype._debug=function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],r.apply(null,e)},c.prototype._transformConstraints=function(e){if(0===Object.keys(e).length)return e;if((e.mandatory||e.optional)&&!this._isChromium){var t=Object.assign({},e.optional,e.mandatory);return void 0!==t.OfferToReceiveVideo&&(t.offerToReceiveVideo=t.OfferToReceiveVideo,delete t.OfferToReceiveVideo),void 0!==t.OfferToReceiveAudio&&(t.offerToReceiveAudio=t.OfferToReceiveAudio,delete t.OfferToReceiveAudio),t}return e.mandatory||e.optional||!this._isChromium?e:(void 0!==e.offerToReceiveVideo&&(e.OfferToReceiveVideo=e.offerToReceiveVideo,delete e.offerToReceiveVideo),void 0!==e.offerToReceiveAudio&&(e.OfferToReceiveAudio=e.offerToReceiveAudio,delete e.offerToReceiveAudio),{mandatory:e})}}).call(this,n(10).Buffer)},function(e,t,n){"use strict";(function(r){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++r)}),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(182)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(1))},function(e,t,n){"use strict";e.exports=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){var n;function s(){if(s.enabled){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=s,a=Number(new Date),c=a-(n||a);o.diff=c,o.prev=n,o.curr=a,n=a,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var h=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,function(e,n){if("%%"===e)return e;h++;var i=r.formatters[n];if("function"==typeof i){var s=t[h];e=i.call(o,s),t.splice(h,1),h--}return e}),r.formatArgs.call(o,t),(o.log||r.log).apply(o,t)}}return s.namespace=e,s.enabled=r.enabled(e),s.useColors=r.useColors(),s.color=t(e),s.destroy=i,s.extend=o,"function"==typeof r.init&&r.init(s),r.instances.push(s),s}function i(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){return r(this.namespace+(void 0===t?":":t)+e)}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var o=r.instances[t];o.enabled=r.enabled(o.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(11),Object.keys(e).forEach(function(t){r[t]=e[t]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},function(e,t){e.exports=function(){if("undefined"==typeof window)return null;var e={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}},function(e,t,n){"use strict";(function(t,r){var i=n(7).Buffer,o=t.crypto||t.msCrypto;o&&o.getRandomValues?e.exports=function(e,n){if(e>65536)throw new Error("requested too many random bytes");var s=new t.Uint8Array(e);e>0&&o.getRandomValues(s);var a=i.from(s.buffer);return"function"==typeof n?r.nextTick(function(){n(null,a)}):a}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this,n(0),n(1))},function(e,t,n){(t=e.exports=n(78)).Stream=t,t.Readable=t,t.Writable=n(81),t.Duplex=n(19),t.Transform=n(82),t.PassThrough=n(189)},function(e,t){},function(e,t,n){"use strict";var r=n(7).Buffer,i=n(188);function o(e,t,n){e.copy(t,n)}e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t=r.allocUnsafe(e>>>0),n=this.head,i=0;n;)o(n.data,t,i),i+=n.data.length,n=n.next;return t},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){"use strict";e.exports=o;var r=n(82),i=n(4);function o(e){if(!(this instanceof o))return new o(e);r.call(this,e)}i.inherits=n(2),i.inherits(o,r),o.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){"use strict";const r=n(191),i=n(192);e.exports=class{constructor(){this.store=new Map}insert(e,t,n){if(null===n&&!this.store.has(e))throw new i("arcStore",e,t,"Try to add an arc to a peer that does not exists");if(this.store.has(e))this.store.get(e).increment(t);else{let i=new r(e,t,n);this.store.set(e,i)}}remove(e,t){let n=null;if(!this.store.has(e))throw new i("arcStore",e,t,"Try to remove an arc to a peer that does not exists");if(!this.store.get(e).decrement(t))throw new i("arcStore",e,t,"Try to remove an arc from a protocol that does not have this arc");return this.store.get(e).sum()<=0&&(n=this.store.get(e),this.store.delete(e)),n}removeAll(e){let t=[];return this.store.forEach((n,r)=>{if(n.protocols.has(e)){let i=n.protocols.get(e),o={peer:n.peer,socket:null,occ:i};for(let n=0;n<i;++n){let n=this.remove(r,e);null!==n&&(o.socket=n.socket,t.push(o))}}}),t}removePeer(e){let t;return this.store.has(e)?(t=this.store.get(e).protocols,this.store.delete(e)):t=new Map,t}contains(e){return this.store.has(e)}get(e){let t=null;return this.contains(e)&&(t=this.store.get(e)),t}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n){this.peer=e,this.socket=n,this.protocols=new Map,this.increment(t)}increment(e){this.protocols.has(e)||this.protocols.set(e,0),this.protocols.set(e,this.protocols.get(e)+1)}decrement(e){let t=!1;return this.protocols.has(e)&&(this.protocols.set(e,this.protocols.get(e)-1),this.protocols.get(e)<=0&&this.protocols.delete(e),t=!0),t}sum(){let e=0;return this.protocols.forEach((t,n)=>{e+=t}),e}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n,r){this.source=e,this.peer=t,this.protocolId=n,this.message=r}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n,r,i){this.tid=e,this.peer=t,this.pid=n,this.socket=r,this.successful=!1,this.alreadyExists=!1,this.timeout=i}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n){this.peer=e,this.socket=t,this.timeout=n}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n,r,i,o){this.peer=e,this.connect=t,this.disconnect=n,this.send=r,this.stream=i,this.neighbours=o}connect(e,t){this.connect(e,t)}disconnect(e){return this.disconnect(e)}send(e,t,n){return this.send(e,t)}stream(e,t,n){return this.stream(e,t)}neighbours(){return this.neighbours()}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n,r,i="init"){this.tid=e,this.peer=t,this.pid=n,this.offer=r,this.type="MResponse",this.offerType=i}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n,r,i="init"){this.tid=e,this.peer=t,this.pid=n,this.offer=r,this.type="MRequest",this.offerType=i}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n){this.peer=e,this.pid=t,this.payload=n,this.type="MSend"}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n){this.peer=e,this.pid=t,this.payload=n,this.type="MInternalSend"}}},function(e,t,n){"use strict";e.exports=class{constructor(e){this.pid=e,this.message="The idenfifier of the registering protocol already exists."}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n){this.source=e,this.entry=t,this.message=n}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n){this.from=e,this.to=t,this.message=n,this.type="MForwardTo"}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n){this.from=e,this.to=t,this.message=n,this.type="MForwarded"}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t){this.from=e,this.to=t,this.type="MConnectTo"}}},function(e,t,n){"use strict";e.exports=class{constructor(){this.type="MDirect"}}},function(e,t,n){"use strict";const r=n(207);e.exports=class extends Map{get oldest(){if(this.size<=0)throw new r("oldest");let e=null,t=0;return this.forEach((n,r)=>{t<=n[n.length-1]&&(e=r,t=n[n.length-1])}),e}increment(){this.forEach((e,t)=>{this.set(t,e.map(e=>e+1))})}add(e){!this.has(e)&&this.set(e,[]),this.get(e).unshift(0)}removeYoungest(e){if(!this.has(e))throw new r("removeYoungest",e);this.get(e).shift(),0===this.get(e).length&&this.delete(e)}removeOldest(e){if(!this.has(e))throw new r("removeOldest",e);this.get(e).pop(),0===this.get(e).length&&this.delete(e)}removeAll(e){if(!this.has(e))throw new r("removeAll",e);const t=this.get(e).length;return this.delete(e),t}get leastFrequent(){let e=[],t=1/0;return this.forEach((n,r)=>{n.length<t&&(e=[],t=n.length),n.length===t&&e.push(r)}),e[Math.floor(Math.random()*e.length)]}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t="unknown"){this.source=e,this.peer=t}}},function(e,t,n){"use strict";e.exports=class{constructor(e){this.inview=e,this.type="MExchange"}}},function(e,t,n){"use strict";e.exports=class{constructor(){this.type="MJoin"}}},function(e,t,n){"use strict";e.exports=class{constructor(){this.type="MLeave"}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n){this.source=e,this.message=t,this.reason=n}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t){this.source=e,this.message=t}}},function(e,t,n){const r=n(30),i=n(5),o=n(8),s=n(214),a=n(12)("cyclon");e.exports=class extends r{constructor(e){const t={pid:"cyclon",peer:o(),maxPeers:5,timeoutnetwork:2e4,timeoutconnection:2e4,retry:5,delta:3e4,timeout:3e4};super(i(t,e)),this._partialView=new s,this._periodic=void 0,this.on("receive",(e,t)=>this._receive(e,t)),this.on("open",e=>{this._open(e)}),this.on("close",e=>{this._close(e)}),this.on("fail",e=>{this._onArcDown(e)})}get partialView(){return this._partialView}join(e){return new Promise((t,n)=>{let r=setTimeout(()=>{n(new Error("conenction timed out"))},this.options.timeoutconnection);this.once("open",e=>{this.send(e,{type:"MJoin"},this.options.retry).then(()=>{clearTimeout(r),this._start(),t(e)}).catch(()=>{n(new Error("failed to send a MJoin message after establishing the connection. Please report."))})}),this.connect(e)})}_open(e){a("[%s] %s ===> %s",this.PID,this.PEER,e),this._partialView.has(e)||this._partialView.add(e),this._partialView.size>this.options.maxPeers&&this.disconnect(e)}_close(e){a("[%s] %s =†=> %s",this.PID,this.PEER,e),this._partialView.has(e)&&this._partialView.delete(e)}_onJoin(e){this._partialView.size>0?(a("[%s] %s ===> join %s ===> %s neighbors",this.PID,e,this.PEER,this._partialView.size),this._partialView.forEach((t,n)=>{this.connect(e,n)})):(a("[%s] %s ===> join %s ===> %s",this.PID,e,this.PEER,e),this.connect(null,e))}_onLeave(e){a("%s: just left the game!",e)}_start(){a("[%s] starting periodic shuffling with period=%f",this.PEER,this.options.delta),this._periodic=setInterval(()=>{this.exchange()},this.options.delta)}_stop(){clearInterval(this._periodic)}_receive(e,t){if(t.type&&"MExchange"===t.type)this._onExchange(e,t);else if(t.type&&"MExchangeBack"===t.type)this.emit("MExchangeBack-"+t.id,e,t);else if(t.type&&"MJoin"===t.type)this._onJoin(e);else if(t.type&&"MLeave"===t.type)this._onLeave(e);else{if(!t.type||"MBridge"!==t.type)throw new Error("_receive, message unhandled");this._onBridge(t.from,t.to)}}_exchange(){return this.exchange()}exchange(){return this.emit("begin-shuffle"),new Promise((e,t)=>{0===this._partialView.size&&e(),this._partialView.increment();const n=this._partialView.oldest,r=this._getSample(this.options.maxPeers);this._partialView.removeOldest(n),this._partialView.add(n),r.map(e=>{e.id===n&&(e.id=this.getInviewId(),e.age=0)}),a("[%s] Starting to exchange with %s with a sample of size: %f",this.PEER,n,r.length);const i=o();this.send(n,{type:"MExchange",id:i,from:this.getInviewId(),sample:r},this.options.retry).then(()=>{let t=setTimeout(()=>{this.removeAllListeners("MExchangeBack-"+i),e()},this.options.timeoutnetwork);this.once("MExchangeBack-"+i,(i,o)=>{clearTimeout(t);const s=o.sample.filter(e=>!this._partialView.has(e.id)&&e.id!==n&&e.id!==i);for(let e=0;e<s.length;e++){const t=s[e];if(this._partialView.size>=this.options.maxPeers){const e=Math.floor(Math.random()*r.length),n=r[e].id;r.splice(e,1),a("[%s] replacing entry %s by %s",this.PEER,n,t.id),this.disconnect(n),this._partialView.removeAll(n)}this.send(i,{type:"MBridge",from:this.getInviewId(),to:t.id},this.options.retry).then(()=>{}).catch(e=>{})}e()})}).catch(t=>{console.log("%s Error when sending the sample to %s",this.PEER,n),e()})}).then(()=>(this.emit("end-shuffle"),Promise.resolve())).catch(e=>(this.emit("end-shuffle"),Promise.reject(e)))}_onExchange(e,t){const n=t.sample.slice(0),r=String(t.from),i=this._getSample(this.options.maxPeers);a("[%s] Answer to a an exchange demande with %s with a sample of size: %f",this.PEER,r,i.length),t.type="MExchangeBack",t.sample=i,t.from=this.getInviewId(),this.send(e,t,this.options.retry);const o=n.filter(e=>!this._partialView.has(e.id));for(let t=0;t<o.length;t++){const n=o[t];if(this._partialView.size>=this.options.maxPeers){const e=Math.floor(Math.random()*i.length),t=i[e].id;i.splice(e,1),a("[%s] replacing entry %s by %s",this.PEER,t,n.id),this.disconnect(t),this._partialView.removeAll(t)}this.send(e,{type:"MBridge",from:this.getInviewId(),to:n.id},this.options.retry).then(()=>{}).catch(e=>{})}}_getSample(e){let t=[],n=[];this._partialView.forEach((e,t)=>{n.push({id:t,age:e[0]})});const r=Math.min(n.length,e);for(;t.length<r;){const e=Math.floor(Math.random()*n.length);t.push(n[e]),n.splice(e,1)}return t}getPeers(e){let t=[];if(void 0===e)this._partialView.forEach((e,n)=>{t.push(n)});else{let n=[];for(this._partialView.forEach((e,t)=>n.push(t));t.length<e&&n.length>0;){let e=Math.floor(Math.random()*n.length);t.push(n[e]),n.splice(e,1)}let r=[];for(this.i.forEach((e,t)=>r.push(t));t.length<e&&r.length>0;){let e=Math.floor(Math.random()*r.length);t.push(r[e]),r.splice(e,1)}}return t}_onBridge(e,t){e!==t&&this.connect(e,t)}_onArcDown(e){a("[%s] ONARCDOWN ==> %s =X> %s",this.PID,this.PEER,e||"unknown")}}},function(e,t){e.exports=class extends Map{get oldest(){if(this.size<=0)throw new Error("oldest peer not found");let e=null,t=0;return this.forEach((n,r)=>{t<=n[n.length-1]&&(e=r,t=n[n.length-1])}),e}increment(){this.forEach((e,t)=>{this.set(t,e.map(e=>e+1))})}add(e){!this.has(e)&&this.set(e,[]),this.get(e).unshift(0)}removeYoungest(e){if(!this.has(e))throw new Error("removeYoungest, peer not found"+e);this.get(e).shift(),0===this.get(e).length&&this.delete(e)}removeOldest(e){if(!this.has(e))throw new Error("removeOldest, peer not found:"+e);this.get(e).pop(),0===this.get(e).length&&this.delete(e)}removeAll(e){if(!this.has(e))throw new Error("removeAll, peer not found: "+e);const t=this.get(e).length;return this.delete(e),t}get leastFrequent(){let e=[],t=1/0;return this.forEach((n,r)=>{n.length<t&&(e=[],t=n.length),n.length===t&&e.push(r)}),e[Math.floor(Math.random()*e.length)]}}},function(module,exports,__webpack_require__){"use strict";const EventEmitter=__webpack_require__(3),lmerge=__webpack_require__(5),io=__webpack_require__(64);class SshControl extends EventEmitter{constructor(options={}){super(),this.options=lmerge({foglet:void 0,address:"http://localhost:4000/",verbose:!0,origins:"*"},options),this.signaling=io.connect(this.options.address,{origins:options.origins}),this.signaling.emit("join",{id:this.options.foglet.id}),this.signaling.on("remoteCommand",command=>{let parsed;this.log("remoteCommand",command);try{parsed=eval("("+command+")"),this.log(parsed),this.deserialize(parsed.command)(this.options.foglet)}catch(e){this.log(e)}})}deserialize(message){return eval("("+message+")")}log(e,t){this.options.verbose&&void 0!==e&&void 0!==t&&this.emit("logs",e,t)}}module.exports=SshControl},function(e,t,n){"use strict";const r=n(217),i=n(219),o=n(222);e.exports=function(e){return function(t,...n){let s;const a=class extends r{constructor(t,...n){super(e,t,...n)}};return t.map(e=>e.trim()).filter(e=>e.length>0).forEach((e,t)=>{"init"===e||"constructor"===e?s=new o(n[t]):(s=new i(e),n[t](s)),s.apply(a)}),a}}},function(e,t,n){"use strict";const r=n(218),i=n(84);e.exports=class{constructor(e,t,...n){this._name=e,this._foglet=t,this._answerQueue=new r,this._initHandlers(),"_init"in this&&this._init(...n)}_sendUnicast(e,t,n,r){this._foglet.sendUnicast(e,this._answerQueue.stamp(t,n,r))}_sendBroadcast(e){this._foglet.sendBroadcast(e)}_answerReply(e,t){this._answerQueue.resolve(t.answerID,t.value)}_answerReject(e,t){this._answerQueue.reject(t.answerID,t.value)}_initHandlers(){this._foglet.onUnicast((e,t)=>this._handleUnicast(e,t)),this._foglet.onBroadcast((e,t)=>this._handleBroadcast(e,t))}_handleUnicast(e,t){const n=i.handlerName(t.method);if(this._name===t.protocol&&n in this){const r=i.beforeReceiveName(t.method);if(r in this&&(t.payload=this[r](t.payload)),"answerReply"!==t.method||"answerReject"!==t.method){const r=n=>{this._sendUnicast(e,{protocol:this._name,method:"answerReply",payload:{answerID:t.answerID,value:n}})},i=n=>{this._sendUnicast(e,{protocol:this._name,method:"answerReject",payload:{answerID:t.answerID,value:n}})};this[n](e,t.payload,r,i)}else this[n](e,t.payload);const o=i.afterReceiveName(t.method);o in this&&this[o](t.payload)}}_handleBroadcast(e,t){const n=i.handlerName(t.method);if(this._name===t.protocol&&n in this){const r=i.beforeReceiveName(t.method);r in this&&(t.payload=this[r](t.payload)),this[n](e,t.payload);const o=i.afterReceiveName(t.method);o in this&&this[o](t.payload)}}}},function(e,t,n){"use strict";const r=n(8);e.exports=class{constructor(){this._waitingAnswers=new Map}stamp(e,t,n){const i=r();return this._waitingAnswers.set(i,{resolve:t,reject:n}),Object.assign({answerID:i},e)}resolve(e,t){this._waitingAnswers.has(e)&&(this._waitingAnswers.get(e).resolve(t),this._waitingAnswers.delete(e))}reject(e,t){this._waitingAnswers.has(e)&&(this._waitingAnswers.get(e).reject(t),this._waitingAnswers.delete(e))}}},function(e,t,n){"use strict";const r=n(220),i=n(221);e.exports=class{constructor(e){this._serviceName=e,this._builder=null,this._handler=null,this._beforeHooks={send:[],receive:[]},this._afterHooks={send:[],receive:[]}}get is(){return{unicast:()=>{this._builder=new r(this._serviceName)},broadcast:()=>{this._builder=new i(this._serviceName)}}}get on(){return{receive:e=>{this._handler=e}}}get before(){return{send:e=>this._beforeHooks.send.push(e),receive:e=>this._beforeHooks.receive.push(e)}}get after(){return{send:e=>this._afterHooks.send.push(e),receive:e=>this._afterHooks.receive.push(e)}}apply(e){if(!this._validate())throw new class extends Error{}("");this._builder.buildService(e),this._builder.buildHandler(e,this._handler),this._builder.buildBeforeHooks(e,this._beforeHooks),this._builder.buildAfterHooks(e,this._afterHooks)}_validate(){return null!==this._type&&null!==this._handler}}},function(e,t,n){"use strict";const r=n(85);e.exports=class extends r{buildService(e){const t=this.methodName,n=this.beforeSendName,r=this.afterSendName;e.prototype[t]=function(e,i){const o=this;return n in o&&(i=o[n](i)),new Promise(function(n,s){const a={protocol:o._name,method:t,payload:i};o._sendUnicast(e,a,n,s),r in o&&o[r](i)})}}}},function(e,t,n){"use strict";const r=n(85);e.exports=class extends r{buildService(e){const t=this.methodName,n=this.beforeSendName,r=this.afterSendName;e.prototype[t]=function(e){const i=this;n in i&&(e=i[n](e));const o={protocol:i._name,method:t,payload:e};i._sendBroadcast(o),r in i&&i[r](e)}}}},function(e,t,n){"use strict";e.exports=class{constructor(e){this._callback=e}apply(e){e.prototype._init=this._callback}}},function(e,t,n){"use strict";const r=n(22);e.exports=class extends r{constructor(e){if(super(e),!e.manager)throw new SyntaxError("Need the manager to access to other networks.");this.manager=e.manager}}},function(e,t,n){"use strict";const r=n(22),i=n(225),o=n(5);e.exports=class extends r{constructor(e,t){t.manager=e,super(t),this._manager=e,this._rps.parent.once("open",()=>{console.log("SON connected"),this._rps._start()})}get inviewId(){return this.rps.getInviewId()}get outviewId(){return this.rps.getOutviewId()}get descriptor(){return this._rps.options.descriptor}set descriptor(e){this._rps.options.descriptor=e}_buildRPS(e){this.options=o({config:e.webrtc},e);const t=o({descriptor:this._startDescriptor(),descriptorTimeout:this._descriptorTimeout(),ranking:this._rankingFunction()},this.options);return new i(t,e.manager._rps._network._rps)}_startDescriptor(){throw new Error("A valid TMan based overlay must implement a _descriptor method to generate a base descriptor")}_descriptorTimeout(){throw new Error("A valid TMan based overlay must implement a _descriptorTimeout method to give the timeout on descriptors")}_rankPeers(e,t,n,r,i){throw new Error("A valid TMan based overlay must implement a _rankPeers method to rank two peers"+`variable: ${e.toString()}${t.toString()}${n.toString()}${r.toString()}${i.toString()}`)}_rankingFunction(){return e=>(t,n)=>this._rankPeers(e,t.descriptor,n.descriptor,t,n)}getNeighbours(e){return this.rps.getPeers(e)}}},function(e,t,n){"use strict";const r=n(12)("tman-wrtc"),i=n(30),o=n(34),s=n(5),a=n(86),c=n(226),h=n(229),u=n(230),l=n(231),d=n(232),f=n(233),p=n(234),g=n(235),y=n(236),m=n(237);e.exports=class extends i{constructor(e={},t){super(s({pid:"tman-wrtc",delta:6e4,timeout:12e4,descriptorTimeout:1e4,retry:5,inview:t&&t.NI,outview:t&&t.NO,descriptor:{x:Math.random()},ranking:e=>(t,n)=>{const r=n.descriptor.x-e.descriptor.x,i=t.descriptor.x-e.descriptor.x;return Math.abs(i)-Math.abs(r)}},e)),r("[%s] Initalized with ==> %s ==>",this.PID,this.PEER),this.partialView=new c,this.cache=new h(this.options.timeout),this.state="disconnected",this.periodic=null,this.on("receive",(e,t)=>this._receive(e,t)),this.on("open",e=>{this._open(e),this._updateState()}),this.on("close",e=>{this._close(e),this._updateState()}),this.on("fail",e=>{this._onArcDown(e),this._updateState()}),this.parent=t||null,this.parent&&(this.unicast=new o(this.parent,{pid:"tman-wrtc-unicast",retry:this.options.retry}),this.parent.on("open",e=>!this.cache.has(e)&&this.unicast.emit("requestDescriptor",e,this.getOutviewId()).catch(e=>{console.error(e)})),this.unicast.on("requestDescriptor",e=>this.unicast.emit("giveDescriptor",e,this.getInviewId(),this.options.descriptor).catch(e=>{console.error(e)})),this.unicast.on("giveDescriptor",(e,t)=>{this.cache.has(e)||(r("[%s] get %s's descriptor from %s.",this.PID,e,this.parent.PID),this.cache.add(e,t))}))}join(e){this.parent&&this.parent.join(e);let t=new Promise((e,t)=>{"disconnected"!==this.state&&t(new m("join","Already connected."));let n=setTimeout(()=>{t(new m("join","Timeout exceeded."))},this.options.timeout);this.once("open",r=>{this.send(r,new u(this.getInviewId(),this.options.descriptor),this.options.retry).then(()=>{clearTimeout(n),this._start(),e(r)}).catch(()=>{t(new m("join","Could not notify contact."))})})});return this.connect(e),t}_onJoin(e,t){if(this.partialView.size>0){r("[%s] %s ===> join %s; %s neigbhors ===> %s",this.PID,e,this.PEER,this.partialView.size,e);let t=[];this.partialView.forEach(e=>{t.push({peer:e.peer,descriptor:e.descriptor})}),t.push({peer:this.getInviewId(),descriptor:this.options.descriptor}),this.send(e,new d(t),this.options.retry).catch(e=>{console.error(e)})}else r("[%s] %s ===> join %s ===> %s",this.PID,e,this.PEER,e),this.cache.add(t.peer,t.descriptor),this.connect(null,e),this.send(e,new d([{peer:this.getInviewId(),descriptor:this.options.descriptor}]),this.options.retry).catch(e=>{console.error(e)}),this._start()}_onArcDown(e){}_onPeerDown(e){this.partialView.removeAllNeighbor(e)}_sampleSize(e){return Math.min(e.length,2)}_partialViewSize(){return 4}_getSample(e){let t=[];this.partialView.forEach((e,n)=>{e.ages.forEach(r=>{!a(e.descriptor)&&t.push(n)})}),this.parent&&this.parent.partialView.forEach((e,n)=>{this.cache.has(n)&&t.indexOf(n)<0&&t.push(n)}),t=t.map(t=>{let n={descriptor:this.options.descriptor};return t===e.peer?n.peer=this.getInviewId():(n.descriptor=this.cache.has(t)&&this.cache.get(t)||this.partialView.getDescriptor(t),n.peer=t),n});const n=this._sampleSize(t);return t.sort(this.options.ranking(e)),t.slice(0,n)}_exchange(){if(this.partialView.size<=0&&this.parent&&this.parent.partialView.size<=0)return;let e,t;this.partialView.increment();let n=!0;if(this.partialView.size>0)e=this.partialView.oldest,t=this._getSample(this.partialView.get(e));else if(this.parent&&this.parent.partialView.size>0){let r=this.parent.getPeers(),i=!1;for(n=!1;!i&&r.length>0;){const n=Math.floor(Math.random()*r.length);this.cache.has(r[n])?(i=!0,e=r[n],t=this._getSample({peer:e,descriptor:this.cache.get(e)})):r.splice(n,1)}}e&&this.send(e,new l(this.getInviewId(),this.options.descriptor,t)).then(()=>{r("[%s] %s ==> suggest %s ==> %s",this.PID,this.PEER,t.length,e)}).catch(t=>{r("[%s] %s =X> suggest =X> %s",this.PID,this.PEER,e),n&&this._onPeerDown(e)})}_onExchange(e,t){const n=this._getSample(t);this.send(e,new d(n),this.options.retry).then(()=>{r("[%s] %s ==> suggest back %s ==> %s",this.PID,this.PEER,n.length,e)}).catch(e=>{}),this._onExchangeBack(e,t)}_onExchangeBack(e,t){let n=[];this.partialView.forEach((e,t)=>n.push(e)),t.sample.forEach(e=>n.indexOf(e)<0&&n.push(e)),n.sort(this.options.ranking(this.options));let i=[];n.slice(0,this._partialViewSize()).forEach(e=>{this.partialView.has(e.peer)||(i.push(e.peer),this.cache.add(e.peer,e.descriptor))}),i.length>0&&(r("[%s] %s wants to keep %s peers.",this.PID,this.PEER,i.length),this.send(e,new f(i),this.options.retry).catch(t=>{r("[%s] %s =X> request descriptors %s =X> %s",this.PID,this.PEER,i.length,e)}));let o=n.slice(this._partialViewSize(),n.length);o.length>0&&this.partialView.size>this._partialViewSize()&&o.forEach(e=>{this.partialView.has(e.peer)&&this.disconnect(e.peer)})}_onRequire(e,t){r("[%s] %s requested to be bridged with %s peers",this.PID,e,t.peers.length),t.peers.forEach(t=>{this.connect(e,t)})}_receive(e,t){if(t.type&&"MSuggest"===t.type)this._onExchange(e,t);else if(t.type&&"MSuggestBack"===t.type)this._onExchangeBack(e,t);else if(t.type&&"MRequire"===t.type)this._onRequire(e,t);else if(t.type&&"MJoin"===t.type)this._onJoin(e,t);else if(t.type&&"MGiveDescriptor"===t.type)this.emit(this.PID+"-"+e,t);else{if(!t.type||"MRequestDescriptor"!==t.type)throw new y("_receive",t,"unhandled");this._onRequestDescriptor(e,t)}}_start(e=this.options.delta){this.periodic=setInterval(()=>this._exchange(),e)}_stop(){this.periodic&&clearInterval(this.periodic)}_requestDescriptor(e){return new Promise((t,n)=>{let r=null;this.send(e,new g,this.options.retry).then(()=>{r=setTimeout(()=>{this.removeAllListeners(this.PID+"-"+e),n(new Error("timeout"))},this.options.descriptorTimeout)}).catch(e=>{n(e)}),this.once(this.PID+"-"+e,e=>{clearTimeout(r),this.cache.add(e.peer,e.descriptor),t()})})}_onRequestDescriptor(e,t){this.send(e,new p(this.getInviewId(),this.options.descriptor),this.options.retry).catch(t=>r("[%s] %s =X> give descriptor =X> %s",this.PID,this.PEER,e))}_open(e){r("[%s] %s ===> %s",this.PID,this.PEER,e),this.partialView.has(e)?this.disconnect(e):this.cache.has(e)?this._keep(e):this._requestDescriptor(e).then(()=>{this.partialView.has(e)?this.disconnect(e):this._keep(e)}).catch(t=>{this.disconnect(e)})}_keep(e){let t=[];this.partialView.forEach((e,n)=>t.push(e)),t.push({peer:e,descriptor:this.cache.get(e)}),t.sort(this.options.ranking(this.options)),t.slice(0,this._partialViewSize()),t.splice(0,this._partialViewSize()),(0===t.length||t.indexOf(e)<0)&&this.partialView.addNeighbor(e,this.cache.get(e)),t.forEach(e=>this.disconnect(e.peer))}_close(e){r("[%s] %s =†=> %s",this.PID,this.PEER,e),this.partialView.has(e)&&this.partialView.removeOldest(e)}_updateState(){const e=this.state;this.i.size>0&&this.o.size>0&&"connected"!==e?this.state="connected":this.i.size>0&&this.o.size<=0||this.o.size>0&&this.i.size<=0&&"partially connected"!==e?this.state="partially connected":this.i.size<=0&&this.o.size<=0&&"disconnected"!==e&&(this.state="disconnected"),e!==this.state&&this.emit("statechange",this.state)}getPeers(e){let t=[];if(void 0===e)this.partialView.forEach((e,n)=>t.push(n));else{let n=[];for(this.partialView.forEach((e,t)=>n.push(t));t.length<e&&n.length>0;){let e=Math.floor(Math.random()*n.length);t.push(n[e]),n.splice(e,1)}let r=[];for(this.i.forEach((e,t)=>r.push(t));t.length<e&&r.length>0;){let e=Math.floor(Math.random()*r.length);t.push(r[e]),r.splice(e,1)}}return r("[%s] %s provides %s peers",this.PID,this.PEER,t.length),t}}},function(e,t,n){"use strict";const r=n(227),i=n(228);e.exports=class extends Map{get oldest(){if(this.size<=0)throw new i("getOldest");let e=null,t=0;return this.forEach((n,r)=>{t<=n.oldest&&(e=n.peer,t=n.oldest)}),e}increment(){this.forEach((e,t)=>{e.increment()})}addNeighbor(e,t={}){this.has(e)?this.get(e).add():this.set(e,new r(e,t))}updateNeighbor(e,t={}){if(!this.has(e))throw new i("updateNeighbor",e);this.get(e).update(t)}removeOldest(e){if(!this.has(e))throw new i("removeNeighbor",e);this.get(e).removeOldest()&&this.delete(e)}removeAllNeighbor(e){if(this.has(e)){const t=this.get(e).count;return this.delete(e),t}throw new i("removeNeighbor",e)}get leastFrequent(){if(this.size<=0)throw new i("getLeastFrequent");let e=[],t=1/0;return this.forEach((n,r)=>{n.count<t&&(e=[],t=n.count),n.count===t&&e.push(r)}),e[Math.floor(Math.random()*e.length)]}getDescriptor(e){if(this.has(e))return this.get(e).descriptor;throw new i("getDescriptor",e)}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t={}){this.peer=e,this.ages=[0],this.descriptor=t}update(e){this.descriptor=e}increment(){this.ages=this.ages.map(e=>e+1)}add(){this.ages.unshift(0)}removeOldest(){return this.ages.pop(),0===this.ages.length}removeYoungest(){return this.ages.shift(),0===this.ages.length}get oldest(){return this.ages[this.ages.length-1]}get count(){return this.ages.length}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t="unknown"){this.source=e,this.peer=t}}},function(e,t,n){"use strict";e.exports=class extends Map{constructor(e){super(),this.timeout=e}add(e,t){this.set(e,t),setTimeout(()=>{this.has(e)&&this.delete(e)},this.timeout)}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t){this.peer=e,this.descriptor=t,this.type="MJoin"}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n){this.peer=e,this.descriptor=t,this.sample=n,this.type="MSuggest"}}},function(e,t,n){"use strict";e.exports=class{constructor(e){this.sample=e,this.type="MSuggestBack"}}},function(e,t,n){"use strict";e.exports=class{constructor(e){this.peers=e,this.type="MRequire"}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t){this.peer=e,this.descriptor=t,this.type="MGiveDescriptor"}}},function(e,t,n){"use strict";e.exports=class{constructor(){this.type="MRequestDescriptor"}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n){this.source=e,this.message=t,this.reason=n}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t){this.source=e,this.message=t}}},function(e,t,n){(function(t){const r=n(3),i=n(5),o=n(8),s=n(12)("spa"),a=new class{constructor(){this._statistics={message:0},this.manager=new Map,this._options={latency:e=>{setTimeout(e,0)}},s("manager initialized")}get stats(){return this._statistics}newPeer(e){s("new peer added. Size:",this.manager.size),this.manager.set(e.id,e)}connect(e,t){s("peer connected from/to: ",e,t),this.manager.get(t)._connectWith(e),this.manager.get(e)._connectWith(t)}destroy(e,t){s("peer disconnected from/to: ",e,t),this.manager.get(e)&&(this.manager.get(e)._close(),this.manager.delete(e)),this.manager.get(t)&&(this.manager.get(t)._close(),this.manager.delete(t))}send(e,t,n,r=0){this._send(e,t,n,r)}_send(e,t,n,r=0){try{if(!this.manager.has(e)||!this.manager.has(t))throw new Error("need a from and to peer.");this.manager.get(t).emit("data",n),this._statistics.message++}catch(e){throw new Error("cannot send the message. perhaps your destination is not reachable.",e)}}};e.exports=class extends r{constructor(e){super(),this._manager=a,this._options=i({id:o(),initiator:!1,channelConfig:{},channelName:o(),config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},constraints:{},offerConstraints:{},answerConstraints:{},reconnectTimer:!1,sdpTransform:function(e){return e},stream:!1,streams:[],trickle:!0,wrtc:{},objectMode:!1},e),this.id=this._options.id,this.WEBRTC_SUPPORT=!0,this._isNegotiating=!1,this.connected=!1,this.disconnected=!1,this.connectedWith=void 0,this.messageBuffer=[],s("peer initiated:",this.id,this._options.initiator),this._options.initiator&&t.nextTick(()=>{this._init()}),this._manager.newPeer(this)}static get manager(){return a}send(e){this.connectedWith?(this.messageBuffer.length>0&&this._reviewMessageBuffer(),this.connectedWith?this._send(this.connectedWith,e):this.messageBuffer.push(e)):this.messageBuffer.push(e)}destroy(){this._manager.destroy(this.id,this.connectedWith)}signal(e){"init"===e.type?(this._isNegotiating=!0,s("offer-init received:",e),this.emit("signal",this._createAccept(e))):"accept"===e.type&&(s("offer-accept received:",e),this._connect(e))}_error(e){s(e),this.emit("error",e)}_close(){s("[%s] is closed.",this.id),this.emit("close")}_init(){this._isNegotiating=!0;const e=this._createOffer();this.emit("signal",e)}_createOffer(){return{offerId:o(),type:"init",offer:{initiator:this.id}}}_createAccept(e){const t=this._createOffer();return t.type="accept",t.offerId=e.offerId,t.offer.initiator=e.offer.initiator,t.offer.acceptor=this.id,t}_reviewMessageBuffer(){for(s("Review the buffer: ",this.messageBuffer.length);this.connectedWith&&0!==this.messageBuffer.length;)this._send(this.messageBuffer.pop())}_send(e=this.connectedWith,t){if(!e)throw new Error("It must have a destination.");this._manager.send(this.id,e,t)}_connect(e){if(!e.offer.acceptor)throw new Error("It must have an acceptor");this._manager.connect(e.offer.initiator,e.offer.acceptor)}_connectWith(e){this.connected=!0,this._isNegotiating=!1,this.connectedWith=e,this.emit("connect")}}}).call(this,n(1))},function(e,t,n){e.exports=function(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){let n;function s(...e){if(!s.enabled)return;const t=s,i=Number(new Date),o=i-(n||i);t.diff=o,t.prev=n,t.curr=i,n=i,e[0]=r.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(n,i)=>{if("%%"===n)return n;a++;const o=r.formatters[i];if("function"==typeof o){const r=e[a];n=o.call(t,r),e.splice(a,1),a--}return n}),r.formatArgs.call(t,e),(t.log||r.log).apply(t,e)}return s.namespace=e,s.enabled=r.enabled(e),s.useColors=r.useColors(),s.color=t(e),s.destroy=i,s.extend=o,"function"==typeof r.init&&r.init(s),r.instances.push(s),s}function i(){const e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){return r(this.namespace+(void 0===t?":":t)+e)}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){const e=[...r.names.map(s),...r.skips.map(s).map(e=>"-"+e)].join(",");return r.enable(""),e},r.enable=function(e){let t;r.save(e),r.names=[],r.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){const e=r.instances[t];e.enabled=r.enabled(e.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(11),Object.keys(e).forEach(t=>{r[t]=e[t]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},function(e,t,n){const r=n(241),i=n(5);e.exports=class{constructor(e,t){this.id="p-"+e;const n={x:e,y:e,z:Math.floor(20*Math.random())};this.options=i({coordinates:n,perimeter:7,overlay:{name:this.id,class:r,options:{pid:this.id,delta:2e3,timeout:5e3,pendingTimeout:5e3,maxPeers:1/0,target:{perimeter:7,coordinates:n},protocol:"foglet-template-"+this.id,signaling:{address:"https://signaling.herokuapp.com/",room:"room-foglet-template-"+this.id}}}},t)}isNearby(e){const t=e,n=this.getCoordinates(),r=this.getPerimeter(),{x:i,y:o,z:s}=t,{x:a,y:c,z:h}=n,u=i-a,l=o-c;return!(Math.sqrt(u*u+l*l)>r)}getCoordinates(){return this.options.coordinates}getOverlay(){return this.options.overlay}getPerimeter(){return this.options.perimeter}}},function(e,t,n){const r=n(88),i=n(242);n(40),e.exports=class extends i{constructor(...e){super(...e),this.options.target.leader={id:this._rps.II.peer,descriptor:this._rps.options.descriptor},this._setupListener(),this._updateCache()}_setupListener(e=this.options.delta){const t=this.options.pid;setTimeout(()=>{this._manager.overlay(t).communication.onUnicast((e,t)=>{if("MUpdateCache"===t.type&&(this._rps.cache.set(t.peer,t.descriptor),this._rps.partialView.has(t.peer))){const e=this._rps.partialView.get(t.peer).descriptor;e.x=t.descriptor.x,e.y=t.descriptor.y,e.z=t.descriptor.z}})},500)}_updateCache(e=this.options.delta){this.periodic=setInterval(()=>{const e=this.options.pid;this._manager.overlay(e)&&this._manager.overlay(e).communication.sendMulticast(this._rps.getPeers(),new r(this.inviewId,this._rps.options.descriptor)).then().catch(e=>{})},.7*e)}_startDescriptor(){return{id:"test",x:Math.floor(10*Math.random()),y:Math.floor(10*Math.random()),z:Math.floor(10*Math.random())}}getDistance(e,t){const{x:n,y:r,z:i}=e,{x:o,y:s,z:a}=t,c=n-o,h=r-s;return Math.sqrt(c*c+h*h)}isNearby(e,t,n){return!(this.getDistance(e,t)>n)}_rankPeers(e,t,n,r,i){return 1}}},function(e,t,n){const r=n(243),i=n(87)("template:overlay"),o=n(88);n(40),e.exports=class extends r{constructor(...e){super(...e),i("Overlay initialized"),this.rps._partialViewSize=(()=>this.options.maxPeers),this.rps._sampleSize=(()=>this.options.maxPeers),this._setupListener(),this._updateCache()}_startDescriptor(){return{id:"test",x:Math.floor(10*Math.random()),y:Math.floor(10*Math.random()),z:Math.floor(50*Math.random())}}_setupListener(e=this.options.delta){const t=this.options.pid;setTimeout(()=>{this._manager.overlay(t).communication.onUnicast((e,t)=>{if("MUpdateCache"===t.type&&(this._rps.cache.set(t.peer,t.descriptor),this._rps.partialView.has(t.peer))){const e=this._rps.partialView.get(t.peer).descriptor;e.x=t.descriptor.x,e.y=t.descriptor.y,e.z=t.descriptor.z}})},500)}_updateCache(e=this.options.delta){this.periodic=setInterval(()=>{const e=this.options.pid;this._rps.parent.getPeers().forEach(t=>{this._manager.overlay(e)&&this._manager.overlay(e).communication.sendUnicast(t,new o(this.inviewId,this._rps.options.descriptor)).then().catch(e=>{})})},2e3)}_descriptorTimeout(){return 5e3}_rankPeers(e,t,n,r,i){const o=(e,t)=>{const{x:n,y:r,z:i}=e,{x:o,y:s,z:a}=t,c=n-o,h=r-s;return Math.sqrt(c*c+h*h)},s=o(e.descriptor,t),a=o(e.descriptor,n);if(s===a){if(t.x>=n.x)return-1;if(t.x<n.x)return 1}return s-a}}},function(e,t,n){"use strict";const r=n(31).abstract.rps,i=n(244),o=n(5);e.exports=class extends r{constructor(e,t){t.manager=e,super(t),this._manager=e}get inviewId(){return this.rps.getInviewId()}get outviewId(){return this.rps.getOutviewId()}get descriptor(){return this._rps.options.descriptor}set descriptor(e){this._rps.options.descriptor=e}_buildRPS(e){this.options=o({config:e.webrtc},e);const t=o({descriptor:this._startDescriptor(),descriptorTimeout:this._descriptorTimeout(),ranking:this._rankingFunction()},this.options);return new i(t,e.manager._rps._network._rps)}_startDescriptor(){throw new Error("A valid TMan based overlay must implement a _descriptor method to generate a base descriptor")}_descriptorTimeout(){throw new Error("A valid TMan based overlay must implement a _descriptorTimeout method to give the timeout on descriptors")}_rankPeers(e,t,n,r,i){throw new Error("A valid TMan based overlay must implement a _rankPeers method to rank two peers"+`variable: ${e.toString()}${t.toString()}${n.toString()}${r.toString()}${i.toString()}`)}_rankingFunction(){return e=>(t,n)=>this._rankPeers(e,t.descriptor,n.descriptor,t,n)}getNeighbours(e){return this.rps.getPeers(e)}}},function(e,t,n){"use strict";const r=n(245)("tman-wrtc"),i=n(30),o=n(34),s=n(5),a=n(86),c=n(247),h=n(250),u=n(251),l=n(252),d=n(253),f=n(254),p=n(255),g=n(256),y=n(257),m=n(258);e.exports=class extends i{constructor(e={},t){super(s({pid:"tman-wrtc",delta:6e4,timeout:12e4,descriptorTimeout:1e4,retry:5,inview:t&&t.NI,outview:t&&t.NO,descriptor:{x:Math.random()},ranking:e=>(t,n)=>{const r=n.descriptor.x-e.descriptor.x,i=t.descriptor.x-e.descriptor.x;return Math.abs(i)-Math.abs(r)}},e)),r("[%s] Initalized with ==> %s ==>",this.PID,this.PEER),this.partialView=new c,this.cache=new h(this.options.timeout),this.state="disconnected",this.periodic=null,this.on("receive",(e,t)=>this._receive(e,t)),this.on("open",e=>{this._open(e),this._updateState()}),this.on("close",e=>{this._close(e),this._updateState()}),this.on("fail",e=>{this._onArcDown(e),this._updateState()}),this.parent=t||null,this.parent&&(this.unicast=new o(this.parent,{pid:"tman-wrtc-unicast",retry:this.options.retry}),this.parent.on("open",e=>!this.cache.has(e)&&this.unicast.emit("requestDescriptor",e,this.getOutviewId()).catch(e=>{console.error(e)})),this.unicast.on("tman-exchange",(e,t)=>this._receive(e,t)),this.unicast.on("requestDescriptor",e=>this.unicast.emit("giveDescriptor",e,this.getInviewId(),this.options.descriptor).catch(e=>{console.error(e)})),this.unicast.on("giveDescriptor",(e,t)=>{this.cache.has(e)||(r("[%s] get %s's descriptor from %s.",this.PID,e,this.parent.PID),this.cache.add(e,t))}))}join(e){this.parent&&this.parent.join(e);let t=new Promise((e,t)=>{"disconnected"!==this.state&&t(new m("join","Already connected."));let n=setTimeout(()=>{t(new m("join","Timeout exceeded."))},this.options.timeout);this.once("open",r=>{this.send(r,new u(this.getInviewId(),this.options.descriptor),this.options.retry).then(()=>{clearTimeout(n),this._start(),e(r)}).catch(()=>{t(new m("join","Could not notify contact."))})})});return this.connect(e),t}_onJoin(e,t){if(this.partialView.size>0){r("[%s] %s ===> join %s; %s neigbhors ===> %s",this.PID,e,this.PEER,this.partialView.size,e);let t=[];this.partialView.forEach(e=>{t.push({peer:e.peer,descriptor:e.descriptor})}),t.push({peer:this.getInviewId(),descriptor:this.options.descriptor}),this.send(e,new d(t),this.options.retry).catch(e=>{console.error(e)})}else r("[%s] %s ===> join %s ===> %s",this.PID,e,this.PEER,e),this.cache.add(t.peer,t.descriptor),this.connect(null,e),this.send(e,new d([{peer:this.getInviewId(),descriptor:this.options.descriptor}]),this.options.retry).catch(e=>{console.error(e)}),this._start()}_onArcDown(e){}_onPeerDown(e){this.partialView.removeAllNeighbor(e)}_sampleSize(e){return Math.min(e.length,2)}_partialViewSize(){return 4}_getSample(e){let t=[];this.partialView.forEach((e,n)=>{e.ages.forEach(r=>{!a(e.descriptor)&&t.push(n)})}),this.parent&&this.parent.partialView.forEach((e,n)=>{this.cache.has(n)&&t.indexOf(n)<0&&t.push(n)}),t=t.map(t=>{let n={descriptor:this.options.descriptor};return t===e.peer?n.peer=this.getInviewId():(n.descriptor=this.cache.has(t)&&this.cache.get(t)||this.partialView.getDescriptor(t),n.peer=t),n});const n=this._sampleSize(t);return t.sort(this.options.ranking(e)),t.slice(0,n)}_exchange(){if(this.partialView.size<=0&&this.parent&&this.parent.partialView.size<=0)return;let e,t;this.partialView.increment();let n=!0;if(this.partialView.size>0)e=this.partialView.oldest,t=this._getSample(this.partialView.get(e)),e&&this.send(e,new l(this.getInviewId(),this.options.descriptor,t)).then(()=>{r("[%s] %s ==> suggest %s ==> %s",this.PID,this.PEER,t.length,e)}).catch(t=>{r("[%s] %s =X> suggest =X> %s",this.PID,this.PEER,e),n&&this._onPeerDown(e)});else if(this.parent&&this.parent.partialView.size>0){let i=this.parent.getPeers();e=i[Math.floor(Math.random()*i.length)],t=[];let o=!1;for(n=!1;!o&&i.length>0;){const n=Math.floor(Math.random()*i.length);this.cache.has(i[n])?(o=!0,e=i[n],t=this._getSample({peer:e,descriptor:this.cache.get(e)})):i.splice(n,1)}e&&this.unicast.emit("tman-exchange",e,this.getInviewId(),new l(this.getInviewId(),this.options.descriptor,t)).then(()=>{r("[%s] %s ==> suggest %s ==> %s",this.PID,this.PEER,t.length,e)}).catch(t=>{r("[%s] %s =X> suggest =X> %s",this.PID,this.PEER,e),n&&this._onPeerDown(e)})}}_onExchange(e,t){const n=this._getSample(t);this.send(e,new d(n),this.options.retry).then(()=>{r("[%s] %s ==> suggest back %s ==> %s",this.PID,this.PEER,n.length,e)}).catch(e=>{}),this._onExchangeBack(e,t)}_onExchangeBack(e,t){let n=[];const i=new Map;t.sample.forEach(e=>{i.set(e.peer,e)}),this.partialView.forEach((e,t)=>{i.has(t)||i.set(t,e)}),(n=[...i.values()]).sort(this.options.ranking(this.options));let o=[];n.slice(0,this._partialViewSize()).forEach(e=>{this.partialView.has(e.peer)||(o.push(e.peer),this.cache.add(e.peer,e.descriptor))}),o.length>0&&(r("[%s] %s wants to keep %s peers.",this.PID,this.PEER,o.length),this.send(e,new f(o),this.options.retry).catch(t=>{r("[%s] %s =X> request descriptors %s =X> %s",this.PID,this.PEER,o.length,e)}));let s=n.slice(this._partialViewSize(),n.length);s.length>0&&this.partialView.size>this._partialViewSize()&&s.forEach(e=>{this.partialView.has(e.peer)&&this.disconnect(e.peer)})}_onRequire(e,t){r("[%s] %s requested to be bridged with %s peers",this.PID,e,t.peers.length),t.peers.forEach(t=>{this.connect(e,t)})}_receive(e,t){if(t.type&&"MSuggest"===t.type)this._onExchange(e,t);else if(t.type&&"MSuggestBack"===t.type)this._onExchangeBack(e,t);else if(t.type&&"MRequire"===t.type)this._onRequire(e,t);else if(t.type&&"MJoin"===t.type)this._onJoin(e,t);else if(t.type&&"MGiveDescriptor"===t.type)this.emit(this.PID+"-"+e,t);else{if(!t.type||"MRequestDescriptor"!==t.type)throw new y("_receive",t,"unhandled");this._onRequestDescriptor(e,t)}}_start(e=this.options.delta){this.periodic=setInterval(()=>this._exchange(),e)}_stop(){this.periodic&&clearInterval(this.periodic)}_requestDescriptor(e){return new Promise((t,n)=>{let r=null;this.send(e,new g,this.options.retry).then(()=>{r=setTimeout(()=>{this.removeAllListeners(this.PID+"-"+e),n(new Error("timeout"))},this.options.descriptorTimeout)}).catch(e=>{n(e)}),this.once(this.PID+"-"+e,e=>{clearTimeout(r),this.cache.add(e.peer,e.descriptor),t()})})}_onRequestDescriptor(e,t){this.send(e,new p(this.getInviewId(),this.options.descriptor),this.options.retry).catch(t=>r("[%s] %s =X> give descriptor =X> %s",this.PID,this.PEER,e))}_open(e){r("[%s] %s ===> %s",this.PID,this.PEER,e),this.partialView.has(e)?this.disconnect(e):this.cache.has(e)?this._keep(e):this._requestDescriptor(e).then(()=>{this.partialView.has(e)?this.disconnect(e):this._keep(e)}).catch(t=>{this.disconnect(e)})}_keep(e){let t=[];this.partialView.forEach((e,n)=>t.push(e)),t.push({peer:e,descriptor:this.cache.get(e)}),t.sort(this.options.ranking(this.options)),t.slice(0,this._partialViewSize()),t.splice(0,this._partialViewSize()),(0===t.length||t.indexOf(e)<0)&&this.partialView.addNeighbor(e,this.cache.get(e)),t.forEach(e=>this.disconnect(e.peer))}_close(e){r("[%s] %s =†=> %s",this.PID,this.PEER,e),this.partialView.has(e)&&this.partialView.removeOldest(e)}_updateState(){const e=this.state;this.i.size>0&&this.o.size>0&&"connected"!==e?this.state="connected":this.i.size>0&&this.o.size<=0||this.o.size>0&&this.i.size<=0&&"partially connected"!==e?this.state="partially connected":this.i.size<=0&&this.o.size<=0&&"disconnected"!==e&&(this.state="disconnected"),e!==this.state&&this.emit("statechange",this.state)}getPeers(e){let t=[];if(void 0===e)this.partialView.forEach((e,n)=>t.push(n));else{let n=[];for(this.partialView.forEach((e,t)=>n.push(t));t.length<e&&n.length>0;){let e=Math.floor(Math.random()*n.length);t.push(n[e]),n.splice(e,1)}let r=[];for(this.i.forEach((e,t)=>r.push(t));t.length<e&&r.length>0;){let e=Math.floor(Math.random()*r.length);t.push(r[e]),r.splice(e,1)}}return r("[%s] %s provides %s peers",this.PID,this.PEER,t.length),t}}},function(e,t,n){"use strict";(function(r){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":i(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(i=++r)}),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n(246)(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n(1))},function(e,t,n){"use strict";e.exports=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){var n;function s(){if(s.enabled){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var o=s,a=Number(new Date),c=a-(n||a);o.diff=c,o.prev=n,o.curr=a,n=a,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var h=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,function(e,n){if("%%"===e)return e;h++;var i=r.formatters[n];if("function"==typeof i){var s=t[h];e=i.call(o,s),t.splice(h,1),h--}return e}),r.formatArgs.call(o,t),(o.log||r.log).apply(o,t)}}return s.namespace=e,s.enabled=r.enabled(e),s.useColors=r.useColors(),s.color=t(e),s.destroy=i,s.extend=o,"function"==typeof r.init&&r.init(s),r.instances.push(s),s}function i(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function o(e,t){return r(this.namespace+(void 0===t?":":t)+e)}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length;for(t=0;t<i;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var o=r.instances[t];o.enabled=r.enabled(o.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n(11),Object.keys(e).forEach(function(t){r[t]=e[t]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},function(e,t,n){"use strict";const r=n(248),i=n(249);e.exports=class extends Map{get oldest(){if(this.size<=0)throw new i("getOldest");let e=null,t=0;return this.forEach((n,r)=>{t<=n.oldest&&(e=n.peer,t=n.oldest)}),e}increment(){this.forEach((e,t)=>{e.increment()})}addNeighbor(e,t={}){this.has(e)?this.get(e).add():this.set(e,new r(e,t))}updateNeighbor(e,t={}){if(!this.has(e))throw new i("updateNeighbor",e);this.get(e).update(t)}removeOldest(e){if(!this.has(e))throw new i("removeNeighbor",e);this.get(e).removeOldest()&&this.delete(e)}removeAllNeighbor(e){if(this.has(e)){const t=this.get(e).count;return this.delete(e),t}throw new i("removeNeighbor",e)}get leastFrequent(){if(this.size<=0)throw new i("getLeastFrequent");let e=[],t=1/0;return this.forEach((n,r)=>{n.count<t&&(e=[],t=n.count),n.count===t&&e.push(r)}),e[Math.floor(Math.random()*e.length)]}getDescriptor(e){if(this.has(e))return this.get(e).descriptor;throw new i("getDescriptor",e)}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t={}){this.peer=e,this.ages=[0],this.descriptor=t}update(e){this.descriptor=e}increment(){this.ages=this.ages.map(e=>e+1)}add(){this.ages.unshift(0)}removeOldest(){return this.ages.pop(),0===this.ages.length}removeYoungest(){return this.ages.shift(),0===this.ages.length}get oldest(){return this.ages[this.ages.length-1]}get count(){return this.ages.length}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t="unknown"){this.source=e,this.peer=t}}},function(e,t,n){"use strict";e.exports=class extends Map{constructor(e){super(),this.timeout=e}add(e,t){this.set(e,t),setTimeout(()=>{this.has(e)&&this.delete(e)},this.timeout)}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t){this.peer=e,this.descriptor=t,this.type="MJoin"}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n,r){this.peer=e,this.descriptor=t,this.sample=n,this.type="MSuggest"}}},function(e,t,n){"use strict";e.exports=class{constructor(e){this.sample=e,this.type="MSuggestBack"}}},function(e,t,n){"use strict";e.exports=class{constructor(e){this.peers=e,this.type="MRequire"}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t){this.peer=e,this.descriptor=t,this.type="MGiveDescriptor"}}},function(e,t,n){"use strict";e.exports=class{constructor(){this.type="MRequestDescriptor"}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t,n){this.source=e,this.message=t,this.reason=n}}},function(e,t,n){"use strict";e.exports=class{constructor(e,t){this.source=e,this.message=t}}},function(e,t,n){const r=n(260);e.exports=class{constructor(e){this.template=e,this.current={},this.instance=new Set,e.getOverlays().forEach(t=>{this.current[t]=new r(e,t)}),e.on("target-spawned",t=>{if(!this.instance.has(t)){console.log(t),this.instance.add(t),e.handleUnicast(t);try{this.current[t]=new r(e,t)}catch(e){console.log(e)}}})}getTarget(e){this.current[e]&&this.current[e].start()}}},function(e,t,n){const{Ballot:r,helpers:i}=n(261),o=n(262),s=n(89),a=n(3);e.exports=class extends a{constructor(e,t){super(),this.progression={initialValue:null,maxPeers:0,ballot:new r,value:null,acceptedBallot:new r,acceptedValue:null,proposed:[],accepted:{},decided:null},this.candidate=new s(e),this.overlay=t,this.candidate.template.addHandler(o.types().START,this.prepare.bind(this),this.overlay),this.candidate.template.addHandler(o.types().PREPARE,this.acknowledge.bind(this),this.overlay),this.candidate.template.addHandler(o.types().ACKNOWLEDGE,this.propose.bind(this),this.overlay),this.candidate.template.addHandler(o.types().PROPOSE,this.accept.bind(this),this.overlay),this.candidate.template.addHandler(o.types().ACCEPT,this.decide.bind(this),this.overlay),this.candidate.template.addHandler(o.types().DECIDE,this.decided.bind(this),this.overlay),this.on("DECIDED",e=>{console.log("DECIDED => ",this.candidate.template.foglet.inViewID,e)})}start(){const e=this.candidate.getLeader(this.overlay);if(!e)return;const t=this.candidate.template.foglet.inViewID,n=new o(o.types().START,{pid:t,cible:this.overlay});e.peer===t?this.prepare(t,n):this.candidate.template.sendOverlayUnicast(this.overlay,e.peer,n)}prepare(e,t){this.periodic||(this.progression.initialValue=t.content,i.setPid(this.progression.ballot,this.candidate.template.foglet.inViewID),this.periodic=setInterval(()=>{if(!this.candidate.isLeader(this.overlay))return;this.progression.proposed=[],this.progression.maxPeers=this.candidate.template.neighboursOverlay(this.overlay).length+1;const e=i.increment(this.progression.ballot),t=new o(o.types().PREPARE,{ballot:e,maxPeers:this.progression.maxPeers});this.candidate.template.sendOverlayUnicastAll(this.overlay,t),this.acknowledge(this.candidate.template.foglet.inViewID,t)},2e3))}acknowledge(e,t){if(this.progression.decided)return;let{ballot:n,maxPeers:r}=t.content;if(this.progression.maxPeers=r,i.greaterThan(n,this.progression.ballot)){this.progression.ballot=n;const t=new o(o.types().ACKNOWLEDGE,{ballot:n,acceptedBallot:this.progression.acceptedBallot,acceptedValue:this.progression.acceptedValue});e===this.candidate.template.foglet.inViewID?this.propose(this.candidate.template.foglet.inViewID,t):this.candidate.template.sendOverlayUnicast(this.overlay,n.pid,t)}}propose(e,t){if(this.progression.decided)return;const{ballot:n,acceptedBallot:r,acceptedValue:i}=t.content;if(r&&(this.progression.proposed.push({ballot:r,value:i}),this.majority(this.progression.proposed))){let e=null;e=this.isNoValue()?this.progression.initialValue:this.greatestBallot().value;const t=new o(o.types().PROPOSE,{ballot:n,value:e});this.candidate.template.sendOverlayUnicastAll(this.overlay,t),this.accept(this.candidate.template.foglet.inViewID,t)}}accept(e,t){if(this.progression.decided)return;const{ballot:n,value:r}=t.content;if(i.greaterThan(n,this.progression.ballot)){this.progression.acceptedBallot=n,this.progression.acceptedValue=r;const e=new o(o.types().ACCEPT,{ballot:this.progression.acceptedBallot,value:this.progression.acceptedValue});this.candidate.template.sendOverlayUnicastAll(this.overlay,e),this.decide(this.candidate.template.foglet.inViewID,e)}}decide(e,t){if(this.progression.decided)return;const{ballot:n,value:r}=t.content,s=i.toString(n);if(this.progression.accepted[s]?this.progression.accepted[s][e]=r:this.progression.accepted[s]={[e]:r},!this.isMajorityValue(s,r))return;const a=new o(o.types().DECIDE,{value:r});this.candidate.template.sendOverlayUnicastAll(this.overlay,a),this.decided(this.candidate.template.foglet.inViewID,a)}decided(e,t){if(this.progression.decided)return;const{value:n}=t.content;this.progression.decided=n,this.emit("DECIDED",n),this.candidate.isLeader(this.overlay)&&clearInterval(this.periodic)}isNoValue(){let e=!0;return this.progression.proposed.forEach(t=>{e=e&&null===t.value}),e}greatestBallot(){if(0==this.progression.length)return;let e=this.progression.proposed[0];return this.progression.proposed.forEach(t=>{i.greaterThan(t.ballot,e.ballot)&&null!==t.value&&(e=t)}),e}majority(e){return e.length>=Math.floor(this.progression.maxPeers/2+1)}isMajorityValue(e,t){let n=0;const r=this.progression.accepted[e];return Object.keys(r).forEach(e=>{t&&r[e].pid==t.pid&&n++}),n>=Math.floor(this.progression.maxPeers/2+1)}}},function(e,t){e.exports={Ballot:class{constructor(){this.pid=0,this.n=0}},helpers:{setBallot:(e,{pid:t,n:n})=>(e.pid=t,e.n=n,e),setPid:(e,t)=>(e.pid=t,e),increment:e=>(e.n=e.n+1,e),greaterThan:(e,t)=>e.n>t.n||e.n===t.n&&e.pid>t.pid||e.n===t.n&&e.pid===t.pid,toString:e=>e.pid+"-"+e.n}}},function(e,t){const n={START:"start",PREPARE:"prepare",ACKNOWLEDGE:"acknowledge",PROPOSE:"propose",ACCEPT:"accept",DECIDE:"decide"};e.exports=class{constructor(e,t){this.type=e,this.content=t}static types(){return n}}}])});
//# sourceMappingURL=index.js.map